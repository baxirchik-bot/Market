<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>MarketHub Mini App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
    }

    body {
      background: #f1f4ff;
      color: #0f172a;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .app {
      background: #f9fafb;
      width: 100%;
      max-width: 480px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
    }

    /* HEADER */
    .app-header {
      padding: 12px 16px 10px;
      background: #ffffff;
      border-bottom: 1px solid rgba(148, 163, 184, 0.3);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .app-header-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .app-logo-small {
      width: 35px;
      height: 35px;
      border-radius: 9px;
    }

    .app-title {
      font-weight: 600;
      font-size: 16px;
      color: #0f172a;
    }

    .app-subtitle {
      font-size: 12px;
      color: #64748b;
    }

    /* SCREEN CONTAINER */
    .screens {
      flex: 1;
      overflow-y: auto;
      padding: 12px 12px 72px;
    }

    .screen {
      display: none;
    }
    .screen.active {
      display: block;
    }

    .screen-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 10px;
    }

    /* SEARCH + FILTER BUTTON */
    .search-bar-row {
      display: flex;
      gap: 8px;
      margin-top: 4px;
      margin-bottom: 12px;
      align-items: stretch;
    }

    .search-bar {
      flex: 1;
    }

    .search-input {
      width: 100%;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      font-size: 14px;
      padding-left: 32px;
      background: #ffffff
        url("data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 5a6 6 0 014.472 9.972l3.278 3.278a1 1 0 01-1.414 1.414l-3.278-3.278A6 6 0 1111 5zm0 2a4 4 0 100 8 4 4 0 000-8z' fill='%2394a3b8'/%3E%3C/svg%3E")
        no-repeat 10px center;
      background-size: 16px;
    }

    .filters-btn {
      border-radius: 14px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      padding: 0 10px;
      font-size: 13px;
      background: #ffffff;
      color: #1d4ed8;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      cursor: pointer;
      white-space: nowrap;
    }

    /* QUICK ACTIONS */
    .quick-actions-title {
      font-size: 14px;
      color: #64748b;
      margin-bottom: 6px;
    }

    .primary-btn {
      width: 100%;
      border: none;
      border-radius: 999px;
      padding: 13px 16px;
      font-size: 15px;
      font-weight: 600;
      color: #ffffff;
      background: linear-gradient(135deg, #2563eb, #1d4ed8);
      box-shadow: 0 8px 20px rgba(37, 99, 235, 0.35);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 10px;
      cursor: pointer;
    }

        /* –ü–†–û–ú–û-–ë–ê–ù–ù–ï–† –ù–ê –ì–õ–ê–í–ù–û–ô */
    .promo-banner {
      margin: 10px 0 14px;
      border-radius: 18px;
      overflow: hidden;
      cursor: pointer;
      box-shadow: 0 8px 24px rgba(15, 23, 42, 0.18);
    }

    .promo-banner img {
  width: 800px;
  height: auto;      /* ‚Üê —Ä–æ–≤–Ω–æ –≤ –¥–≤–∞ —Ä–∞–∑–∞ –º–µ–Ω—å—à–µ */
  object-fit: cover;  /* —á—Ç–æ–±—ã —Ä–æ–±–æ—Ç –∏ —Ç–µ–∫—Å—Ç –Ω–µ –¥–µ—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–ª–∏—Å—å */
  border-radius: 12px;
}

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 12px;
    }

    .chip {
      border-radius: 999px;
      padding: 7px 12px;
      font-size: 13px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: #ffffff;
      color: #0f172a;
      cursor: pointer;
    }
    .chip.chip-filled {
      background: #1d4ed8;
      color: #ffffff;
      border-color: transparent;
      box-shadow: 0 4px 14px rgba(37, 99, 235, 0.3);
    }

    .section-title {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 8px;
      margin-top: 4px;
    }

    /* POPULAR CATEGORIES */
    .category-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
      margin-bottom: 12px;
    }

    .category-card {
      background: #ffffff;
      border-radius: 16px;
      padding: 10px 12px;
      box-shadow: 0 3px 10px rgba(15, 23, 42, 0.06);
      font-size: 14px;
      cursor: pointer;
    }

    .category-card-title {
      font-weight: 600;
      margin-bottom: 2px;
    }

    .category-card-sub {
      font-size: 12px;
      color: #64748b;
    }

    /* –ê–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è */
.category-card.active {
  border-color: #1d4ed8;
  box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.3);
  background: #eff6ff;
}
    
    /* LIST (TILE) */
    .ad-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 16px;
    }

    .ad-card {
      display: flex;
      gap: 10px;
      background: #ffffff;
      border-radius: 16px;
      padding: 10px;
      box-shadow: 0 3px 10px rgba(15, 23, 42, 0.06);
      cursor: pointer;
    }

    /* –°–µ—Ç–∫–∞ –¥–ª—è –ø–ª–∏—Ç–∫–∏ */
    .ad-list.grid-mode {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
    }
    .ad-list.grid-mode .ad-card {
      flex-direction: column;
      padding: 8px;
    }
    .ad-list.grid-mode .ad-image {
      width: 100%;
      height: 120px;
    }

    .ad-image {
      width: 56px;
      height: 56px;
      border-radius: 14px;
      background: linear-gradient(135deg, #eff6ff, #dbeafe);
      flex-shrink: 0;
      background-size: cover;
      background-position: center;
    }

    .ad-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .ad-title {
      font-size: 14px;
      font-weight: 600;
    }

    .ad-meta {
      font-size: 12px;
      color: #64748b;
    }

    .ad-price {
      font-size: 14px;
      font-weight: 600;
      color: #16a34a;
      margin-top: 2px;
    }

    .ad-photos-count {
      font-size: 11px;
      color: #64748b;
      margin-top: 2px;
    }

    /* PROFILE SCREEN */
    .profile-card {
      background: #ffffff;
      border-radius: 20px;
      padding: 14px;
      box-shadow: 0 6px 18px rgba(15, 23, 42, 0.08);
      margin-bottom: 14px;
    }

    .profile-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }

    .avatar {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      background: #1d4ed8;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #ffffff;
      font-weight: 600;
      font-size: 18px;
    }

    .profile-name {
      font-size: 15px;
      font-weight: 600;
    }

    .profile-username {
      font-size: 13px;
      color: #64748b;
    }

    .profile-rating {
      font-size: 13px;
      color: #f59e0b;
      margin-top: 2px;
    }

    .profile-desc {
      font-size: 13px;
      color: #475569;
      margin-top: 6px;
    }

    .profile-actions {
      display: flex;
      gap: 8px;
      margin-top: 10px;
    }

    .outline-btn,
    .secondary-btn {
      flex: 1;
      border-radius: 999px;
      padding: 8px 10px;
      font-size: 13px;
      border: 1px solid #cbd5f5;
      background: #f8fafc;
      color: #1d4ed8;
      cursor: pointer;
    }
    .secondary-btn {
      background: #fff7ed;
      border-color: #fed7aa;
      color: #c2410c;
    }

    .profile-section-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 6px;
      margin-top: 6px;
    }

    /* NEW AD FORM */
    .back-link {
      font-size: 13px;
      color: #1d4ed8;
      margin-bottom: 6px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .form-group {
      margin-bottom: 10px;
    }

    .form-label {
      font-size: 13px;
      margin-bottom: 4px;
      display: block;
      color: #475569;
    }

    .form-input,
    .form-select,
    .form-textarea {
      width: 100%;
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      padding: 9px 10px;
      font-size: 14px;
      background: #ffffff;
    }

    .form-textarea {
      resize: vertical;
      min-height: 60px;
    }

    .hint {
      font-size: 12px;
      color: #94a3b8;
      margin-top: 2px;
    }

    .step-tag {
      display: inline-block;
      font-size: 11px;
      padding: 3px 7px;
      border-radius: 999px;
      background: #eff6ff;
      color: #1d4ed8;
      margin-left: 4px;
    }

    .photos-preview-row {
      display: flex;
      gap: 8px;
      flex-wrap: nowrap;
      overflow-x: auto;
      margin-top: 6px;
    }

    .photo-thumb {
      width: 64px;
      height: 64px;
      border-radius: 12px;
      overflow: hidden;
      background: #e5e7eb;
      flex-shrink: 0;
    }
    .photo-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .hidden-input {
      display: none;
    }

    /* SUCCESS SCREEN */
    .success-icon {
      width: 64px;
      height: 64px;
      border-radius: 999px;
      background: #dcfce7;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      margin: 12px auto;
    }

    .success-text-main {
      font-size: 18px;
      font-weight: 600;
      text-align: center;
      margin-top: 6px;
    }

    .success-text-sub {
      font-size: 13px;
      color: #6b7280;
      text-align: center;
      margin-top: 4px;
      margin-bottom: 16px;
    }

    /* BOTTOM NAV */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      max-width: 480px;
      background: rgba(15, 23, 42, 0.03);
      padding: 6px 10px 10px;
    }

    .bottom-nav-inner {
      background: #ffffff;
      box-shadow: 0 6px 18px rgba(15, 23, 42, 0.15);
      border-radius: 999px;
      display: flex;
      justify-content: space-around;
      padding: 4px;
    }

    .nav-btn {
      flex: 1;
      border: none;
      background: transparent;
      border-radius: 999px;
      font-size: 12px;
      padding: 6px 0;
      color: #64748b;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      cursor: pointer;
    }

    .nav-btn span.icon {
      font-size: 14px;
    }

    .nav-btn.active {
      background: #1d4ed8;
      color: #ffffff;
      font-weight: 600;
    }

    /* HEADER –≤ –∫–∞—Ä—Ç–æ—á–∫–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è */
    .ad-view-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
    }

    .ad-view-back-btn {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      background: #ffffff;
      cursor: pointer;
      font-size: 18px;
    }

    .ad-view-header-title {
      font-size: 17px;
      font-weight: 600;
    }

    /* –ö–ê–†–¢–û–ß–ö–ê –û–ë–™–Ø–í–õ–ï–ù–ò–Ø (–¥–µ—Ç–∞–ª–∏) */
    .ad-view-card {
      background: #ffffff;
      border-radius: 20px;
      padding: 12px;
      box-shadow: 0 6px 18px rgba(15, 23, 42, 0.06);
    }

    /* –ì–ª–∞–≤–Ω–æ–µ —Ñ–æ—Ç–æ —Å–æ —Å–≤–∞–π–ø–æ–º */
    #detailMainImage {
      width: 100%;
      height: 260px;
      border-radius: 16px;
      background: #e5e7eb;
      margin-bottom: 12px;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      display: flex;
    }

    .detail-main-slide {
      min-width: 100%;
      height: 100%;
      flex-shrink: 0;
      scroll-snap-align: center;
      background-size: cover;
      background-position: center;
      border-radius: 16px;
    }

    .detail-thumbs {
      display: flex;
      gap: 8px;
      overflow-x: auto;
      margin-bottom: 10px;
    }

    .detail-thumb {
      width: 56px;
      height: 56px;
      border-radius: 12px;
      background: #e5e7eb;
      background-size: cover;
      background-position: center;
      flex-shrink: 0;
    }

    /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ + –∏–∫–æ–Ω–∫–∏ */
    .ad-view-title-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 8px;
      margin-top: 8px;
      margin-bottom: 4px;
    }

    .ad-view-title-box {
      flex: 1;
      min-width: 0;
    }

    .ad-view-icon-row {
      display: flex;
      gap: 8px;
      flex-shrink: 0;
    }

    .icon-circle-btn {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      background: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 17px;
      cursor: pointer;
      padding: 0;
    }
    .icon-circle-btn:active {
      transform: scale(0.96);
    }

    .ad-view-main-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .ad-view-price {
      font-size: 18px;
      font-weight: 700;
      color: #16a34a;
      margin-bottom: 2px;
    }

    .ad-view-promo {
      font-size: 12px;
      color: #ea580c;
      margin-bottom: 4px;
    }

    .ad-view-meta {
      font-size: 13px;
      color: #6b7280;
      margin-bottom: 2px;
    }

    .ad-view-stats {
      font-size: 12px;
      color: #6b7280;
      margin-bottom: 2px;
    }

    .ad-view-delivery {
      font-size: 13px;
      color: #475569;
      margin-bottom: 8px;
    }

    .ad-view-description-title {
      font-size: 14px;
      font-weight: 600;
      margin-top: 8px;
      margin-bottom: 4px;
    }

    .ad-view-description {
      font-size: 14px;
      color: #374151;
      margin-bottom: 8px;
    }

    .ad-view-seller-card {
      margin-top: 8px;
      padding: 10px;
      border-radius: 16px;
      background: #f9fafb;
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
    }

    .ad-view-seller-card:hover {
      background: #eef2ff;
    }

    .ad-view-seller-info-main {
      font-size: 14px;
      font-weight: 600;
    }

    .ad-view-seller-info-sub {
      font-size: 12px;
      color: #6b7280;
    }

    .ad-view-seller-status {
      font-size: 12px;
      color: #16a34a;
      margin-top: 2px;
    }

    .ad-view-actions-row {
      display: flex;
      gap: 10px;
      margin-top: 12px;
      align-items: stretch;
    }

    .call-btn,
    .msg-btn {
      flex: 1;
      padding: 13px 0;
      font-size: 15px;
      font-weight: 600;
      border-radius: 999px;
      text-align: center;
      text-decoration: none;
      color: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .call-btn {
      background: #22c55e;
    }

    .msg-btn {
      background: #3b82f6;
    }

    /* –ü–æ—Ö–æ–∂–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è */
    .similar-section {
      margin-top: 16px;
    }

    .similar-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .similar-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .similar-card {
      display: flex;
      gap: 8px;
      padding: 8px;
      border-radius: 12px;
      background: #f9fafb;
      cursor: pointer;
    }

    .similar-image {
      width: 52px;
      height: 52px;
      border-radius: 12px;
      background: #e5e7eb;
      background-size: cover;
      background-position: center;
      flex-shrink: 0;
    }

    .similar-content-title {
      font-size: 13px;
      font-weight: 600;
    }

    .similar-content-meta {
      font-size: 11px;
      color: #6b7280;
    }

    .similar-content-price {
      font-size: 13px;
      font-weight: 600;
      color: #16a34a;
    }

    /* –õ–∞–π—Ç–±–æ–∫—Å */
    .lightbox {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    .lightbox.visible {
      display: flex;
    }

    .lightbox img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    .lightbox-close-hint {
      position: absolute;
      bottom: 20px;
      left: 0;
      right: 0;
      text-align: center;
      color: rgba(255, 255, 255, 0.7);
      font-size: 12px;
    }

    .lightbox-arrow {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 40px;
      height: 40px;
      border-radius: 999px;
      border: none;
      background: rgba(15, 23, 42, 0.6);
      color: #ffffff;
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    .lightbox-prev {
      left: 12px;
    }

    .lightbox-next {
      right: 12px;
    }

    /* –§–ò–õ–¨–¢–†–´ –≠–ö–†–ê–ù */
    .filters-section-title {
      font-size: 14px;
      font-weight: 600;
      margin: 10px 0 6px;
    }

    .filters-actions-row {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 12px;
    }

    @media (max-width: 480px) {
      body {
        align-items: stretch;
      }
      .app {
        border-radius: 0;
        box-shadow: none;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- HEADER -->
    <header class="app-header">
      <div class="app-header-left">
        <img src="markethub-logo.png" alt="MarketHub" class="app-logo-small" />
        <div>
          <div class="app-title">MarketHub</div>
          <div class="app-subtitle">–£–∑–±–µ–∫–∏—Å—Ç–∞–Ω ¬∑ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</div>
        </div>
      </div>
    </header>

    <!-- SCREENS -->
    <div class="screens">
      <!-- HOME (–≥–ª–∞–≤–Ω–∞—è –ª–µ–Ω—Ç–∞) -->
      <section class="screen active" id="screen-home">
        <div class="screen-title">–õ–µ–Ω—Ç–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π</div>

        <div class="search-bar-row">
          <div class="search-bar">
            <input
              type="text"
              class="search-input"
              placeholder="–ù–∞–π—Ç–∏ —Ç–æ–≤–∞—Ä –∏–ª–∏ —É—Å–ª—É–≥—É..."
            />
          </div>
          <button class="filters-btn" id="openFiltersBtn">
            ‚öôÔ∏è –§–∏–ª—å—Ç—Ä—ã
          </button>
        </div>

        <div class="quick-actions-title">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</div>
                <button class="primary-btn" id="btnOpenNewAd">
          <span>Ôºã</span> –ü–æ–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
        </button>

        <!-- –ü–†–û–ú–û-–ë–ê–ù–ù–ï–† (–∫–∞–∫ –Ω–∞ –ê–≤–∏—Ç–æ) -->
        <div class="promo-banner" id="promoBanner">
          <img src="markethub-promo-banner.jpg" alt="MarketHub ‚Äî biznesingiz uchun yangi mijozlar" />
        </div>

        <!-- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
        <h2 class="section-title" style="margin-top:12px;">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</h2>
        <div class="category-grid" id="homeCategoryGrid">
          <div class="category-card" data-type="–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç">
            <div class="category-card-title">üöó –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</div>
            <div class="category-card-sub">–õ–µ–≥–∫–æ–≤—ã–µ, —Å–ø–µ—Ü—Ç–µ—Ö–Ω–∏–∫–∞</div>
          </div>
          <div class="category-card" data-type="–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å">
            <div class="category-card-title">üè† –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</div>
            <div class="category-card-sub">–ö–≤–∞—Ä—Ç–∏—Ä—ã, –¥–æ–º–∞</div>
          </div>
          <div class="category-card" data-type="–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞">
            <div class="category-card-title">üì± –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</div>
            <div class="category-card-sub">–¢–µ–ª–µ—Ñ–æ–Ω—ã, —Ç–µ—Ö–Ω–∏–∫–∞</div>
          </div>
          <div class="category-card" data-type="–£—Å–ª—É–≥–∏">
            <div class="category-card-title">üõ† –£—Å–ª—É–≥–∏</div>
            <div class="category-card-sub">–ú–∞—Å—Ç–µ—Ä–∞, —Ä–µ–º–æ–Ω—Ç</div>
          </div>
        </div>

        <p class="hint" style="margin-top:6px;">
  –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –µ—â—ë —Ä–∞–∑, —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
</p>
        
        <h2 class="section-title" style="margin-top:10px;">–í—Å–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</h2>
        <div id="feedList" class="ad-list grid-mode"></div>
      </section>

      <!-- FAVORITES -->
      <section class="screen" id="screen-favorites">
        <div class="screen-title">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</div>
        <div id="favoritesList" class="ad-list grid-mode"></div>
      </section>

      <!-- PROFILE SCREEN -->
      <section class="screen" id="screen-profile">
        <div class="screen-title">–ü—Ä–æ—Ñ–∏–ª—å –ø—Ä–æ–¥–∞–≤—Ü–∞</div>

        <div class="profile-card">
          <div class="profile-header">
            <div class="avatar">B</div>
            <div>
              <div class="profile-name">Baxir B-R</div>
              <div class="profile-username">@Baxir1987 ¬∑ –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω</div>
              <div class="profile-rating">‚≠ê 4,9 –∏–∑ 5 ¬∑ 23 –æ—Ç–∑—ã–≤–∞</div>
            </div>
          </div>

          <div class="profile-desc">
            ¬´–ö—Ä–∞—Å–∫–∞ ‚Äî –º–æ—ë –¥—ã—Ö–∞–Ω–∏–µ¬ª. –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ –∫—É–∑–æ–≤–Ω–æ–π –ø–æ–∫—Ä–∞—Å–∫–µ
            –∏ —á–µ—Å—Ç–Ω–æ–π –ø—Ä–æ–¥–∞–∂–µ. –í—Å–µ–≥–¥–∞ –Ω–∞ —Å–≤—è–∑–∏, –±–µ–∑ –æ–±–º–∞–Ω–∞.
          </div>

          <div class="profile-actions">
            <button class="outline-btn">üí¨ –ù–∞–ø–∏—Å–∞—Ç—å</button>
            <button class="secondary-btn">‚≠ê –û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
          </div>
        </div>

        <div class="profile-section-title">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</div>
        <div class="ad-list">
          <article class="ad-card">
            <div class="ad-image"></div>
            <div class="ad-content">
              <div class="ad-title">–®–∞–º–ø—É–Ω—å –æ—Ç –ø–µ—Ä—Ö–æ—Ç–∏</div>
              <div class="ad-meta">üìç –¢–∞—à–∫–µ–Ω—Ç ¬∑ –¢–æ–≤–∞—Ä ¬∑ 2 –¥–Ω—è –Ω–∞–∑–∞–¥</div>
              <div class="ad-price">150 000 —Å—É–º</div>
            </div>
          </article>

          <article class="ad-card">
            <div class="ad-image"></div>
            <div class="ad-content">
              <div class="ad-title">–ü–æ–ª–∏—Ä–æ–≤–∫–∞ –∫—É–∑–æ–≤–∞ ¬∑ —É—Å–ª—É–≥–∞</div>
              <div class="ad-meta">üìç –¢–∞—à–∫–µ–Ω—Ç ¬∑ –£—Å–ª—É–≥–∞ ¬∑ 5 –¥–Ω–µ–π –Ω–∞–∑–∞–¥</div>
              <div class="ad-price">–æ—Ç 300 000 —Å—É–º</div>
            </div>
          </article>
        </div>
      </section>

      <!-- FILTERS SCREEN -->
      <section class="screen" id="screen-filters">
        <div class="back-link" id="filtersBack">‚Üê –ù–∞–∑–∞–¥ –∫ –ª–µ–Ω—Ç–µ</div>
        <div class="screen-title">–§–∏–ª—å—Ç—Ä—ã</div>

        <div class="filters-section-title">–¢–∏–ø –æ–±—ä—è–≤–ª–µ–Ω–∏—è</div>
        <div class="chip-row" id="filterTypeRow">
          <button class="chip chip-filled" data-type="all">–í—Å–µ</button>
          <button class="chip" data-type="–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç">üöó –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</button>
          <button class="chip" data-type="–û–¥–µ–∂–¥–∞">üëï –û–¥–µ–∂–¥–∞</button>
          <button class="chip" data-type="–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞">üì± –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</button>
          <button class="chip" data-type="–ñ–∏–≤–æ—Ç–Ω—ã–µ">üêæ –ñ–∏–≤–æ—Ç–Ω—ã–µ</button>
          <button class="chip" data-type="–†–∞–±–æ—Ç–∞">üíº –†–∞–±–æ—Ç–∞</button>
          <button class="chip" data-type="–ó–∞–ø—á–∞—Å—Ç–∏ –∏ –∞–∫—Å–µ—Å—Å—É–∞—Ä—ã">üîß –ó–∞–ø—á–∞—Å—Ç–∏ –∏ –∞–∫—Å–µ—Å—Å—É–∞—Ä—ã</button>
          <button class="chip" data-type="–ì–æ—Ç–æ–≤—ã–π –±–∏–∑–Ω–µ—Å –∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ">üè≠ –ì–æ—Ç–æ–≤—ã–π –±–∏–∑–Ω–µ—Å</button>
          <button class="chip" data-type="–ü–æ–¥—Ä–∞–±–æ—Ç–∫–∞">‚è± –ü–æ–¥—Ä–∞–±–æ—Ç–∫–∞</button>
          <button class="chip" data-type="–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è">‚úàÔ∏è –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è</button>
        </div>

        <div class="filters-section-title">–ì–æ—Ä–æ–¥</div>
        <select class="form-select" id="filterCity">
          <option value="all">–í—Å—è —Å—Ç—Ä–∞–Ω–∞</option>
          <option>–¢–∞—à–∫–µ–Ω—Ç</option>
          <option>–°–∞–º–∞—Ä–∫–∞–Ω–¥</option>
          <option>–§–µ—Ä–≥–∞–Ω–∞</option>
          <option>–ù–∞–º–∞–Ω–≥–∞–Ω</option>
          <option>–ê–Ω–¥–∏–∂–∞–Ω</option>
          <option>–ë—É—Ö–∞—Ä–∞</option>
          <option>–ù–∞–≤–æ–∏</option>
          <option>–ö–∞—Ä—à–∏</option>
          <option>–¢–µ—Ä–º–µ–∑</option>
          <option>–î–∂–∏–∑–∞–∫</option>
          <option>–ì—É–ª–∏—Å—Ç–∞–Ω</option>
          <option>–•–∏–≤–∞</option>
        </select>

        <div class="filters-section-title">–í–∞–ª—é—Ç–∞</div>
        <div class="chip-row" id="filterCurrencyRow">
          <button class="chip chip-filled" data-currency="sum">–°—É–º</button>
          <button class="chip" data-currency="usd">USD</button>
        </div>

        <div class="filters-section-title">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ</div>
        <div class="chip-row">
          <button class="chip" id="filterPhotoChip">üì∑ –¢–æ–ª—å–∫–æ —Å —Ñ–æ—Ç–æ</button>
        </div>

        <div class="filters-section-title">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</div>
        <div class="form-group">
          <select class="form-select" id="filterSort">
            <option value="default">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</option>
            <option value="date">–ü–æ –¥–∞—Ç–µ</option>
            <option value="cheap">–î–µ—à–µ–≤–ª–µ</option>
            <option value="expensive">–î–æ—Ä–æ–∂–µ</option>
          </select>
        </div>

        <div class="filters-actions-row">
          <button class="primary-btn" id="filtersApplyBtn">
            –ü–æ–∫–∞–∑–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è
          </button>
          <button class="outline-btn" id="filtersResetBtn">
            –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
          </button>
        </div>
      </section>

      <!-- NEW AD STEP 1 -->
      <section class="screen" id="screen-new-ad-step1">
        <div class="back-link" id="backFromNewAd1">‚Üê –ù–∞–∑–∞–¥ –∫ –ª–µ–Ω—Ç–µ</div>
        <div class="screen-title">
          –ù–æ–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ <span class="step-tag">–®–∞–≥ 1 –∏–∑ 3</span>
        </div>

        <div class="form-group" style="margin-top: 10px;">
          <label class="form-label">–¢–∏–ø –æ–±—ä—è–≤–ª–µ–Ω–∏—è</label>
          <div class="chip-row" id="adTypeChips">
            <button class="chip chip-filled" data-type="–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç">üöó –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</button>
            <button class="chip" data-type="–û–¥–µ–∂–¥–∞">üëï –û–¥–µ–∂–¥–∞</button>
            <button class="chip" data-type="–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞">üì± –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</button>
            <button class="chip" data-type="–ñ–∏–≤–æ—Ç–Ω—ã–µ">üêæ –ñ–∏–≤–æ—Ç–Ω—ã–µ</button>
            <button class="chip" data-type="–†–∞–±–æ—Ç–∞">üíº –†–∞–±–æ—Ç–∞</button>
            <button class="chip" data-type="–ó–∞–ø—á–∞—Å—Ç–∏ –∏ –∞–∫—Å–µ—Å—Å—É–∞—Ä—ã">üîß –ó–∞–ø—á–∞—Å—Ç–∏ –∏ –∞–∫—Å–µ—Å—Å—É–∞—Ä—ã</button>
            <button class="chip" data-type="–ì–æ—Ç–æ–≤—ã–π –±–∏–∑–Ω–µ—Å –∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ">üè≠ –ì–æ—Ç–æ–≤—ã–π –±–∏–∑–Ω–µ—Å</button>
            <button class="chip" data-type="–ü–æ–¥—Ä–∞–±–æ—Ç–∫–∞">‚è± –ü–æ–¥—Ä–∞–±–æ—Ç–∫–∞</button>
            <button class="chip" data-type="–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è">‚úàÔ∏è –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è</button>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">–ì–æ—Ä–æ–¥</label>
          <select class="form-select" id="inputCity">
            <option>–¢–∞—à–∫–µ–Ω—Ç</option>
            <option>–°–∞–º–∞—Ä–∫–∞–Ω–¥</option>
            <option>–§–µ—Ä–≥–∞–Ω–∞</option>
            <option>–ù–∞–º–∞–Ω–≥–∞–Ω</option>
            <option>–ë—É—Ö–∞—Ä–∞</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
          <input class="form-input" id="inputTitle" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: ¬´iPhone 13 Pro, –∫–∞–∫ –Ω–æ–≤—ã–π¬ª" />
        </div>

        <div class="form-group">
          <label class="form-label">–¶–µ–Ω–∞ (–≤ —Å—É–º–∞—Ö)</label>
          <input class="form-input" id="inputPrice" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 10 500 000" />
          <div class="hint">–í–∞–ª—é—Ç–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è: —Å—É–º. –ù–∞ —Å–∞–π—Ç–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤ —Å—É–º –∏–ª–∏ USD.</div>
        </div>

        <div class="form-group">
          <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
          <textarea class="form-textarea" id="inputDescription" placeholder="–ö–æ—Ä–æ—Ç–∫–æ –æ–ø–∏—à–∏—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –¥–µ—Ç–∞–ª–∏..."></textarea>
        </div>

        <button class="primary-btn" id="btnNewAdStep1Next">
          –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å ¬∑ —à–∞–≥ 2
        </button>
      </section>

      <!-- NEW AD STEP 2 -->
      <section class="screen" id="screen-new-ad-step2">
        <div class="back-link" id="backFromNewAd2">‚Üê –ù–∞–∑–∞–¥ ¬∑ —à–∞–≥ 1</div>
        <div class="screen-title">
          –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ <span class="step-tag">–®–∞–≥ 2 –∏–∑ 3</span>
        </div>

        <div class="form-group" style="margin-top: 10px;">
          <label class="form-label">–î–æ–±–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞ –∏–ª–∏ —É—Å–ª—É–≥–∏</label>
          <button class="outline-btn" id="btnUploadPhotos">üì∏ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</button>
          <input
            type="file"
            accept="image/*"
            multiple
            id="inputPhotos"
            class="hidden-input"
          />
          <div class="hint">
            –ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ 8 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π.
          </div>
          <div class="photos-preview-row" id="photosPreview"></div>
        </div>

        <button class="primary-btn" id="btnNewAdStep2Next">
          –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å ¬∑ —à–∞–≥ 3
        </button>
      </section>

      <!-- NEW AD STEP 3 -->
      <section class="screen" id="screen-new-ad-step3">
        <div class="back-link" id="backFromNewAd3">‚Üê –ù–∞–∑–∞–¥ ¬∑ —à–∞–≥ 2</div>
        <div class="screen-title">
          –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ <span class="step-tag">–®–∞–≥ 3 –∏–∑ 3</span>
        </div>

        <div class="profile-card" id="newAdSummaryCard">
          <div class="profile-header">
            <div class="ad-image"></div>
            <div>
              <div class="profile-name" id="summaryTitle">–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</div>
              <div class="profile-username" id="summaryCityType">–ì–æ—Ä–æ–¥ ¬∑ –¢–∏–ø</div>
              <div class="profile-rating" id="summaryPrice">–¶–µ–Ω–∞</div>
            </div>
          </div>
          <div class="profile-desc" id="summaryDescription">
            –û–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è...
          </div>
          <div class="ad-photos-count" id="summaryPhotosInfo" style="margin-top:8px;">
            –§–æ—Ç–æ: 0 —à—Ç.
          </div>
        </div>

        <div class="hint">
          –ü–æ—Å–ª–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –ø–æ—è–≤–∏—Ç—Å—è –≤ –ª–µ–Ω—Ç–µ.
        </div>

        <button class="primary-btn" id="btnPublishAd" style="margin-top: 10px;">
          –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
        </button>
      </section>

      <!-- NEW AD SUCCESS -->
      <section class="screen" id="screen-new-ad-success">
        <div class="success-icon">‚úÖ</div>
        <div class="success-text-main">–û–±—ä—è–≤–ª–µ–Ω–∏–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ!</div>
        <div class="success-text-sub">
          –í –¥–µ–º–æ-–≤–µ—Ä—Å–∏–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –æ–±—â—É—é –ª–µ–Ω—Ç—É.
        </div>

        <button class="primary-btn" id="btnGoToFeed">
          üìã –ü–µ—Ä–µ–π—Ç–∏ –∫ –ª–µ–Ω—Ç–µ
        </button>
        <button class="outline-btn" id="btnGoHome" style="margin-top: 8px;">
          üè† –ù–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
        </button>
      </section>

      <!-- AD DETAILS SCREEN -->
      <section class="screen" id="screen-ad-details" style="padding:12px;">
        <div class="ad-view-header">
          <button class="ad-view-back-btn" id="detailBackBtn">‚Üê</button>
          <span class="ad-view-header-title">–û–±—ä—è–≤–ª–µ–Ω–∏–µ</span>
        </div>

        <div class="ad-view-card">
          <!-- –ì–ª–∞–≤–Ω–æ–µ —Ñ–æ—Ç–æ (—Å–ª–∞–π–¥–µ—Ä) -->
          <div class="detail-main-image" id="detailMainImage"></div>

          <!-- –ú–∞–ª–µ–Ω—å–∫–∏–µ –ø—Ä–µ–≤—å—é -->
          <div class="detail-thumbs" id="detailThumbs"></div>

          <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ + —Ü–µ–Ω–∞ + –∏–∫–æ–Ω–∫–∏ -->
          <div class="ad-view-title-row">
            <div class="ad-view-title-box">
              <div class="ad-view-main-title" id="detailTitle">–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</div>
              <div class="ad-view-price" id="detailPrice">0 —Å—É–º</div>
              <div class="ad-view-promo" id="detailPromo"></div>
            </div>
            <div class="ad-view-icon-row">
              <button
                class="icon-circle-btn"
                id="favoriteBtn"
                type="button"
                aria-label="–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ"
              >
                ‚ô°
              </button>
              <button
                class="icon-circle-btn"
                id="shareBtn"
                type="button"
                aria-label="–ü–æ–¥–µ–ª–∏—Ç—å—Å—è"
              >
                ‚§¥Ô∏é
              </button>
            </div>
          </div>

          <!-- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ -->
          <div class="ad-view-meta" id="detailMeta">–¢–∞—à–∫–µ–Ω—Ç ¬∑ –¢–æ–≤–∞—Ä—ã</div>
          <div class="ad-view-stats" id="detailStats">124 –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ ¬∑ 8 –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–º</div>
          <div class="ad-view-delivery" id="detailDelivery">–î–æ—Å—Ç–∞–≤–∫–∞: –µ—Å—Ç—å</div>

          <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
          <div class="ad-view-description-title">–û–ø–∏—Å–∞–Ω–∏–µ</div>
          <div class="ad-view-description" id="detailDescription">
            –ó–¥–µ—Å—å –±—É–¥–µ—Ç —Ç–µ–∫—Å—Ç –æ–ø–∏—Å–∞–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è.
          </div>

          <!-- –ü—Ä–æ–¥–∞–≤–µ—Ü -->
          <div class="ad-view-seller-card" id="sellerCard">
            <div class="avatar">B</div>
            <div>
              <div class="ad-view-seller-info-main">Baxir B-R (@Baxir1987)</div>
              <div class="ad-view-seller-info-sub">
                ‚≠ê 4,9 ¬∑ 23 –æ—Ç–∑—ã–≤–∞ ¬∑ 12 –æ–±—ä—è–≤–ª–µ–Ω–∏–π
              </div>
              <div class="ad-view-seller-status">–û–Ω–ª–∞–π–Ω –Ω–µ–¥–∞–≤–Ω–æ ¬∑ ‚ö° –û—Ç–≤–µ—á–∞–µ—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ 10 –º–∏–Ω—É—Ç</div>
            </div>
          </div>

          <!-- –ö–Ω–æ–ø–∫–∏ —Å–≤—è–∑–∏ -->
          <div class="ad-view-actions-row">
            <a class="call-btn" id="callSellerBtn" href="#">–ü–æ–∑–≤–æ–Ω–∏—Ç—å</a>
            <a class="msg-btn" id="msgSellerBtn" href="#">–ù–∞–ø–∏—Å–∞—Ç—å</a>
          </div>

          <!-- –ü–æ—Ö–æ–∂–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è -->
          <div class="similar-section">
            <div class="similar-title">–ü–æ—Ö–æ–∂–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</div>
            <div class="similar-list" id="similarList"></div>
          </div>
        </div>
      </section>
    </div>

    <!-- FULLSCREEN IMAGE LIGHTBOX -->
    <div id="imageLightbox" class="lightbox">
      <button class="lightbox-arrow lightbox-prev" id="lightboxPrev">‚Äπ</button>
      <img id="lightboxImg" src="" alt="–§–æ—Ç–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è" />
      <button class="lightbox-arrow lightbox-next" id="lightboxNext">‚Ä∫</button>
      <div class="lightbox-close-hint">–°–º–∞—Ö–Ω–∏—Ç–µ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è</div>
    </div>

    <!-- BOTTOM NAV -->
    <nav class="bottom-nav">
      <div class="bottom-nav-inner">
        <button class="nav-btn active" data-screen="home">
          <span class="icon">üè†</span>
          <span>–õ–µ–Ω—Ç–∞</span>
        </button>
        <button class="nav-btn" data-screen="favorites">
          <span class="icon">‚≠ê</span>
          <span>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
        </button>
        <button class="nav-btn" data-screen="profile">
          <span class="icon">üë§</span>
          <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
        </button>
      </div>
    </nav>
  </div>

  <script>
  // ==== API URL ====
  const ADS_API_URL = "https://baxir.pythonanywhere.com/ads";
  const ADD_AD_API_URL = "https://baxir.pythonanywhere.com/api/add_ad";

  // ==== –ö–æ–Ω—Ç–∞–∫—Ç—ã –ø—Ä–æ–¥–∞–≤—Ü–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ====
  const DEFAULT_PHONE = "+998901234567"; // –ø–æ–º–µ–Ω—è–µ—à—å –Ω–∞ —Å–≤–æ–π
  const DEFAULT_TELEGRAM = "Baxir1987";  // –ë–ï–ó @

  // ==== –ö—É—Ä—Å –≤–∞–ª—é—Ç—ã (1 USD = X —Å—É–º) ====
  const EXCHANGE_RATE = 12500; // –∫–æ–≥–¥–∞ –∫—É—Ä—Å –∏–∑–º–µ–Ω–∏—Ç—Å—è ‚Äî –º–µ–Ω—è–µ—à—å –∑–¥–µ—Å—å

  // ==== ImgBB ====
  const IMGBB_API_KEY = "d6a3eac7b36101df3effee3f7d0c7493";
  const IMGBB_UPLOAD_URL = "https://api.imgbb.com/1/upload";

  // ==== DOM-—ç–ª–µ–º–µ–Ω—Ç—ã ====
  const screensContainer = document.querySelector(".screens");

  const homeScreen = document.getElementById("screen-home");
  const feedList = document.getElementById("feedList");

  const favoritesScreen = document.getElementById("screen-favorites");
  const favoritesList = document.getElementById("favoritesList");

  const profileScreen = document.getElementById("screen-profile");
  const filtersScreen = document.getElementById("screen-filters");

  const searchInput = document.querySelector(".search-input");
  const openFiltersBtn = document.getElementById("openFiltersBtn");

  const homeCategoryGrid = document.getElementById("homeCategoryGrid");

  // Filters UI
  const filterTypeRow = document.getElementById("filterTypeRow");
  const filterCitySelect = document.getElementById("filterCity");
  const filterCurrencyRow = document.getElementById("filterCurrencyRow");
  const filterPhotoChip = document.getElementById("filterPhotoChip");
  const filterSortSelect = document.getElementById("filterSort");
  const filtersApplyBtn = document.getElementById("filtersApplyBtn");
  const filtersResetBtn = document.getElementById("filtersResetBtn");
  const filtersBackBtn = document.getElementById("filtersBack");

  // New ad screens
  const inputCity = document.getElementById("inputCity");
  const inputTitle = document.getElementById("inputTitle");
  const inputPrice = document.getElementById("inputPrice");
  const inputDescription = document.getElementById("inputDescription");
  const btnOpenNewAd = document.getElementById("btnOpenNewAd");
  const btnNewAdStep1Next = document.getElementById("btnNewAdStep1Next");
  const backFromNewAd1 = document.getElementById("backFromNewAd1");

  const btnUploadPhotos = document.getElementById("btnUploadPhotos");
  const inputPhotos = document.getElementById("inputPhotos");
  const photosPreview = document.getElementById("photosPreview");
  const btnNewAdStep2Next = document.getElementById("btnNewAdStep2Next");
  const backFromNewAd2 = document.getElementById("backFromNewAd2");

  const backFromNewAd3 = document.getElementById("backFromNewAd3");
  const btnPublishAd = document.getElementById("btnPublishAd");
  const summaryTitle = document.getElementById("summaryTitle");
  const summaryCityType = document.getElementById("summaryCityType");
  const summaryPrice = document.getElementById("summaryPrice");
  const summaryDescription = document.getElementById("summaryDescription");
  const summaryPhotosInfo = document.getElementById("summaryPhotosInfo");

  const btnGoToFeed = document.getElementById("btnGoToFeed");
  const btnGoHome = document.getElementById("btnGoHome");

  const adTypeChips = document.querySelectorAll("#adTypeChips .chip");

  // Details screen
  const screenAdDetails = document.getElementById("screen-ad-details");
  const detailMainImage = document.getElementById("detailMainImage");
  const detailThumbs = document.getElementById("detailThumbs");
  const detailTitle = document.getElementById("detailTitle");
  const detailPrice = document.getElementById("detailPrice");
  const detailMeta = document.getElementById("detailMeta");
  const detailDescription = document.getElementById("detailDescription");
  const detailBackBtn = document.getElementById("detailBackBtn");
  const callSellerBtn = document.getElementById("callSellerBtn");
  const msgSellerBtn = document.getElementById("msgSellerBtn");
  const similarList = document.getElementById("similarList");
  const favoriteBtn = document.getElementById("favoriteBtn");
  const shareBtn = document.getElementById("shareBtn");
  const sellerCard = document.getElementById("sellerCard");

  // Lightbox
  const imageLightbox = document.getElementById("imageLightbox");
  const lightboxImg = document.getElementById("lightboxImg");
  const lightboxPrev = document.getElementById("lightboxPrev");
  const lightboxNext = document.getElementById("lightboxNext");

  // ========== –ì–õ–û–ë–ê–õ–¨–ù–û–ï –°–û–°–¢–û–Ø–ù–ò–ï ==========

  let allAds = [];
  let filteredAds = [];
  let searchQuery = "";

  // —Ñ–∏–ª—å—Ç—Ä—ã
  const filterState = {
    type: "all",        // –¢–æ–≤–∞—Ä / –£—Å–ª—É–≥–∞ / –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å (—Ñ–∏–ª—å—Ç—Ä –≤ —ç–∫—Ä–∞–Ω–µ –§–∏–ª—å—Ç—Ä—ã)
    city: "all",
    currency: "sum",    // sum | usd
    onlyWithPhoto: false,
    sort: "default",    // default | date | cheap | expensive
    category: "all",    // –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç / –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å / –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞ / –£—Å–ª—É–≥–∏ (–ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –±–æ–∫—Å—ã)
  };

  // –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
  const FAVORITES_KEY = "mh_favorites";
  let favoritesSet = loadFavoritesFromStorage();

  // —á–µ—Ä–Ω–æ–≤–∏–∫ –Ω–æ–≤–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
  const newAdDraft = {
    type: "–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç",
    city: "–¢–∞—à–∫–µ–Ω—Ç",
    title: "",
    price: "",
    description: "",
    photoCount: 0,
    photos: [],
  };

  let currentAdInDetails = null;

  // Lightbox —Å–æ—Å—Ç–æ—è–Ω–∏–µ
  let lightboxImages = [];
  let lightboxIndex = 0;

  // ===== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò =====

  function formatNumberWithSpaces(num) {
    const s = String(num);
    return s.replace(/\B(?=(\d{3})+(?!\d))/g, " ");
  }

  function formatPrice(price) {
    if (price === null || price === undefined || price === "") {
      return "Narx kelishiladi";
    }
    const p = Number(price || 0);
    if (!isFinite(p) || p <= 0) {
      return "Narx kelishiladi";
    }

    if (filterState.currency === "usd") {
      const usd = p / EXCHANGE_RATE;
      const rounded = Math.round(usd * 100) / 100;
      return formatNumberWithSpaces(rounded) + " USD";
    }

    // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å—É–º
    return formatNumberWithSpaces(p) + " —Å—É–º";
  }

  function formatDateShort(iso) {
    if (!iso) return "";
    try {
      const d = new Date(iso);
      const day = String(d.getDate()).padStart(2, "0");
      const month = String(d.getMonth() + 1).padStart(2, "0");
      return `${day}.${month}`;
    } catch (e) {
      return "";
    }
  }

  // localStorage –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
  function loadFavoritesFromStorage() {
    try {
      const raw = localStorage.getItem(FAVORITES_KEY);
      if (!raw) return new Set();
      const arr = JSON.parse(raw);
      if (!Array.isArray(arr)) return new Set();
      return new Set(arr);
    } catch (e) {
      return new Set();
    }
  }

  function saveFavoritesToStorage() {
    try {
      localStorage.setItem(FAVORITES_KEY, JSON.stringify(Array.from(favoritesSet)));
    } catch (e) {}
  }

  // ===== –°–û–ó–î–ê–ù–ò–ï –ö–ê–†–¢–û–ß–ï–ö =====

  function createTileCard(ad) {
    const card = document.createElement("article");
    card.className = "ad-card";

    const title = ad.title || "E'lon";
    const city = ad.city || "Shahar";
    const type = ad.type || "Tovar";
    const priceText = formatPrice(ad.price);
    const created = formatDateShort(ad.created_at);
    const firstImage =
      ad.images && Array.isArray(ad.images) && ad.images.length > 0
        ? ad.images[0]
        : null;

    card.innerHTML = `
      <div class="ad-image"
        ${
          firstImage
            ? `style="background-image:url('${firstImage}');background-size:cover;background-position:center;"`
            : ""
        }></div>
      <div class="ad-content">
        <div class="ad-title">${title}</div>
        <div class="ad-meta">
          üìç ${city} ¬∑ ${type}${created ? ` ¬∑ ${created}` : ""}
        </div>
        <div class="ad-price">${priceText}</div>
      </div>
    `;

    card.addEventListener("click", () => openAdDetails(ad));
    return card;
  }

  // ===== –§–ò–õ–¨–¢–†–´ + –†–ï–ù–î–ï–† –õ–ï–ù–¢–´ =====

  function applyAllFilters() {
    if (!allAds.length) {
      filteredAds = [];
      return;
    }

    const q = searchQuery.trim().toLowerCase();

    filteredAds = allAds.filter((ad) => {
      // —Ç–∏–ø (–¢–æ–≤–∞—Ä / –£—Å–ª—É–≥–∞ / –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å) –∏–∑ —ç–∫—Ä–∞–Ω–∞ –§–∏–ª—å—Ç—Ä—ã
      if (filterState.type !== "all" && ad.type !== filterState.type) {
        return false;
      }

      // –∫–∞—Ç–µ–≥–æ—Ä–∏—è (–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç / –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å / –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞ / –£—Å–ª—É–≥–∏) –∏–∑ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –±–æ–∫—Å–æ–≤
      if (filterState.category !== "all") {
        if ((ad.category || "").trim() !== filterState.category) return false;
      }

      // –≥–æ—Ä–æ–¥
      if (filterState.city !== "all") {
        if ((ad.city || "").trim() !== filterState.city) return false;
      }

      // —Ç–æ–ª—å–∫–æ —Å —Ñ–æ—Ç–æ
      if (filterState.onlyWithPhoto) {
        if (!ad.images || !Array.isArray(ad.images) || ad.images.length === 0) {
          return false;
        }
      }

      // –ø–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏ –æ–ø–∏—Å–∞–Ω–∏—é
      if (q) {
        const text = String(ad.title || "") + " " + String(ad.description || "");
        if (!text.toLowerCase().includes(q)) return false;
      }

      return true;
    });

    // —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
    filteredAds.sort((a, b) => {
      const pa = Number(a.price || 0);
      const pb = Number(b.price || 0);
      const da = a.created_at ? new Date(a.created_at).getTime() : 0;
      const db = b.created_at ? new Date(b.created_at).getTime() : 0;

      switch (filterState.sort) {
        case "cheap":
          return pa - pb;
        case "expensive":
          return pb - pa;
        case "date":
        case "default":
        default:
          return db - da; // –Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É
      }
    });
  }

  function renderFeed() {
    if (!feedList) return;
    feedList.innerHTML = "";

    if (!filteredAds.length) {
      feedList.innerHTML =
        "<div class='ad-meta'>–ü–æ–¥—Ö–æ–¥—è—â–∏—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π –Ω–µ—Ç. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∏–ª–∏ –ø–æ–∏—Å–∫.</div>";
      return;
    }

    filteredAds.forEach((ad) => {
      feedList.appendChild(createTileCard(ad));
    });
  }

  function renderFavorites() {
    if (!favoritesList) return;
    favoritesList.innerHTML = "";

    const favIds = Array.from(favoritesSet);
    if (!allAds.length || !favIds.length) {
      favoritesList.innerHTML =
        "<div class='ad-meta'>–í –∏–∑–±—Ä–∞–Ω–Ω–æ–º –ø–æ–∫–∞ –ø—É—Å—Ç–æ. –û—Ç–∫—Ä–æ–π—Ç–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –∏ –Ω–∞–∂–º–∏—Ç–µ ‚ô°, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å.</div>";
      return;
    }

    const favAds = allAds.filter((ad) => favIds.includes(ad.id));
    if (!favAds.length) {
      favoritesList.innerHTML =
        "<div class='ad-meta'>–í –∏–∑–±—Ä–∞–Ω–Ω–æ–º –ø–æ–∫–∞ –ø—É—Å—Ç–æ.</div>";
      return;
    }

    favAds.forEach((ad) => {
      favoritesList.appendChild(createTileCard(ad));
    });
  }

  // ===== –ó–ê–ì–†–£–ó–ö–ê –û–ë–™–Ø–í–õ–ï–ù–ò–ô =====

  async function loadAds() {
    try {
      const res = await fetch(ADS_API_URL);
      if (!res.ok) throw new Error("Bad response");
      const data = await res.json();
      if (!Array.isArray(data)) return;

      allAds = data;
      applyAllFilters();
      renderFeed();
      renderFavorites();
    } catch (err) {
      console.error("Xato yuklashda:", err);
      if (feedList) {
        feedList.innerHTML =
          "<div class='ad-meta'>E'lonlarni yuklashda xatolik. Keyinroq urinib ko'ring.</div>";
      }
      if (favoritesList) {
        favoritesList.innerHTML =
          "<div class='ad-meta'>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</div>";
      }
    }
  }

  // ===== –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –≠–ö–†–ê–ù–û–í =====

  const screens = {
    home: homeScreen,
    favorites: favoritesScreen,
    profile: profileScreen,
    filters: filtersScreen,
    newAd1: document.getElementById("screen-new-ad-step1"),
    newAd2: document.getElementById("screen-new-ad-step2"),
    newAd3: document.getElementById("screen-new-ad-step3"),
    newAdSuccess: document.getElementById("screen-new-ad-success"),
    adDetails: screenAdDetails,
  };

  function showScreen(name) {
    Object.values(screens).forEach((el) => {
      if (!el) return;
      el.classList.remove("active");
      el.style.display = "none";
    });

    const target = screens[name];
    if (target) {
      target.classList.add("active");
      target.style.display = "block";
    }

    // –Ω–∏–∂–Ω–µ–µ –º–µ–Ω—é
    document
      .querySelectorAll(".nav-btn")
      .forEach((btn) => btn.classList.remove("active"));
    const activeBtn = document.querySelector(
      '.nav-btn[data-screen="' + name + '"]'
    );
    if (activeBtn) activeBtn.classList.add("active");

    if (screensContainer) {
      screensContainer.scrollTop = 0;
    }

    // –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ ‚Äî –ø–æ–¥—Ç—è–Ω—É—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    if (name === "filters") {
      syncFiltersUIFromState();
    }

    // –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ ‚Äî –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å
    if (name === "favorites") {
      renderFavorites();
    }
  }

  // –Ω–∏–∂–Ω–µ–µ –º–µ–Ω—é
  document.querySelectorAll(".nav-btn").forEach((btn) => {
    btn.addEventListener("click", () => {
      const target = btn.getAttribute("data-screen");
      showScreen(target);
    });
  });

  // ===== –ü–û–ò–°–ö =====

  if (searchInput) {
    searchInput.addEventListener("input", (e) => {
      searchQuery = (e.target.value || "").toLowerCase();
      applyAllFilters();
      renderFeed();
    });
  }

  // ===== –ü–û–ü–£–õ–Ø–†–ù–´–ï –ö–ê–¢–ï–ì–û–†–ò–ò –ù–ê –ì–õ–ê–í–ù–û–ô =====

  const popularCategoryCards = document.querySelectorAll(".category-card");
  let activeCategoryType = null;

  popularCategoryCards.forEach((card) => {
    const type = card.getAttribute("data-type");

    card.addEventListener("click", () => {
      if (!type) return;

      // –µ—Å–ª–∏ —ç—Ç–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è —É–∂–µ –∞–∫—Ç–∏–≤–Ω–∞ ‚Äî —Å–Ω–∏–º–∞–µ–º —Ñ–∏–ª—å—Ç—Ä (–ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è)
      if (activeCategoryType === type) {
        activeCategoryType = null;
        filterState.category = "all";
        popularCategoryCards.forEach((c) => c.classList.remove("active"));
      } else {
        // –≤–∫–ª—é—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é
        activeCategoryType = type;
        filterState.category = type;
        popularCategoryCards.forEach((c) => c.classList.remove("active"));
        card.classList.add("active");
      }

      applyAllFilters();
      renderFeed();

      if (screensContainer) {
        screensContainer.scrollTop = 0;
      }
    });
  });

  // ===== –§–ò–õ–¨–¢–†–´: UI <-> —Å–æ—Å—Ç–æ—è–Ω–∏–µ =====

  function syncFiltersUIFromState() {
    // —Ç–∏–ø
    if (filterTypeRow) {
      filterTypeRow.querySelectorAll(".chip").forEach((chip) => {
        const t = chip.getAttribute("data-type") || "all";
        chip.classList.toggle("chip-filled", t === filterState.type);
      });
    }
    // –≥–æ—Ä–æ–¥
    if (filterCitySelect) {
      filterCitySelect.value = filterState.city === "all" ? "all" : filterState.city;
    }
    // –≤–∞–ª—é—Ç–∞
    if (filterCurrencyRow) {
      filterCurrencyRow.querySelectorAll(".chip").forEach((chip) => {
        const v = chip.getAttribute("data-currency") || "sum";
        chip.classList.toggle("chip-filled", v === filterState.currency);
      });
    }
    // —Ñ–æ—Ç–æ
    if (filterPhotoChip) {
      filterPhotoChip.classList.toggle("chip-filled", filterState.onlyWithPhoto);
    }
    // —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
    if (filterSortSelect) {
      filterSortSelect.value = filterState.sort || "default";
    }
  }

  function readFiltersFromUI() {
    // —Ç–∏–ø
    if (filterTypeRow) {
      const active = filterTypeRow.querySelector(".chip-filled");
      filterState.type = active ? (active.getAttribute("data-type") || "all") : "all";
    }
    // –≥–æ—Ä–æ–¥
    if (filterCitySelect) {
      const val = filterCitySelect.value;
      filterState.city = !val || val === "all" ? "all" : val;
    }
    // –≤–∞–ª—é—Ç–∞
    if (filterCurrencyRow) {
      const active = filterCurrencyRow.querySelector(".chip-filled");
      filterState.currency = active
        ? (active.getAttribute("data-currency") || "sum")
        : "sum";
    }
    // —Ñ–æ—Ç–æ
    if (filterPhotoChip) {
      filterState.onlyWithPhoto = filterPhotoChip.classList.contains("chip-filled");
    }
    // —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
    if (filterSortSelect) {
      filterState.sort = filterSortSelect.value || "default";
    }
  }

  // –∫–ª–∏–∫–∏ –ø–æ —Ç–∏–ø–∞–º/–≤–∞–ª—é—Ç–µ –≤ —Ñ–∏–ª—å—Ç—Ä–∞—Ö
  if (filterTypeRow) {
    filterTypeRow.addEventListener("click", (e) => {
      const chip = e.target.closest(".chip");
      if (!chip) return;
      filterTypeRow.querySelectorAll(".chip").forEach((c) => c.classList.remove("chip-filled"));
      chip.classList.add("chip-filled");
    });
  }

  if (filterCurrencyRow) {
    filterCurrencyRow.addEventListener("click", (e) => {
      const chip = e.target.closest(".chip");
      if (!chip) return;
      filterCurrencyRow.querySelectorAll(".chip").forEach((c) => c.classList.remove("chip-filled"));
      chip.classList.add("chip-filled");
    });
  }

  if (filterPhotoChip) {
    filterPhotoChip.addEventListener("click", () => {
      filterPhotoChip.classList.toggle("chip-filled");
    });
  }

  if (openFiltersBtn) {
    openFiltersBtn.addEventListener("click", () => {
      showScreen("filters");
    });
  }

  if (filtersApplyBtn) {
    filtersApplyBtn.addEventListener("click", () => {
      readFiltersFromUI();
      applyAllFilters();
      renderFeed();
      showScreen("home");
    });
  }

  if (filtersResetBtn) {
    filtersResetBtn.addEventListener("click", () => {
      filterState.type = "all";
      filterState.city = "all";
      filterState.currency = "sum";
      filterState.onlyWithPhoto = false;
      filterState.sort = "default";
      filterState.category = "all";
      // —Å–±—Ä–æ—Å –∞–∫—Ç–∏–≤–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π
      popularCategoryCards.forEach((c) => c.classList.remove("active"));

      syncFiltersUIFromState();
      applyAllFilters();
      renderFeed();
    });
  }

  if (filtersBackBtn) {
    filtersBackBtn.addEventListener("click", () => {
      showScreen("home");
    });
  }

    // ===== –ù–û–í–û–ï –û–ë–™–Ø–í–õ–ï–ù–ò–ï: –®–ê–ì–ò =====

  // –≤—ã–±–æ—Ä —Ç–∏–ø–∞
  adTypeChips.forEach((chip) => {
    chip.addEventListener("click", () => {
      adTypeChips.forEach((c) => c.classList.remove("chip-filled"));
      chip.classList.add("chip-filled");
      newAdDraft.type = chip.getAttribute("data-type") || "–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç";
    });
  });

  if (btnOpenNewAd) {
    btnOpenNewAd.addEventListener("click", () => {
      showScreen("newAd1");
    });
  }

  if (backFromNewAd1) {
    backFromNewAd1.addEventListener("click", () => {
      showScreen("home");
    });
  }

  if (btnNewAdStep1Next) {
    btnNewAdStep1Next.addEventListener("click", () => {
      const title = (inputTitle.value || "").trim();
      const price = (inputPrice.value || "").trim();
      const desc = (inputDescription.value || "").trim();

      if (!title) {
        alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è.");
        return;
      }
      if (!price) {
        alert("–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É.");
        return;
      }

      newAdDraft.city = inputCity.value;
      newAdDraft.title = title;
      newAdDraft.price = price;
      newAdDraft.description = desc || "–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è";

      showScreen("newAd2");
    });
  }

  // —à–∞–≥ 2: —Ñ–æ—Ç–æ + ImgBB
  async function uploadToImgbb(file) {
    const formData = new FormData();
    formData.append("key", IMGBB_API_KEY);
    formData.append("image", file);

    const res = await fetch(IMGBB_UPLOAD_URL, {
      method: "POST",
      body: formData,
    });
    if (!res.ok) throw new Error("upload_failed");
    const json = await res.json();
    if (!json.success || !json.data || !json.data.url)
      throw new Error("bad_response");
    return json.data.url;
  }

  if (btnUploadPhotos) {
    btnUploadPhotos.addEventListener("click", () => {
      inputPhotos.click();
    });
  }

  if (inputPhotos) {
    inputPhotos.addEventListener("change", async () => {
      const files = Array.from(inputPhotos.files || []);
      photosPreview.innerHTML = "";
      newAdDraft.photos = [];
      newAdDraft.photoCount = 0;

      if (!files.length) return;

      const maxFiles = 8;
      const selected = files.slice(0, maxFiles);

      for (const file of selected) {
        const reader = new FileReader();
        reader.onload = (e) => {
          const div = document.createElement("div");
          div.className = "photo-thumb";
          const img = document.createElement("img");
          img.src = e.target.result;
          div.appendChild(img);
          photosPreview.appendChild(div);
        };
        reader.readAsDataURL(file);

        try {
          const url = await uploadToImgbb(file);
          newAdDraft.photos.push(url);
          newAdDraft.photoCount = newAdDraft.photos.length;
        } catch (e) {
          console.error("ImgBB upload error:", e);
        }
      }
    });
  }

  if (btnNewAdStep2Next) {
    btnNewAdStep2Next.addEventListener("click", () => {
      if (!newAdDraft.photoCount) {
        if (
          !confirm(
            "–í—ã –µ—â—ë –Ω–µ –¥–æ–±–∞–≤–∏–ª–∏ —Ñ–æ—Ç–æ. –í—Å—ë —Ä–∞–≤–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—é?"
          )
        ) {
          return;
        }
      }
      fillSummaryStep3();
      showScreen("newAd3");
    });
  }

  if (backFromNewAd2) {
    backFromNewAd2.addEventListener("click", () => {
      showScreen("newAd1");
    });
  }

  function fillSummaryStep3() {
    summaryTitle.textContent = newAdDraft.title || "–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è";
    summaryCityType.textContent =
      (newAdDraft.city || "–ì–æ—Ä–æ–¥") + " ¬∑ " + (newAdDraft.type || "–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç");
    summaryPrice.textContent = newAdDraft.price
      ? newAdDraft.price + " —Å—É–º"
      : "–¶–µ–Ω–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞";
    summaryDescription.textContent =
      newAdDraft.description || "–û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ —É–∫–∞–∑–∞–Ω–æ.";
    summaryPhotosInfo.textContent =
      "–§–æ—Ç–æ: " + (newAdDraft.photoCount || 0) + " —à—Ç.";
  }

  if (backFromNewAd3) {
    backFromNewAd3.addEventListener("click", () => {
      showScreen("newAd2");
    });
  }

  async function publishAdToBackend() {
    btnPublishAd.disabled = true;
    btnPublishAd.textContent = "–ü—É–±–ª–∏–∫—É—é...";

    try {
      const payload = {
        type: newAdDraft.type,
        city: newAdDraft.city,
        title: newAdDraft.title,
        price: (newAdDraft.price || "").replace(/\s+/g, ""),
        description: newAdDraft.description,
        images: newAdDraft.photos,
        phone: DEFAULT_PHONE,
        telegram: DEFAULT_TELEGRAM,
      };

      const res = await fetch(ADD_AD_API_URL, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(payload),
      });

      if (!res.ok) {
        throw new Error("Bad response");
      }

      inputTitle.value = "";
      inputPrice.value = "";
      inputDescription.value = "";
      photosPreview.innerHTML = "";
      if (inputPhotos) inputPhotos.value = "";

      newAdDraft.title = "";
      newAdDraft.price = "";
      newAdDraft.description = "";
      newAdDraft.photoCount = 0;
      newAdDraft.photos = [];

      showScreen("newAdSuccess");
      loadAds();
    } catch (err) {
      console.error("Xato saqlashda:", err);
      alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.");
    } finally {
      btnPublishAd.disabled = false;
      btnPublishAd.textContent = "–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ";
    }
  }

  if (btnPublishAd) {
    btnPublishAd.addEventListener("click", publishAdToBackend);
  }

  if (btnGoToFeed) {
    btnGoToFeed.addEventListener("click", () => {
      showScreen("home");
    });
  }

  if (btnGoHome) {
    btnGoHome.addEventListener("click", () => {
      showScreen("home");
    });
  }

  // ===== –û–¢–ö–†–´–¢–ò–ï –ö–ê–†–¢–û–ß–ö–ò –û–ë–™–Ø–í–õ–ï–ù–ò–Ø =====

  function openAdDetails(ad) {
    if (!screenAdDetails) return;

    currentAdInDetails = ad;

    const title = ad.title || "–û–±—ä—è–≤–ª–µ–Ω–∏–µ";
    const priceText = formatPrice(ad.price);
    const city = ad.city || "–ì–æ—Ä–æ–¥";
    const type = ad.type || "–¢–æ–≤–∞—Ä";
    const desc = ad.description || "";
    const created = formatDateShort(ad.created_at);
    const images = Array.isArray(ad.images) ? ad.images : [];

    if (detailTitle) detailTitle.textContent = title;
    if (detailPrice) detailPrice.textContent = priceText;
    if (detailMeta) {
      detailMeta.textContent = `üìç ${city} ¬∑ ${type}${
        created ? " ¬∑ " + created : ""
      }`;
    }
    if (detailDescription) detailDescription.textContent = desc;

    // —Ñ–æ—Ç–æ-—Å–ª–∞–π–¥–µ—Ä
    if (detailMainImage) {
      detailMainImage.innerHTML = "";
      detailMainImage.style.display = "flex";
      detailMainImage.style.overflowX = "auto";
      detailMainImage.style.scrollSnapType = "x mandatory";

      if (images.length) {
        images.forEach((url, idx) => {
          const slide = document.createElement("div");
          slide.className = "detail-main-slide";
          slide.style.backgroundImage = `url('${url}')`;
          slide.addEventListener("click", () => {
            openLightbox(images, idx);
          });
          detailMainImage.appendChild(slide);
        });
      } else {
        const slide = document.createElement("div");
        slide.className = "detail-main-slide";
        slide.style.background = "#e5e7eb";
        detailMainImage.appendChild(slide);
      }

      detailMainImage.scrollLeft = 0;
    }

    // –ø—Ä–µ–≤—å—é
    if (detailThumbs) {
      detailThumbs.innerHTML = "";
      images.forEach((url, idx) => {
        const div = document.createElement("div");
        div.className = "detail-thumb";
        div.style.backgroundImage = `url('${url}')`;

        div.addEventListener("click", () => {
          if (detailMainImage) {
            detailMainImage.scrollTo({
              left: idx * detailMainImage.clientWidth,
              behavior: "smooth",
            });
          }
        });

        detailThumbs.appendChild(div);
      });
    }

    // –∫–Ω–æ–ø–∫–∏ —Å–≤—è–∑–∏
    const phone = ad.phone || DEFAULT_PHONE;
    const telegram = ad.telegram || DEFAULT_TELEGRAM;

    if (callSellerBtn) {
      if (phone) {
        const cleanPhone = String(phone).replace(/\s+/g, "");
        callSellerBtn.href = "tel:" + cleanPhone;
        callSellerBtn.style.display = "flex";
      } else {
        callSellerBtn.style.display = "none";
      }
    }

    if (msgSellerBtn) {
      if (telegram) {
        const username = String(telegram).replace(/^@/, "");
        msgSellerBtn.href = "https://t.me/" + username;
        msgSellerBtn.style.display = "flex";
      } else {
        msgSellerBtn.style.display = "none";
      }
    }

    // –∏–∑–±—Ä–∞–Ω–Ω–æ–µ (—Å–µ—Ä–¥–µ—á–∫–æ)
    if (favoriteBtn) {
      const isFav = ad.id != null && favoritesSet.has(ad.id);
      favoriteBtn.textContent = isFav ? "‚ô•" : "‚ô°";

      favoriteBtn.onclick = () => {
        if (ad.id == null) return;
        if (favoritesSet.has(ad.id)) {
          favoritesSet.delete(ad.id);
          favoriteBtn.textContent = "‚ô°";
        } else {
          favoritesSet.add(ad.id);
          favoriteBtn.textContent = "‚ô•";
        }
        saveFavoritesToStorage();
        renderFavorites();
      };
    }

    // –ø–æ–¥–µ–ª–∏—Ç—å—Å—è
    if (shareBtn) {
      shareBtn.onclick = () => {
        const shareData = {
          title: title,
          text: title,
          url: window.location.href,
        };
        if (navigator.share) {
          navigator.share(shareData).catch(() => {});
        } else if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard
            .writeText(shareData.url)
            .then(() => alert("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞."));
        } else {
          alert("–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –º–æ–∂–Ω–æ, —Å–∫–æ–ø–∏—Ä–æ–≤–∞–≤ —Å—Å—ã–ª–∫—É –∏–∑ –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–∏.");
        }
      };
    }

    // –ø–æ—Ö–æ–∂–∏–µ
    if (similarList) {
      similarList.innerHTML = "";
      const sameType = allAds.filter(
        (x) => x.id !== ad.id && x.type === ad.type && x.city === ad.city
      );
      const similarAds = (sameType.length ? sameType : allAds)
        .filter((x) => x.id !== ad.id)
        .slice(0, 3);

      if (!similarAds.length) {
        similarList.innerHTML =
          "<div class='ad-meta'>–ü–æ—Ö–æ–∂–∏—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç.</div>";
      } else {
        similarAds.forEach((item) => {
          const card = document.createElement("div");
          card.className = "similar-card";

          const firstImage =
            item.images && Array.isArray(item.images) && item.images.length > 0
              ? item.images[0]
              : null;
          card.innerHTML = `
            <div class="similar-image"
              ${
                firstImage
                  ? `style="background-image:url('${firstImage}');background-size:cover;background-position:center;"`
                  : ""
              }></div>
            <div>
              <div class="similar-content-title">${item.title || "E'lon"}</div>
              <div class="similar-content-meta">
                üìç ${item.city || "Shahar"} ¬∑ ${item.type || "Tovar"}
              </div>
              <div class="similar-content-price">
                ${formatPrice(item.price)}
              </div>
            </div>
          `;
          card.addEventListener("click", () => openAdDetails(item));
          similarList.appendChild(card);
        });
      }
    }

    showScreen("adDetails");
  }

  // ===== –õ–ê–ô–¢–ë–û–ö–° =====

  function updateLightboxImage() {
    if (!lightboxImg || !lightboxImages.length) return;
    const url = lightboxImages[lightboxIndex];
    lightboxImg.src = url;
  }

  function openLightbox(images, idx) {
    if (!imageLightbox || !lightboxImg) return;
    lightboxImages = Array.isArray(images) && images.length ? images.slice() : [];
    lightboxIndex = idx || 0;
    if (!lightboxImages.length) {
      return;
    }
    updateLightboxImage();
    imageLightbox.classList.add("visible");
  }

  if (imageLightbox) {
    imageLightbox.addEventListener("click", () => {
      imageLightbox.classList.remove("visible");
    });
  }

  if (lightboxPrev) {
    lightboxPrev.addEventListener("click", (e) => {
      e.stopPropagation();
      if (!lightboxImages.length) return;
      lightboxIndex = (lightboxIndex - 1 + lightboxImages.length) % lightboxImages.length;
      updateLightboxImage();
    });
  }

  if (lightboxNext) {
    lightboxNext.addEventListener("click", (e) => {
      e.stopPropagation();
      if (!lightboxImages.length) return;
      lightboxIndex = (lightboxIndex + 1) % lightboxImages.length;
      updateLightboxImage();
    });
  }

  // ===== –ù–ê–ó–ê–î –ò–ó –ö–ê–†–¢–û–ß–ö–ò =====

  if (detailBackBtn) {
    detailBackBtn.addEventListener("click", () => {
      showScreen("home");
    });
  }

  // –ü–µ—Ä–µ—Ö–æ–¥ –≤ –ø—Ä–æ—Ñ–∏–ª—å –ø—Ä–∏ –∫–ª–∏–∫–µ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–µ –ø—Ä–æ–¥–∞–≤—Ü–∞ –≤ –æ–±—ä—è–≤–ª–µ–Ω–∏–∏
  if (sellerCard) {
    sellerCard.addEventListener("click", () => {
      showScreen("profile");
    });
  }

      // –ö–ª–∏–∫ –ø–æ –ø—Ä–æ–º–æ-–±–∞–Ω–Ω–µ—Ä—É (–ø–æ–∫—É–ø–∫–∞ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è)
  const promoBanner = document.getElementById("promoBanner");
  if (promoBanner) {
    promoBanner.addEventListener("click", () => {
      // –∑–¥–µ—Å—å –ø–æ–∑–∂–µ –æ—Ç–∫—Ä–æ–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω / WebApp –ø–æ–∫—É–ø–∫–∏ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è
      // –ø–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
      alert("–°–∫–æ—Ä–æ —Ç—É—Ç –±—É–¥–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π üöÄ");
    });
  }
    
  // ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø =====
  loadAds();
  </script>
</body>
</html>
