<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>MarketHub Mini App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
    }

    body {
      background: #f1f4ff;
      color: #0f172a;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .app {
      background: #f9fafb;
      width: 100%;
      max-width: 480px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
    }

    .detail-thumb {
      width: 64px;
      height: 64px;
      border-radius: 12px;
      background: #e5e7eb;
      flex-shrink: 0;
    }

    /* –ì–ª–∞–≤–Ω–æ–µ —Ñ–æ—Ç–æ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è */
#detailMainImage {
  width: 100%;
  height: 260px;
  border-radius: 16px;
  background: #e5e7eb;
  margin-bottom: 12px;
  background-size: cover;        /* –ø–æ–¥–≥–æ–Ω –ø–æ –æ–∫–Ω—É */
  background-position: center;
  background-repeat: no-repeat;
}

/* –ì–∞–ª–µ—Ä–µ—è –º–∞–ª–µ–Ω—å–∫–∏—Ö —Ñ–æ—Ç–æ */
#detailThumbs {
  display: flex;
  gap: 8px;
  overflow-x: auto;
  margin-bottom: 12px;
}

#detailPrice {
  font-size: 18px;
  font-weight: 600;
  margin-bottom: 6px;
}

#detailMeta {
  font-size: 13px;
  color: #64748b;
  margin-bottom: 10px;
}

#detailDescription {
  font-size: 14px;
  line-height: 1.4;
}
    
    /* HEADER */

    .app-header {
      padding: 12px 16px 10px;
      background: #ffffff;
      border-bottom: 1px solid rgba(148, 163, 184, 0.3);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .app-header-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .app-logo-small {
      width: 32px;
      height: 32px;
      border-radius: 9px;
    }

    .app-title {
      font-weight: 600;
      font-size: 16px;
      color: #0f172a;
    }

    .app-subtitle {
      font-size: 12px;
      color: #64748b;
    }

    /* SCREEN CONTAINER */

    .screens {
      flex: 1;
      overflow-y: auto;
      padding: 12px 12px 72px; /* –º–µ—Å—Ç–æ –ø–æ–¥ –Ω–∏–∂–Ω–µ–µ –º–µ–Ω—é */
    }

    .screen {
      display: none;
    }

    .screen.active {
      display: block;
    }

    .screen-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 10px;
    }

    /* SEARCH */

    .search-bar {
      margin-top: 4px;
      margin-bottom: 12px;
    }

    .search-input {
      width: 100%;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      font-size: 14px;
      padding-left: 32px;
      background: #ffffff url("data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 5a6 6 0 014.472 9.972l3.278 3.278a1 1 0 01-1.414 1.414l-3.278-3.278A6 6 0 1111 5zm0 2a4 4 0 100 8 4 4 0 000-8z' fill='%2394a3b8'/%3E%3C/svg%3E")
      no-repeat 10px center;
      background-size: 16px;
    }

    /* QUICK ACTIONS */

    .quick-actions-title {
      font-size: 14px;
      color: #64748b;
      margin-bottom: 6px;
    }

    .primary-btn {
      width: 100%;
      border: none;
      border-radius: 999px;
      padding: 13px 16px;
      font-size: 15px;
      font-weight: 600;
      color: #ffffff;
      background: linear-gradient(135deg, #2563eb, #1d4ed8);
      box-shadow: 0 8px 20px rgba(37, 99, 235, 0.35);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 10px;
      cursor: pointer;
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 12px;
    }

    .chip {
      border-radius: 999px;
      padding: 7px 12px;
      font-size: 13px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: #ffffff;
      color: #0f172a;
      cursor: pointer;
    }

    .chip.chip-filled {
      background: #1d4ed8;
      color: #ffffff;
      border-color: transparent;
      box-shadow: 0 4px 14px rgba(37, 99, 235, 0.3);
    }

    /* CATEGORIES GRID */

    .section-title {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 8px;
      margin-top: 4px;
    }

    .category-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }

    .category-card {
      background: #ffffff;
      border-radius: 16px;
      padding: 10px 12px;
      box-shadow: 0 3px 10px rgba(15, 23, 42, 0.06);
      font-size: 14px;
    }

    .category-card-title {
      font-weight: 600;
      margin-bottom: 2px;
    }

    .category-card-sub {
      font-size: 12px;
      color: #64748b;
    }

    /* LIST SCREEN */

    .tabs-row {
      display: flex;
      margin-bottom: 10px;
      background: #e5edff;
      padding: 4px;
      border-radius: 999px;
    }

    .tab-pill {
      flex: 1;
      border-radius: 999px;
      padding: 7px 0;
      font-size: 13px;
      border: none;
      background: transparent;
      color: #475569;
      cursor: pointer;
    }

    .tab-pill.active {
      background: #ffffff;
      color: #1d4ed8;
      box-shadow: 0 3px 8px rgba(15, 23, 42, 0.15);
      font-weight: 600;
    }

    .filter-row {
      display: flex;
      gap: 8px;
      overflow-x: auto;
      padding-bottom: 4px;
      margin-bottom: 10px;
    }

    .filter-chip {
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 13px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: #ffffff;
      white-space: nowrap;
      cursor: default;
    }

    .filter-chip.active {
      background: #1d4ed8;
      color: #ffffff;
      border-color: transparent;
    }

    .ad-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 16px;
    }

    .ad-card {
      display: flex;
      gap: 10px;
      background: #ffffff;
      border-radius: 16px;
      padding: 10px;
      box-shadow: 0 3px 10px rgba(15, 23, 42, 0.06);
      cursor: pointer;
    }

    /* ==== YANGI E'LONLAR BLOKI ==== */
    .ads-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 8px;
      margin-bottom: 12px;
    }

    .ad-image {
      width: 56px;
      height: 56px;
      border-radius: 14px;
      background: linear-gradient(135deg, #eff6ff, #dbeafe);
      flex-shrink: 0;
    }

    .ad-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .ad-title {
      font-size: 14px;
      font-weight: 600;
    }

    .ad-meta {
      font-size: 12px;
      color: #64748b;
    }

    .ad-price {
      font-size: 14px;
      font-weight: 600;
      color: #16a34a;
      margin-top: 2px;
    }

    .ad-rating {
      font-size: 12px;
      color: #f59e0b;
    }

    .ad-photos-count {
      font-size: 11px;
      color: #64748b;
      margin-top: 2px;
    }

    .badge-new {
      font-size: 12px;
      color: #f59e0b;
      margin-top: 2px;
    }

    /* PROFILE SCREEN */

    .profile-card {
      background: #ffffff;
      border-radius: 20px;
      padding: 14px;
      box-shadow: 0 6px 18px rgba(15, 23, 42, 0.08);
      margin-bottom: 14px;
    }

    .profile-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }

    .avatar {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      background: #1d4ed8;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #ffffff;
      font-weight: 600;
      font-size: 18px;
    }

    .profile-name {
      font-size: 15px;
      font-weight: 600;
    }

    .profile-username {
      font-size: 13px;
      color: #64748b;
    }

    .profile-rating {
      font-size: 13px;
      color: #f59e0b;
      margin-top: 2px;
    }

    .profile-desc {
      font-size: 13px;
      color: #475569;
      margin-top: 6px;
    }

    .profile-actions {
      display: flex;
      gap: 8px;
      margin-top: 10px;
    }

    .outline-btn,
    .secondary-btn {
      flex: 1;
      border-radius: 999px;
      padding: 8px 10px;
      font-size: 13px;
      border: 1px solid #cbd5f5;
      background: #f8fafc;
      color: #1d4ed8;
      cursor: pointer;
    }

    .secondary-btn {
      background: #fff7ed;
      border-color: #fed7aa;
      color: #c2410c;
    }

    .profile-section-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 6px;
      margin-top: 6px;
    }

    /* NEW AD FORM */

    .back-link {
      font-size: 13px;
      color: #1d4ed8;
      margin-bottom: 6px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .form-group {
      margin-bottom: 10px;
    }

    .form-label {
      font-size: 13px;
      margin-bottom: 4px;
      display: block;
      color: #475569;
    }

    .form-input,
    .form-select,
    .form-textarea {
      width: 100%;
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      padding: 9px 10px;
      font-size: 14px;
      background: #ffffff;
    }

    .form-textarea {
      resize: vertical;
      min-height: 60px;
    }

    .hint {
      font-size: 12px;
      color: #94a3b8;
      margin-top: 2px;
    }

    .step-tag {
      display: inline-block;
      font-size: 11px;
      padding: 3px 7px;
      border-radius: 999px;
      background: #eff6ff;
      color: #1d4ed8;
      margin-left: 4px;
    }

    .photos-preview-row {
      display: flex;
      gap: 8px;
      flex-wrap: nowrap;
      overflow-x: auto;
      margin-top: 6px;
    }

    .photo-thumb {
      width: 64px;
      height: 64px;
      border-radius: 12px;
      overflow: hidden;
      background: #e5e7eb;
      flex-shrink: 0;
    }

    .photo-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .hidden-input {
      display: none;
    }

    /* SUCCESS SCREEN */

    .success-icon {
      width: 64px;
      height: 64px;
      border-radius: 999px;
      background: #dcfce7;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      margin: 12px auto;
    }

    .success-text-main {
      font-size: 18px;
      font-weight: 600;
      text-align: center;
      margin-top: 6px;
    }

    .success-text-sub {
      font-size: 13px;
      color: #6b7280;
      text-align: center;
      margin-top: 4px;
      margin-bottom: 16px;
    }

    /* BOTTOM NAV */

    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      max-width: 480px;
      background: rgba(15, 23, 42, 0.03);
      padding: 6px 10px 10px;
    }

    .bottom-nav-inner {
      background: #ffffff;
      box-shadow: 0 6px 18px rgba(15, 23, 42, 0.15);
      border-radius: 999px;
      display: flex;
      justify-content: space-around;
      padding: 4px;
    }

    .nav-btn {
      flex: 1;
      border: none;
      background: transparent;
      border-radius: 999px;
      font-size: 12px;
      padding: 6px 0;
      color: #64748b;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      cursor: pointer;
    }

    .nav-btn span.icon {
      font-size: 14px;
    }

    .nav-btn.active {
      background: #1d4ed8;
      color: #ffffff;
      font-weight: 600;
    }

    /* ==== –≠–ö–†–ê–ù –ü–†–û–°–ú–û–¢–†–ê –û–ë–™–Ø–í–õ–ï–ù–ò–Ø ==== */

    .ad-view-header-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    .ad-view-back-btn {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      background: #ffffff;
      cursor: pointer;
      font-size: 18px;
    }

    .ad-view-title {
      font-size: 16px;
      font-weight: 600;
    }

    .ad-view-card {
      background: #ffffff;
      border-radius: 20px;
      padding: 12px;
      box-shadow: 0 6px 18px rgba(15, 23, 42, 0.06);
    }

    .ad-view-image {
      width: 100%;
      height: 180px;
      border-radius: 16px;
      background: linear-gradient(135deg, #e5edff, #dbeafe);
      margin-bottom: 10px;
      background-size: cover;
      background-position: center;
    }

    .ad-view-main-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .ad-view-price {
      font-size: 18px;
      font-weight: 700;
      color: #16a34a;
      margin-bottom: 4px;
    }

    .ad-view-meta {
      font-size: 13px;
      color: #6b7280;
      margin-bottom: 8px;
    }

    .ad-view-description-title {
      font-size: 14px;
      font-weight: 600;
      margin-top: 8px;
      margin-bottom: 4px;
    }

    .ad-view-description {
      font-size: 14px;
      color: #374151;
    }

    .ad-view-seller-card {
      margin-top: 12px;
      padding: 10px;
      border-radius: 16px;
      background: #f9fafb;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .ad-view-seller-info-main {
      font-size: 14px;
      font-weight: 600;
    }

    .ad-view-seller-info-sub {
      font-size: 12px;
      color: #6b7280;
    }

    .ad-view-actions-row {
  display: flex;
  gap: 6px;              /* —á—É—Ç—å –º–µ–Ω—å—à–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –∫–Ω–æ–ø–∫–∞–º–∏ */
  margin-top: 10px;
}

.ad-view-btn-outline {
  flex: 1;
  border-radius: 999px;
  padding: 6px 6px;       /* –º–µ–Ω—å—à–µ –æ—Ç—Å—Ç—É–ø—ã = –±–æ–ª—å—à–µ –º–µ—Å—Ç–∞ –ø–æ–¥ —Ç–µ–∫—Å—Ç */
  border: 1px solid #cbd5f5;
  background: #ffffff;
  font-size: 12px;        /* —à—Ä–∏—Ñ—Ç —á—É—Ç—å –º–µ–Ω—å—à–µ */
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 4px;               /* –º–µ–Ω—å—à–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –∏–∫–æ–Ω–∫–æ–π –∏ —Ç–µ–∫—Å—Ç–æ–º */
  color: #1d4ed8;
  white-space: nowrap;    /* –∑–∞–ø—Ä–µ—Ç –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞ –≤—Ç–æ—Ä—É—é —Å—Ç—Ä–æ–∫—É */
}

    .ad-view-btn-ghost-row {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }

    .ad-view-btn-ghost {
      flex: 1;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: #f9fafb;
      font-size: 13px;
      padding: 7px 10px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      color: #374151;
    }

    @media (max-width: 480px) {
      body {
        align-items: stretch;
      }
      .app {
        border-radius: 0;
        box-shadow: none;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- HEADER -->
    <header class="app-header">
      <div class="app-header-left">
        <img src="markethub-logo.png" alt="MarketHub" class="app-logo-small" />
        <div>
          <div class="app-title">MarketHub</div>
          <div class="app-subtitle">–£–∑–±–µ–∫–∏—Å—Ç–∞–Ω ¬∑ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</div>
        </div>
      </div>
    </header>

    <!-- SCREENS -->
    <div class="screens">
      <!-- HOME SCREEN -->
      <section class="screen active" id="screen-home">
        <div class="screen-title">–ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω</div>

        <div class="search-bar">
          <input
            type="text"
            class="search-input"
            placeholder="–ù–∞–π—Ç–∏ —Ç–æ–≤–∞—Ä –∏–ª–∏ —É—Å–ª—É–≥—É..."
          />
        </div>

        <div class="quick-actions-title">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</div>
        <button class="primary-btn" id="btnOpenNewAd">
          <span>Ôºã</span> –ü–æ–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
        </button>

        <div class="chip-row">
          <button class="chip chip-filled">üì¶ –¢–æ–≤–∞—Ä—ã</button>
          <button class="chip">üíº –£—Å–ª—É–≥–∏</button>
          <button class="chip">üè† –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</button>
          <button class="chip">üìç –¢–∞—à–∫–µ–Ω—Ç</button>
        </div>

        <div class="section-title">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</div>
        <div class="category-grid">
          <div class="category-card">
            <div class="category-card-title">üì± –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</div>
            <div class="category-card-sub">–¢–µ–ª–µ—Ñ–æ–Ω—ã, –Ω–æ—É—Ç–±—É–∫–∏</div>
          </div>
          <div class="category-card">
            <div class="category-card-title">üè† –î–ª—è –¥–æ–º–∞</div>
            <div class="category-card-sub">–ú–µ–±–µ–ª—å, —Ç–µ—Ö–Ω–∏–∫–∞</div>
          </div>
          <div class="category-card">
            <div class="category-card-title">üëï –û–¥–µ–∂–¥–∞</div>
            <div class="category-card-sub">–ú—É–∂—Å–∫–∞—è, –∂–µ–Ω—Å–∫–∞—è</div>
          </div>
          <div class="category-card">
            <div class="category-card-title">üõ† –£—Å–ª—É–≥–∏</div>
            <div class="category-card-sub">–ú–∞—Å—Ç–µ—Ä–∞, —Ä–µ–º–æ–Ω—Ç</div>
          </div>
        </div>

        <!-- Yangi e'lonlar –¢–û–õ–¨–ö–û –Ω–∞ –≥–ª–∞–≤–Ω–æ–π -->
        <h2 class="section-title" style="margin-top:18px;">Yangi e'lonlar</h2>
        <div id="ads-list" class="ads-list">
          <!-- –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ–¥—Å—Ç–∞–≤–∏—Ç JS -->
        </div>
      </section>

      <!-- LIST SCREEN -->
      <section class="screen" id="screen-list">
        <div class="screen-title">–û–±—ä—è–≤–ª–µ–Ω–∏—è</div>

        <div class="tabs-row">
          <button class="tab-pill active" id="tabGoods">–¢–æ–≤–∞—Ä—ã</button>
          <button class="tab-pill" id="tabServices">–£—Å–ª—É–≥–∏</button>
          <button class="tab-pill" id="tabRealty">–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</button>
        </div>

        <div class="filter-row">
          <button class="filter-chip active">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</button>
          <button class="filter-chip">–¢–µ–ª–µ—Ñ–æ–Ω—ã</button>
          <button class="filter-chip">–ê–≤—Ç–æ</button>
          <button class="filter-chip">–î–ª—è –¥–æ–º–∞</button>
          <button class="filter-chip">–û–¥–µ–∂–¥–∞</button>
        </div>

        <div class="ad-list" id="adList">
          <!-- —Å—é–¥–∞ JS –ø–æ–¥—Å—Ç–∞–≤–∏—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏—è —Å –±—ç–∫–µ–Ω–¥–∞ -->
        </div>
      </section>

      <!-- PROFILE SCREEN -->
      <section class="screen" id="screen-profile">
        <div class="screen-title">–ü—Ä–æ—Ñ–∏–ª—å –ø—Ä–æ–¥–∞–≤—Ü–∞</div>

        <div class="profile-card">
          <div class="profile-header">
            <div class="avatar">B</div>
            <div>
              <div class="profile-name">Baxir B-R</div>
              <div class="profile-username">@Baxir1987 ¬∑ –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω</div>
              <div class="profile-rating">‚≠ê 4,9 –∏–∑ 5 ¬∑ 23 –æ—Ç–∑—ã–≤–∞</div>
            </div>
          </div>

          <div class="profile-desc">
            ¬´–ö—Ä–∞—Å–∫–∞ ‚Äî –º–æ—ë –¥—ã—Ö–∞–Ω–∏–µ¬ª. –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ –∫—É–∑–æ–≤–Ω–æ–π –ø–æ–∫—Ä–∞—Å–∫–µ
            –∏ —á–µ—Å—Ç–Ω–æ–π –ø—Ä–æ–¥–∞–∂–µ. –í—Å–µ–≥–¥–∞ –Ω–∞ —Å–≤—è–∑–∏, –±–µ–∑ –æ–±–º–∞–Ω–∞.
          </div>

          <div class="profile-actions">
            <button class="outline-btn">üí¨ –ù–∞–ø–∏—Å–∞—Ç—å</button>
            <button class="secondary-btn">‚≠ê –û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
          </div>
        </div>

        <div class="profile-section-title">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</div>
        <div class="ad-list">
          <article class="ad-card">
            <div class="ad-image"></div>
            <div class="ad-content">
              <div class="ad-title">–®–∞–º–ø—É–Ω—å –æ—Ç –ø–µ—Ä—Ö–æ—Ç–∏</div>
              <div class="ad-meta">üìç –¢–∞—à–∫–µ–Ω—Ç ¬∑ –¢–æ–≤–∞—Ä ¬∑ 2 –¥–Ω—è –Ω–∞–∑–∞–¥</div>
              <div class="ad-price">150 000 —Å—É–º</div>
            </div>
          </article>

          <article class="ad-card">
            <div class="ad-image"></div>
            <div class="ad-content">
              <div class="ad-title">–ü–æ–ª–∏—Ä–æ–≤–∫–∞ –∫—É–∑–æ–≤–∞ ¬∑ —É—Å–ª—É–≥–∞</div>
              <div class="ad-meta">üìç –¢–∞—à–∫–µ–Ω—Ç ¬∑ –£—Å–ª—É–≥–∞ ¬∑ 5 –¥–Ω–µ–π –Ω–∞–∑–∞–¥</div>
              <div class="ad-price">–æ—Ç 300 000 —Å—É–º</div>
            </div>
          </article>
        </div>
      </section>

      <!-- NEW AD STEP 1 -->
      <section class="screen" id="screen-new-ad-step1">
        <div class="back-link" id="backFromNewAd1">‚Üê –ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—ã–π</div>
        <div class="screen-title">
          –ù–æ–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ <span class="step-tag">–®–∞–≥ 1 –∏–∑ 3</span>
        </div>

        <div class="form-group" style="margin-top: 10px;">
          <label class="form-label">–¢–∏–ø –æ–±—ä—è–≤–ª–µ–Ω–∏—è</label>
          <div class="chip-row" id="adTypeChips">
            <button class="chip chip-filled" data-type="–¢–æ–≤–∞—Ä">üì¶ –¢–æ–≤–∞—Ä</button>
            <button class="chip" data-type="–£—Å–ª—É–≥–∞">üíº –£—Å–ª—É–≥–∞</button>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">–ì–æ—Ä–æ–¥</label>
          <select class="form-select" id="inputCity">
            <option>–¢–∞—à–∫–µ–Ω—Ç</option>
            <option>–°–∞–º–∞—Ä–∫–∞–Ω–¥</option>
            <option>–§–µ—Ä–≥–∞–Ω–∞</option>
            <option>–ù–∞–º–∞–Ω–≥–∞–Ω</option>
            <option>–ë—É—Ö–∞—Ä–∞</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
          <input class="form-input" id="inputTitle" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: ¬´iPhone 13 Pro, –∫–∞–∫ –Ω–æ–≤—ã–π¬ª" />
        </div>

        <div class="form-group">
          <label class="form-label">–¶–µ–Ω–∞</label>
          <input class="form-input" id="inputPrice" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 10 500 000" />
          <div class="hint">–í–∞–ª—é—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: —Å—É–º</div>
        </div>

        <div class="form-group">
          <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
          <textarea class="form-textarea" id="inputDescription" placeholder="–ö–æ—Ä–æ—Ç–∫–æ –æ–ø–∏—à–∏—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –¥–µ—Ç–∞–ª–∏..."></textarea>
        </div>

        <button class="primary-btn" id="btnNewAdStep1Next">
          –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å ¬∑ —à–∞–≥ 2
        </button>
      </section>

      <!-- NEW AD STEP 2 -->
      <section class="screen" id="screen-new-ad-step2">
        <div class="back-link" id="backFromNewAd2">‚Üê –ù–∞–∑–∞–¥ ¬∑ —à–∞–≥ 1</div>
        <div class="screen-title">
          –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ <span class="step-tag">–®–∞–≥ 2 –∏–∑ 3</span>
        </div>

        <div class="form-group" style="margin-top: 10px;">
          <label class="form-label">–î–æ–±–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞ –∏–ª–∏ —É—Å–ª—É–≥–∏</label>
          <button class="outline-btn" id="btnUploadPhotos">üì∏ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</button>
          <input
            type="file"
            accept="image/*"
            multiple
            id="inputPhotos"
            class="hidden-input"
          />
          <div class="hint">
            –ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ 8 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π.
          </div>
          <div class="photos-preview-row" id="photosPreview"></div>
        </div>

        <button class="primary-btn" id="btnNewAdStep2Next">
          –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å ¬∑ —à–∞–≥ 3
        </button>
      </section>

      <!-- NEW AD STEP 3 -->
      <section class="screen" id="screen-new-ad-step3">
        <div class="back-link" id="backFromNewAd3">‚Üê –ù–∞–∑–∞–¥ ¬∑ —à–∞–≥ 2</div>
        <div class="screen-title">
          –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ <span class="step-tag">–®–∞–≥ 3 –∏–∑ 3</span>
        </div>

        <div class="profile-card" id="newAdSummaryCard">
          <div class="profile-header">
            <div class="ad-image"></div>
            <div>
              <div class="profile-name" id="summaryTitle">–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</div>
              <div class="profile-username" id="summaryCityType">–ì–æ—Ä–æ–¥ ¬∑ –¢–∏–ø</div>
              <div class="profile-rating" id="summaryPrice">–¶–µ–Ω–∞</div>
            </div>
          </div>
          <div class="profile-desc" id="summaryDescription">
            –û–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è...
          </div>
          <div class="ad-photos-count" id="summaryPhotosInfo" style="margin-top:8px;">
            –§–æ—Ç–æ: 0 —à—Ç.
          </div>
        </div>

        <div class="hint">
          –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ. –í —Ä–µ–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –ø–æ—Å–ª–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
          –ø–æ—è–≤–∏—Ç—Å—è –≤ –∫–∞–Ω–∞–ª–µ MarketHub ‚Äî –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω –∏ –≤ —Ä–∞–∑–¥–µ–ª–µ ¬´–û–±—ä—è–≤–ª–µ–Ω–∏—è¬ª.
        </div>

        <button class="primary-btn" id="btnPublishAd" style="margin-top: 10px;">
          –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
        </button>
      </section>

      <!-- NEW AD SUCCESS -->
      <section class="screen" id="screen-new-ad-success">
        <div class="success-icon">‚úÖ</div>
        <div class="success-text-main">–û–±—ä—è–≤–ª–µ–Ω–∏–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ!</div>
        <div class="success-text-sub">
          –í –¥–µ–º–æ-–≤–µ—Ä—Å–∏–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –Ω–∞ —ç–∫—Ä–∞–Ω ¬´–û–±—ä—è–≤–ª–µ–Ω–∏—è¬ª.
          –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –æ–Ω–æ —Ç–∞–∫–∂–µ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –∫–∞–Ω–∞–ª Telegram.
        </div>

        <button class="primary-btn" id="btnGoToList">
          üìã –ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–±—ä—è–≤–ª–µ–Ω–∏—è–º
        </button>
        <button class="outline-btn" id="btnGoHome" style="margin-top: 8px;">
          üè† –ù–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
        </button>
      </section>

            <!-- AD DETAILS SCREEN -->
      <section class="screen" id="screen-ad-details" style="padding:12px;">
        <button class="back-link" id="detailBackBtn">‚Üê –ù–∞–∑–∞–¥</button>

        <div class="screen-title" id="detailTitle">–ó–∞–≥–æ–ª–æ–≤–æ–∫</div>

        <!-- –ì–ª–∞–≤–Ω–æ–µ —Ñ–æ—Ç–æ -->
        <div id="detailMainImage"></div>

        <!-- –ì–∞–ª–µ—Ä–µ—è –º–∞–ª–µ–Ω—å–∫–∏—Ö —Ñ–æ—Ç–æ -->
        <div id="detailThumbs"></div>

        <!-- –¶–µ–Ω–∞ -->
        <div id="detailPrice"></div>

        <!-- –ú–µ—Ç–∞-–∏–Ω—Ñ–æ -->
        <div id="detailMeta"></div>

        <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
        <div id="detailDescription"></div>
      </section>
    </div> <!-- /screens -->

    <!-- BOTTOM NAV -->
    <nav class="bottom-nav">
      <div class="bottom-nav-inner">
        <button class="nav-btn active" data-screen="home">
          <span class="icon">üè†</span>
          <span>–ì–ª–∞–≤–Ω–∞—è</span>
        </button>
        <button class="nav-btn" data-screen="list">
          <span class="icon">üìã</span>
          <span>–û–±—ä—è–≤–ª–µ–Ω–∏—è</span>
        </button>
        <button class="nav-btn" data-screen="profile">
          <span class="icon">üë§</span>
          <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
        </button>
      </div>
    </nav>
  </div>

  <script>
  // ==== API URL ====
  const ADS_API_URL = "https://baxir.pythonanywhere.com/ads";
  const ADD_AD_API_URL = "https://baxir.pythonanywhere.com/api/add_ad";

  // ==== ImgBB ====
  const IMGBB_API_KEY = "d6a3eac7b36101df3effee3f7d0c7493";
  const IMGBB_UPLOAD_URL = "https://api.imgbb.com/1/upload";

  const homeAdsList = document.getElementById("ads-list");
  const adList = document.getElementById("adList");
  const screensContainer = document.querySelector(".screens");

  // —ç–ª–µ–º–µ–Ω—Ç—ã –∫–∞—Ä—Ç–æ—á–∫–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è (—ç–∫—Ä–∞–Ω –ø—Ä–æ—Å–º–æ—Ç—Ä–∞)
  const screenAdDetails = document.getElementById("screen-ad-details");
  const detailMainImage = document.getElementById("detailMainImage");
  const detailThumbs = document.getElementById("detailThumbs");
  const detailTitle = document.getElementById("detailTitle");
  const detailPrice = document.getElementById("detailPrice");
  const detailMeta = document.getElementById("detailMeta");
  const detailDescription = document.getElementById("detailDescription");
  const detailBackBtn = document.getElementById("detailBackBtn");

  // –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ —Ç–µ–∫—É—â–∏–π –∫–∞–¥—Ä –≤ –¥–µ—Ç–∞–ª–∫–µ
let currentDetailImages = [];
let currentDetailIndex = 0;

    function setDetailMainImage(url) {
  if (!detailMainImage) return;
  detailMainImage.style.backgroundImage = `url('${url}')`;
  detailMainImage.style.backgroundSize = "cover";
  detailMainImage.style.backgroundPosition = "center";
}
    
  // ---- —Ñ–æ—Ä–º–∞—Ç —Ü–µ–Ω—ã ----
  function formatPrice(price) {
    if (price === null || price === undefined || price === "") {
      return "Narx kelishiladi";
    }
    const s = String(price);
    return s.replace(/\B(?=(\d{3})+(?!\d))/g, " ") + " —Å—É–º";
  }

  // ---- —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã (–∫—Ä–∞—Ç–∫–æ) ----
  function formatDateShort(iso) {
    if (!iso) return "";
    try {
      const d = new Date(iso);
      const day = String(d.getDate()).padStart(2, "0");
      const month = String(d.getMonth() + 1).padStart(2, "0");
      return `${day}.${month}`;
    } catch (e) {
      return "";
    }
  }

  // ---- –∫–∞—Ä—Ç–æ—á–∫–∞ –¥–ª—è –±–ª–æ–∫–∞ "Yangi e'lonlar" (–≥–ª–∞–≤–Ω–∞—è) ----
  function createHomeAdCard(ad) {
    const card = document.createElement("article");
    card.className = "ad-card";

    const title = ad.title || "E'lon";
    const city = ad.city || "Shahar";
    const type = ad.type || "Tovar";
    const priceText = formatPrice(ad.price);
    const firstImage =
      ad.images && Array.isArray(ad.images) && ad.images.length > 0
        ? ad.images[0]
        : null;

    card.innerHTML = `
      <div class="ad-image"
        ${firstImage
          ? `style="background-image:url('${firstImage}');background-size:cover;background-position:center;"`
          : ""}></div>
      <div class="ad-content">
        <div class="ad-title">${title}</div>
        <div class="ad-meta">üìç ${city} ¬∑ ${type}</div>
        <div class="ad-price">${priceText}</div>
      </div>
    `;

    card.addEventListener("click", () => openAdDetails(ad));
    return card;
  }

  // ---- –∫–∞—Ä—Ç–æ—á–∫–∞ –¥–ª—è –≤–∫–ª–∞–¥–∫–∏ "–û–±—ä—è–≤–ª–µ–Ω–∏—è" ----
  function createListAdCard(ad) {
    const card = document.createElement("article");
    card.className = "ad-card";

    const title = ad.title || "E'lon";
    const city = ad.city || "Shahar";
    const type = ad.type || "Tovar";
    const priceText = formatPrice(ad.price);
    const created = formatDateShort(ad.created_at);
    const desc = ad.description || "";
    const firstImage =
      ad.images && Array.isArray(ad.images) && ad.images.length > 0
        ? ad.images[0]
        : null;

    card.innerHTML = `
      <div class="ad-image"
        ${firstImage
          ? `style="background-image:url('${firstImage}');background-size:cover;background-position:center;"`
          : ""}></div>
      <div class="ad-content">
        <div class="ad-title">${title}</div>
        <div class="ad-meta">
          üìç ${city} ¬∑ ${type}
          ${created ? ` ¬∑ ${created}` : ""}
        </div>
        <div class="ad-price">${priceText}</div>
        ${
          desc
            ? `<div class="ad-meta" style="margin-top:2px;">${desc}</div>`
            : ""
        }
      </div>
    `;

    card.addEventListener("click", () => openAdDetails(ad));
    return card;
  }

  // ---- –∑–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π ----
  let allAds = [];

  async function loadAds() {
    try {
      const res = await fetch(ADS_API_URL);
      if (!res.ok) throw new Error("Bad response");
      const data = await res.json();
      if (!Array.isArray(data)) return;

      allAds = data;

      // –ì–ª–∞–≤–Ω–∞—è
      if (homeAdsList) {
        homeAdsList.innerHTML = "";
        const latest = data.slice(0, 4);
        if (!latest.length) {
          homeAdsList.innerHTML =
            "<div class='ad-meta'>Hozircha e'lonlar yo'q.</div>";
        } else {
          latest.forEach((ad) => {
            const card = createHomeAdCard(ad);
            homeAdsList.appendChild(card);
          });
        }
      }

      // –°–ø–∏—Å–æ–∫
      renderListAds(data);
    } catch (err) {
      console.error("Xato yuklashda:", err);
      if (homeAdsList) {
        homeAdsList.innerHTML =
          "<div class='ad-meta'>E'lonlarni yuklashda xatolik. Keyinroq urinib ko'ring.</div>";
      }
      if (adList) {
        adList.innerHTML =
          "<div class='ad-meta'>E'lonlarni yuklashda xatolik. Keyinroq urinib ko'ring.</div>";
      }
    }
  }

  function renderListAds(list) {
    if (!adList) return;
    adList.innerHTML = "";
    if (!list.length) {
      adList.innerHTML = "<div class='ad-meta'>Hozircha e'lonlar yo'q.</div>";
      return;
    }
    list.forEach((ad) => {
      const card = createListAdCard(ad);
      adList.appendChild(card);
    });
  }

  // --- –ì–õ–û–ë–ê–õ–¨–ù–û–ï –°–û–°–¢–û–Ø–ù–ò–ï –ù–û–í–û–ì–û –û–ë–™–Ø–í–õ–ï–ù–ò–Ø ---
  const newAdDraft = {
    type: "–¢–æ–≤–∞—Ä",
    city: "–¢–∞—à–∫–µ–Ω—Ç",
    title: "",
    price: "",
    description: "",
    photoCount: 0,
    photos: [], // —Å—Å—ã–ª–∫–∏ ImgBB
  };

  // --- –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –≠–ö–†–ê–ù–û–í ---
  const screens = {
    home: document.getElementById("screen-home"),
    list: document.getElementById("screen-list"),
    profile: document.getElementById("screen-profile"),
    newAd1: document.getElementById("screen-new-ad-step1"),
    newAd2: document.getElementById("screen-new-ad-step2"),
    newAd3: document.getElementById("screen-new-ad-step3"),
    newAdSuccess: document.getElementById("screen-new-ad-success"),
    adDetails: screenAdDetails,
  };

  function showScreenSimple(name) {
    Object.values(screens).forEach((el) => el && el.classList.remove("active"));
    if (screens[name]) {
      screens[name].classList.add("active");
    }

    document
      .querySelectorAll(".nav-btn")
      .forEach((btn) => btn.classList.remove("active"));
    const activeBtn = document.querySelector(
      '.nav-btn[data-screen="' + name + '"]'
    );
    if (activeBtn) activeBtn.classList.add("active");
  }

  // --- –ù–ò–ñ–ù–ï–ï –ú–ï–ù–Æ ---
  document.querySelectorAll(".nav-btn").forEach((btn) => {
    btn.addEventListener("click", () => {
      const target = btn.getAttribute("data-screen");
      showScreen(target);
      if (target === "list") {
        loadAds();
      }
    });
  });

  // --- –ö–ù–û–ü–ö–ê "–ü–û–î–ê–¢–¨ –û–ë–™–Ø–í–õ–ï–ù–ò–ï" ---
  document.getElementById("btnOpenNewAd").addEventListener("click", () => {
    showScreen("newAd1");
  });

  document.getElementById("backFromNewAd1").addEventListener("click", () => {
    showScreen("home");
  });

  // --- –¢–ò–ü –û–ë–™–Ø–í–õ–ï–ù–ò–Ø ---
  const adTypeChips = document.querySelectorAll("#adTypeChips .chip");
  adTypeChips.forEach((chip) => {
    chip.addEventListener("click", () => {
      adTypeChips.forEach((c) => c.classList.remove("chip-filled"));
      chip.classList.add("chip-filled");
      newAdDraft.type = chip.getAttribute("data-type") || "–¢–æ–≤–∞—Ä";
    });
  });

  // --- –ü–û–õ–Ø –®–ê–ì–ê 1 ---
  const inputCity = document.getElementById("inputCity");
  const inputTitle = document.getElementById("inputTitle");
  const inputPrice = document.getElementById("inputPrice");
  const inputDescription = document.getElementById("inputDescription");

  document
    .getElementById("btnNewAdStep1Next")
    .addEventListener("click", () => {
      const title = (inputTitle.value || "").trim();
      const price = (inputPrice.value || "").trim();
      const desc = (inputDescription.value || "").trim();

      if (!title) {
        alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è.");
        return;
      }
      if (!price) {
        alert("–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É.");
        return;
      }

      newAdDraft.city = inputCity.value;
      newAdDraft.title = title;
      newAdDraft.price = price;
      newAdDraft.description = desc || "–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è";

      showScreen("newAd2");
    });

  // --- –®–ê–ì 2: –§–û–¢–û + –ó–ê–ì–†–£–ó–ö–ê –í IMGBB ---
  const btnUploadPhotos = document.getElementById("btnUploadPhotos");
  const inputPhotos = document.getElementById("inputPhotos");
  const photosPreview = document.getElementById("photosPreview");

  async function uploadToImgbb(file) {
    const formData = new FormData();
    formData.append("key", IMGBB_API_KEY);
    formData.append("image", file);

    const res = await fetch(IMGBB_UPLOAD_URL, {
      method: "POST",
      body: formData,
    });
    if (!res.ok) throw new Error("upload_failed");
    const json = await res.json();
    if (!json.success || !json.data || !json.data.url)
      throw new Error("bad_response");
    return json.data.url;
  }

  btnUploadPhotos.addEventListener("click", () => {
    inputPhotos.click();
  });

  inputPhotos.addEventListener("change", async () => {
    const files = Array.from(inputPhotos.files || []);
    photosPreview.innerHTML = "";
    newAdDraft.photos = [];
    newAdDraft.photoCount = 0;

    if (!files.length) return;

    const maxFiles = 8;
    const selected = files.slice(0, maxFiles);

    for (const file of selected) {
      // –ª–æ–∫–∞–ª—å–Ω–æ–µ –ø—Ä–µ–≤—å—é
      const reader = new FileReader();
      reader.onload = (e) => {
        const div = document.createElement("div");
        div.className = "photo-thumb";
        const img = document.createElement("img");
        img.src = e.target.result;
        div.appendChild(img);
        photosPreview.appendChild(div);
      };
      reader.readAsDataURL(file);

      // –∑–∞–≥—Ä—É–∑–∫–∞ –≤ ImgBB
      try {
        const url = await uploadToImgbb(file);
        newAdDraft.photos.push(url);
        newAdDraft.photoCount = newAdDraft.photos.length;
      } catch (e) {
        console.error("ImgBB upload error:", e);
      }
    }
  });

  document
    .getElementById("btnNewAdStep2Next")
    .addEventListener("click", () => {
      if (!newAdDraft.photoCount) {
        if (
          !confirm(
            "–í—ã –µ—â—ë –Ω–µ –¥–æ–±–∞–≤–∏–ª–∏ —Ñ–æ—Ç–æ. –í—Å—ë —Ä–∞–≤–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—é?"
          )
        ) {
          return;
        }
      }
      fillSummaryStep3();
      showScreen("newAd3");
    });

  document.getElementById("backFromNewAd2").addEventListener("click", () => {
    showScreen("newAd1");
  });

  // --- –®–ê–ì 3: –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï ---
  const summaryTitle = document.getElementById("summaryTitle");
  const summaryCityType = document.getElementById("summaryCityType");
  const summaryPrice = document.getElementById("summaryPrice");
  const summaryDescription = document.getElementById("summaryDescription");
  const summaryPhotosInfo = document.getElementById("summaryPhotosInfo");

  function fillSummaryStep3() {
    summaryTitle.textContent = newAdDraft.title || "–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è";
    summaryCityType.textContent =
      (newAdDraft.city || "–ì–æ—Ä–æ–¥") + " ¬∑ " + (newAdDraft.type || "–¢–æ–≤–∞—Ä");
    summaryPrice.textContent = newAdDraft.price
      ? newAdDraft.price + " —Å—É–º"
      : "–¶–µ–Ω–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞";
    summaryDescription.textContent =
      newAdDraft.description || "–û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ —É–∫–∞–∑–∞–Ω–æ.";
    summaryPhotosInfo.textContent =
      "–§–æ—Ç–æ: " + (newAdDraft.photoCount || 0) + " —à—Ç.";
  }

  document.getElementById("backFromNewAd3").addEventListener("click", () => {
    showScreen("newAd2");
  });

  // --- –ü–£–ë–õ–ò–ö–ê–¶–ò–Ø: –û–¢–ü–†–ê–í–ö–ê –ù–ê –ë–≠–ö–ï–ù–î ---
  const btnPublishAd = document.getElementById("btnPublishAd");

  async function publishAdToBackend() {
    btnPublishAd.disabled = true;
    btnPublishAd.textContent = "–ü—É–±–ª–∏–∫—É—é...";

    try {
      const payload = {
        type: newAdDraft.type,
        city: newAdDraft.city,
        title: newAdDraft.title,
        price: (newAdDraft.price || "").replace(/\s+/g, ""),
        description: newAdDraft.description,
        images: newAdDraft.photos, // –º–∞—Å—Å–∏–≤ —Å—Å—ã–ª–æ–∫ ImgBB
      };

      const res = await fetch(ADD_AD_API_URL, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(payload),
      });

      if (!res.ok) {
        throw new Error("Bad response");
      }

      inputTitle.value = "";
      inputPrice.value = "";
      inputDescription.value = "";
      photosPreview.innerHTML = "";
      if (inputPhotos) inputPhotos.value = "";

      newAdDraft.title = "";
      newAdDraft.price = "";
      newAdDraft.description = "";
      newAdDraft.photoCount = 0;
      newAdDraft.photos = [];

      showScreen("newAdSuccess");
      loadAds();
    } catch (err) {
      console.error("Xato saqlashda:", err);
      alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.");
    } finally {
      btnPublishAd.disabled = false;
      btnPublishAd.textContent = "–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ";
    }
  }

  btnPublishAd.addEventListener("click", publishAdToBackend);

  // --- –≠–ö–†–ê–ù –£–°–ü–ï–•–ê ---
  document.getElementById("btnGoToList").addEventListener("click", () => {
    showScreen("list");
    loadAds();
  });

  document.getElementById("btnGoHome").addEventListener("click", () => {
    showScreen("home");
    loadAds();
  });

  // --- –¢–ê–ë–´ –¢–æ–≤–∞—Ä—ã / –£—Å–ª—É–≥–∏ / –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å (—Ñ–∏–ª—å—Ç—Ä—ã –ø–æ type) ---
  const tabGoods = document.getElementById("tabGoods");
  const tabServices = document.getElementById("tabServices");
  const tabRealty = document.getElementById("tabRealty");

  function setActiveTab(activeBtn) {
    [tabGoods, tabServices, tabRealty].forEach((btn) => {
      if (!btn) return;
      btn.classList.remove("active");
    });
    if (activeBtn) activeBtn.classList.add("active");
  }

  function filterByType(typeName) {
    if (!allAds.length) {
      renderListAds([]);
      return;
    }
    if (!typeName) {
      renderListAds(allAds);
    } else {
      renderListAds(allAds.filter((ad) => ad.type === typeName));
    }
  }

  tabGoods.addEventListener("click", () => {
    setActiveTab(tabGoods);
    filterByType("–¢–æ–≤–∞—Ä");
  });

  tabServices.addEventListener("click", () => {
    setActiveTab(tabServices);
    filterByType("–£—Å–ª—É–≥–∞");
  });

  tabRealty.addEventListener("click", () => {
    setActiveTab(tabRealty);
    filterByType("–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å");
  });

  // --- –û–¢–ö–†–´–¢–ò–ï –ö–ê–†–¢–û–ß–ö–ò –û–ë–™–Ø–í–õ–ï–ù–ò–Ø + —Å–≤–∞–π–ø ---
function openAdDetails(ad) {
  if (!screenAdDetails) return;

  const title   = ad.title || "–û–±—ä—è–≤–ª–µ–Ω–∏–µ";
  const priceText = formatPrice(ad.price);
  const city    = ad.city || "–ì–æ—Ä–æ–¥";
  const type    = ad.type || "–¢–æ–≤–∞—Ä";
  const desc    = ad.description || "";
  const created = formatDateShort(ad.created_at);
  const images  = Array.isArray(ad.images) ? ad.images : [];

  currentDetailImages = images;
  currentDetailIndex  = 0;

  if (detailTitle)       detailTitle.textContent = title;
  if (detailPrice)       detailPrice.textContent = priceText;
  if (detailMeta)
    detailMeta.textContent = `üìç ${city} ¬∑ ${type}${created ? " ¬∑ " + created : ""}`;
  if (detailDescription) detailDescription.textContent = desc;

  // –≥–ª–∞–≤–Ω–æ–µ —Ñ–æ—Ç–æ
  if (images.length > 0) {
    setDetailMainImage(images[0]);
  } else {
    setDetailMainImage("");
  }

  // –º–∞–ª–µ–Ω—å–∫–∏–µ –ø—Ä–µ–≤—å—é
  if (detailThumbs) {
    detailThumbs.innerHTML = "";
    images.forEach((url, idx) => {
      const div = document.createElement("div");
      div.className = "detail-thumb";
      div.style.backgroundImage = `url('${url}')`;
      div.style.backgroundSize = "cover";
      div.style.backgroundPosition = "center";
      div.addEventListener("click", () => {
        currentDetailIndex = idx;
        setDetailMainImage(url);
      });
      detailThumbs.appendChild(div);
    });
  }

  showScreen("adDetails");
}

    // —Å–≤–∞–π–ø –ø–æ –≥–ª–∞–≤–Ω–æ–π –∫–∞—Ä—Ç–∏–Ω–∫–µ (–≤–ª–µ–≤–æ/–≤–ø—Ä–∞–≤–æ)
if (detailMainImage) {
  let touchStartX = null;

  detailMainImage.addEventListener("touchstart", (e) => {
    if (!e.touches || !e.touches.length) return;
    touchStartX = e.touches[0].clientX;
  });

  detailMainImage.addEventListener("touchend", (e) => {
    if (touchStartX === null || !e.changedTouches || !e.changedTouches.length)
      return;

    const dx = e.changedTouches[0].clientX - touchStartX;
    const threshold = 40; // –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ —Å–≤–∞–π–ø–∞

    if (Math.abs(dx) > threshold && currentDetailImages.length > 1) {
      if (dx < 0 && currentDetailIndex < currentDetailImages.length - 1) {
        // —Å–≤–∞–π–ø –≤–ª–µ–≤–æ ‚Äî —Å–ª–µ–¥—É—é—â–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞
        currentDetailIndex++;
      } else if (dx > 0 && currentDetailIndex > 0) {
        // —Å–≤–∞–π–ø –≤–ø—Ä–∞–≤–æ ‚Äî –ø—Ä–µ–¥—ã–¥—É—â–∞—è
        currentDetailIndex--;
      }
      const url = currentDetailImages[currentDetailIndex];
      setDetailMainImage(url);
    }

    touchStartX = null;
  });
}

  // –∫–Ω–æ–ø–∫–∞ ¬´–ù–∞–∑–∞–¥¬ª –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏
  if (detailBackBtn) {
    detailBackBtn.addEventListener("click", () => {
      showScreen("list");
    });
  }

  // –ü–ï–†–ï–û–ü–†–ï–î–ï–õ–Å–ù–ù–ê–Ø showScreen ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è
  function showScreen(name) {
    // –ø—Ä—è—á–µ–º –≤—Å–µ —ç–∫—Ä–∞–Ω—ã
    Object.values(screens).forEach((el) => {
      if (!el) return;
      el.classList.remove("active");
      el.style.display = "none";
    });

    // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π
    const target = screens[name];
    if (target) {
      target.classList.add("active");
      target.style.display = "block";
    }

    // –Ω–∏–∂–Ω–µ–µ –º–µ–Ω—é
    document
      .querySelectorAll(".nav-btn")
      .forEach((btn) => btn.classList.remove("active"));
    const activeBtn = document.querySelector(
      '.nav-btn[data-screen="' + name + '"]'
    );
    if (activeBtn) activeBtn.classList.add("active");

    // —Å–∫—Ä–æ–ª–ª –Ω–∞–≤–µ—Ä—Ö
    if (screensContainer) {
      screensContainer.scrollTop = 0;
    }
  }

  // ---- –ü–ï–†–í–´–ô –ó–ê–ü–£–°–ö ----
  loadAds();
  </script>
</body>
</html>
