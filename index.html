<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Zalvo Mini App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <style>
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
  }

  body {
    background: #f1f4ff;
    color: #0f172a;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
  }

  .app {
    background: #f9fafb;
    width: 100%;
    max-width: 480px;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    box-shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
  }

  /* HEADER */
  .app-header {
    padding: 12px 16px 10px;
    background: #ffffff;
    border-bottom: 1px solid rgba(148, 163, 184, 0.3);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .app-header-left {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .app-logo-small {
    width: 45px;
    height: 45px;
    border-radius: 9px;
  }

  .app-title {
    font-weight: 600;
    font-size: 16px;
    color: #0f172a;
  }

  .app-subtitle {
    font-size: 12px;
    color: #64748b;
  }

  /* SCREEN CONTAINER (–æ—Å–Ω–æ–≤–Ω–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ) */
  .screens {
    flex: 1;
    overflow-y: auto;
    padding: 12px 12px 72px;
  }

  .screen {
    display: none;
  }
  .screen.active {
    display: block;
  }

  .screen-title {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 10px;
  }

  /* SEARCH + FILTER BUTTON */
  .search-bar-row {
    display: flex;
    gap: 8px;
    margin-top: 4px;
    margin-bottom: 12px;
    align-items: stretch;
  }

  .search-bar {
    flex: 1;
  }

  .search-input {
    width: 100%;
    padding: 10px 12px;
    border-radius: 999px;
    border: 1px solid rgba(148, 163, 184, 0.6);
    font-size: 14px;
    padding-left: 32px;
    background: #ffffff
      url("data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 5a6 6 0 014.472 9.972l3.278 3.278a1 1 0 01-1.414 1.414l-3.278-3.278A6 6 0 1111 5zm0 2a4 4 0 100 8 4 4 0 000-8z' fill='%2394a3b8'/%3E%3C/svg%3E")
      no-repeat 10px center;
    background-size: 16px;
  }

  .filters-btn {
    border-radius: 14px;
    border: 1px solid rgba(148, 163, 184, 0.6);
    padding: 0 10px;
    font-size: 13px;
    background: #ffffff;
    color: #1d4ed8;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
    cursor: pointer;
    white-space: nowrap;
  }

  /* QUICK ACTIONS */
  .quick-actions-title {
    font-size: 14px;
    color: #64748b;
    margin-bottom: 6px;
  }

  .primary-btn {
    width: 100%;
    border: none;
    border-radius: 999px;
    padding: 13px 16px;
    font-size: 15px;
    font-weight: 600;
    color: #ffffff;
    background: linear-gradient(135deg, #2563eb, #1d4ed8);
    box-shadow: 0 8px 20px rgba(37, 99, 235, 0.35);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    margin-bottom: 10px;
    cursor: pointer;
  }

  /* –ü–†–û–ú–û-–ë–ê–ù–ù–ï–† –ü–û–î –ö–ù–û–ü–ö–û–ô */
  .promo-banner {
    margin: 8px 0 14px;
    border-radius: 18px;
    overflow: hidden;
    background: #000;
    cursor: pointer;
  }

  .promo-banner img {
    display: block;
    width: 100%;
    height: 195px;
    object-fit: cover;
  }

  .chip-row {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 12px;
  }

  .chip {
    border-radius: 999px;
    padding: 7px 12px;
    font-size: 13px;
    border: 1px solid rgba(148, 163, 184, 0.4);
    background: #ffffff;
    color: #0f172a;
    cursor: pointer;
  }
  .chip.chip-filled {
    background: #1d4ed8;
    color: #ffffff;
    border-color: transparent;
    box-shadow: 0 4px 14px rgba(37, 99, 235, 0.3);
  }

  .section-title {
    font-size: 15px;
    font-weight: 600;
    margin-bottom: 8px;
    margin-top: 4px;
  }

  /* POPULAR CATEGORIES */
  .category-grid {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 10px;
    margin-bottom: 12px;
  }

  .category-card {
    background: #ffffff;
    border-radius: 16px;
    padding: 10px 12px;
    box-shadow: 0 3px 10px rgba(15, 23, 42, 0.06);
    font-size: 14px;
    cursor: pointer;
    border: 1px solid transparent;
  }

  .category-card-title {
    font-weight: 600;
    margin-bottom: 2px;
  }

  .category-card-sub {
    font-size: 12px;
    color: #64748b;
  }

  .category-card.active {
    border-color: #1d4ed8;
    box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.3);
    background: #eff6ff;
  }

  /* LIST (TILE) */
  .ad-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 16px;
  }

  .ad-card {
    position: relative;
    display: flex;
    gap: 10px;
    background: #ffffff;
    border-radius: 16px;
    padding: 10px;
    box-shadow: 0 3px 10px rgba(15, 23, 42, 0.06);
    cursor: pointer;
    overflow: hidden;
  }

  .ad-card-badge {
    position: absolute;
    top: 8px;
    left: 8px;
    padding: 3px 8px;
    border-radius: 999px;
    font-size: 10px;
    font-weight: 600;
    background: linear-gradient(135deg, #fb923c, #f97316);
    color: #ffffff;
  }

  .ad-card-stats-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 4px;
    font-size: 11px;
    color: #94a3b8;
  }

  .ad-card-views {
    display: inline-flex;
    align-items: center;
    gap: 3px;
  }

  .ad-card-views::before {
    content: "üëÅ";
    font-size: 11px;
  }

  .ad-list.grid-mode {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 8px;
  }
  .ad-list.grid-mode .ad-card {
    flex-direction: column;
    padding: 8px;
  }
  .ad-list.grid-mode .ad-image {
    width: 100%;
    height: 120px;
  }

  .ad-image {
    width: 56px;
    height: 56px;
    border-radius: 14px;
    background: linear-gradient(135deg, #eff6ff, #dbeafe);
    flex-shrink: 0;
    background-size: cover;
    background-position: center;
  }

  .ad-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .ad-title {
    font-size: 14px;
    font-weight: 600;
  }

  .ad-meta {
    font-size: 12px;
    color: #64748b;
  }

  .ad-price {
    font-size: 14px;
    font-weight: 600;
    color: #16a34a;
    margin-top: 2px;
  }

  .ad-photos-count {
    font-size: 11px;
    color: #64748b;
    margin-top: 2px;
  }

  /* PROFILE / SETTINGS ‚Äî Telegram style */
#screen-profile {
  padding: 0 0 16px;
}

/* –≤–µ—Ä—Ö–Ω—è—è —á–∞—Å—Ç—å —Å –∞–≤–∞—Ç–∞—Ä–æ–º, –∏–º–µ–Ω–µ–º, –Ω–æ–º–µ—Ä–æ–º */
.settings-header {
  padding: 32px 16px 12px;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.settings-avatar {
  width: 110px;
  height: 110px;
  border-radius: 999px;
  background: #e5e7eb;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 48px;
  font-weight: 600;
  color: #111827;
  margin-bottom: 12px;
}

.settings-name {
  font-size: 24px;
  font-weight: 700;
  margin-bottom: 4px;
  text-align: center;
}

.settings-phone-row {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: 14px;
}

.settings-phone-link,
.settings-username {
  color: #1d4ed8;
  text-decoration: none;
}

.settings-dot {
  color: #6b7280;
}

/* –±–µ–ª—ã–µ –∫–∞—Ä—Ç—ã, –∫–∞–∫ –≤ Telegram */
.settings-card {
  margin: 8px 12px 0;
  background: #ffffff;
  border-radius: 24px;
  box-shadow: 0 2px 6px rgba(15, 23, 42, 0.06);
  overflow: hidden;
}

/* —Å—Ç—Ä–æ–∫–∞ –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ä—Ç—ã */
.settings-row {
  width: 100%;
  padding: 12px 16px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border: none;
  background: transparent;
  cursor: pointer;
}

.settings-row + .settings-row {
  border-top: 1px solid #e5e7eb;
}

.settings-row-left {
  display: flex;
  align-items: center;
  gap: 12px;
}

/* –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ –∏–∫–æ–Ω–∫–∏ —Å–ª–µ–≤–∞ */
.settings-row-icon {
  width: 38px;
  height: 38px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
}

/* —Ü–≤–µ—Ç–∞ –∏–∫–æ–Ω–æ–∫ –ø–æ–¥ Telegram */
.icon-photo     { background: #eff6ff; color: #1d4ed8; }
.icon-profile   { background: #fee2e2; color: #b91c1c; }
.icon-wallet    { background: #dbeafe; color: #1d4ed8; }
.icon-fav       { background: #fef3c7; color: #f59e0b; }
.icon-recent    { background: #dcfce7; color: #16a34a; }
.icon-devices   { background: #ffedd5; color: #ea580c; }
.icon-folders   { background: #e0f2fe; color: #0284c7; }
.icon-bell      { background: #fee2e2; color: #b91c1c; }

.settings-row-title {
  font-size: 15px;
}

/* —Å—Ç—Ä–µ–ª–∫–∞ —Å–ø—Ä–∞–≤–∞ */
.settings-row-arrow {
  color: #cbd5f5;
  font-size: 18px;
}
    
  /* NEW AD FORM */
  .back-link {
    font-size: 13px;
    color: #1d4ed8;
    margin-bottom: 6px;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 4px;
  }

  .form-group {
    margin-bottom: 10px;
  }

  .form-label {
    font-size: 13px;
    margin-bottom: 4px;
    display: block;
    color: #475569;
  }

  .form-input,
  .form-select,
  .form-textarea {
    width: 100%;
    border-radius: 12px;
    border: 1px solid rgba(148, 163, 184, 0.6);
    padding: 9px 10px;
    font-size: 14px;
    background: #ffffff;
  }

  .form-textarea {
    resize: vertical;
    min-height: 60px;
  }

  .hint {
    font-size: 12px;
    color: #94a3b8;
    margin-top: 2px;
  }

  .step-tag {
    display: inline-block;
    font-size: 11px;
    padding: 3px 7px;
    border-radius: 999px;
    background: #eff6ff;
    color: #1d4ed8;
    margin-left: 4px;
  }

  .photos-preview-row {
    display: flex;
    gap: 8px;
    flex-wrap: nowrap;
    overflow-x: auto;
    margin-top: 6px;
  }

  .photo-thumb {
    width: 64px;
    height: 64px;
    border-radius: 12px;
    overflow: hidden;
    background: #e5e7eb;
    flex-shrink: 0;
  }
  .photo-thumb img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .hidden-input {
    display: none;
  }

  /* SUCCESS SCREEN */
  .success-icon {
    width: 64px;
    height: 64px;
    border-radius: 999px;
    background: #dcfce7;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
    margin: 12px auto;
  }

  .success-text-main {
    font-size: 18px;
    font-weight: 600;
    text-align: center;
    margin-top: 6px;
  }

  .success-text-sub {
    font-size: 13px;
    color: #6b7280;
    text-align: center;
    margin-top: 4px;
    margin-bottom: 16px;
  }

  /* –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º .screens, —á—Ç–æ–±—ã –¥–∞—Ç—å –∑–∞–ø–∞—Å –ø–æ–¥ —Ç–∞–±-–±–∞—Ä */
  .screens {
    flex: 1;
    overflow-y: auto;
    padding: 12px 12px 120px;
    position: relative;
    z-index: 1;
  }

  /* === iOS-style tab bar === */
  .bottom-nav {
    position: fixed;
    bottom: 32px;
    left: 0;
    right: 0;
    width: 100%;
    padding: 4px 10px 6px;
    background: transparent;
    z-index: 50;
    display: flex;
    justify-content: center;
  }

  .bottom-nav-inner {
  width: 100%;
  max-width: 480px;

  background: rgba(255, 255, 255, 0.45); /* –±—ã–ª–æ 0.96 ‚Üí —Å—Ç–∞–ª–æ –Ω–∞–º–Ω–æ–≥–æ –ø—Ä–æ–∑—Ä–∞—á–Ω–µ–µ */

  border-radius: 26px;

  box-shadow: 0 10px 30px rgba(15, 23, 42, 0.20);

  padding: 6px 10px;

  display: flex;
  justify-content: space-between;
  align-items: stretch;

  backdrop-filter: blur(28px) saturate(180%); /* —Å–∏–ª—å–Ω–æ–µ —Å—Ç–µ–∫–ª—è–Ω–Ω–æ–µ —Ä–∞–∑–º—ã—Ç–∏–µ */
  -webkit-backdrop-filter: blur(28px) saturate(180%);
}
    
  /* –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é ‚Äî —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ –∏–∫–æ–Ω–∫–∏ –∏ —Ç–µ–∫—Å—Ç */
.nav-btn {
  flex: 1;
  border: none;
  background: transparent;
  border-radius: 999px;

  min-height: 64px;               /* –±–æ–ª—å—à–µ –≤—ã—Å–æ—Ç–∞ */
  padding: 6px 8px;               /* —á—É—Ç—å –±–æ–ª—å—à–µ –æ—Ç—Å—Ç—É–ø—ã */

  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;

  gap: 4px;                       /* –±–æ–ª—å—à–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –∏–∫–æ–Ω–∫–æ–π –∏ —Ç–µ–∫—Å—Ç–æ–º */

  font-size: 13px;                /* —Ç–µ–∫—Å—Ç –±–æ–ª—å—à–µ */
  color: #111827;

  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
  outline: none;
  pointer-events: auto;
}

/* —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∏–∫–æ–Ω–∫–∏ */
.nav-btn .icon {
  font-size: 23px;                /* ***–ò–∫–æ–Ω–∫–∞ –±–æ–ª—å—à–µ*** */
  line-height: 1;
  pointer-events: none;
}

.nav-btn span {
  pointer-events: none;
  font-weight: 500;               /* —á—É—Ç—å —á—ë—Ç—á–µ */
}

/* –∞–∫—Ç–∏–≤–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞ */
.nav-btn.active {
  background: #ffffff;
  color: #007aff;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.12);
}

.nav-btn.active .icon {
  color: #007aff;
}

  /* HEADER –≤ –∫–∞—Ä—Ç–æ—á–∫–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è */
  .ad-view-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
  }

  .ad-view-back-btn {
    width: 32px;
    height: 32px;
    border-radius: 999px;
    border: 1px solid rgba(148, 163, 184, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    background: #ffffff;
    cursor: pointer;
    font-size: 18px;
  }

  .ad-view-header-title {
    font-size: 17px;
    font-weight: 600;
  }

  .ad-view-card {
    background: #ffffff;
    border-radius: 20px;
    padding: 12px;
    box-shadow: 0 6px 18px rgba(15, 23, 42, 0.06);
  }

  #detailMainImage {
    width: 100%;
    height: 260px;
    border-radius: 16px;
    background: #e5e7eb;
    margin-bottom: 12px;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    display: flex;
  }

  .detail-main-slide {
    min-width: 100%;
    height: 100%;
    flex-shrink: 0;
    scroll-snap-align: center;
    background-size: cover;
    background-position: center;
    border-radius: 16px;
  }

  .detail-thumbs {
    display: flex;
    gap: 8px;
    overflow-x: auto;
    margin-bottom: 10px;
  }

  .detail-thumb {
    width: 56px;
    height: 56px;
    border-radius: 12px;
    background: #e5e7eb;
    background-size: cover;
    background-position: center;
    flex-shrink: 0;
  }

  .ad-view-title-row {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 8px;
    margin-top: 8px;
    margin-bottom: 4px;
  }

  .ad-view-title-box {
    flex: 1;
    min-width: 0;
  }

  .ad-view-icon-row {
    display: flex;
    gap: 8px;
    flex-shrink: 0;
  }

  .icon-circle-btn {
    width: 32px;
    height: 32px;
    border-radius: 999px;
    border: 1px solid #d1d5db;
    background: #ffffff;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 17px;
    cursor: pointer;
    padding: 0;
  }
  .icon-circle-btn:active {
    transform: scale(0.96);
  }

  .ad-view-main-title {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 4px;
  }

  .ad-view-price {
    font-size: 18px;
    font-weight: 700;
    color: #16a34a;
    margin-bottom: 2px;
  }

  .ad-view-meta {
    font-size: 13px;
    color: #6b7280;
    margin-bottom: 2px;
  }

  .ad-view-description-title {
    font-size: 14px;
    font-weight: 600;
    margin-top: 8px;
    margin-bottom: 4px;
  }

  .ad-view-description {
    font-size: 14px;
    color: #374151;
    margin-bottom: 8px;
  }

  .ad-view-seller-card {
    margin-top: 8px;
    padding: 10px;
    border-radius: 16px;
    background: #f9fafb;
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
  }

  .ad-view-seller-card:hover {
    background: #eef2ff;
  }

  .ad-view-seller-info-main {
    font-size: 14px;
    font-weight: 600;
  }

  .ad-view-seller-info-sub {
    font-size: 12px;
    color: #6b7280;
  }

  .ad-view-seller-status {
    font-size: 12px;
    color: #16a34a;
    margin-top: 2px;
  }

  .ad-view-actions-row {
    display: flex;
    gap: 10px;
    margin-top: 12px;
    align-items: stretch;
  }

  .call-btn,
  .msg-btn {
    flex: 1;
    padding: 13px 0;
    font-size: 15px;
    font-weight: 600;
    border-radius: 999px;
    text-align: center;
    text-decoration: none;
    color: #ffffff;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .call-btn {
    background: #22c55e;
  }

  .msg-btn {
    background: #3b82f6;
  }

  .similar-section {
    margin-top: 16px;
  }

  .similar-title {
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 6px;
  }

  .similar-list {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .similar-card {
    display: flex;
    gap: 8px;
    padding: 8px;
    border-radius: 12px;
    background: #f9fafb;
    cursor: pointer;
  }

  .similar-image {
    width: 52px;
    height: 52px;
    border-radius: 12px;
    background: #e5e7eb;
    background-size: cover;
    background-position: center;
    flex-shrink: 0;
  }

  .similar-content-title {
    font-size: 13px;
    font-weight: 600;
  }

  .similar-content-meta {
    font-size: 11px;
    color: #6b7280;
  }

  .similar-content-price {
    font-size: 13px;
    font-weight: 600;
    color: #16a34a;
  }

  /* –õ–∞–π—Ç–±–æ–∫—Å */
  .lightbox {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.9);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 9999;
  }

  .lightbox.visible {
    display: flex;
  }

  .lightbox img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
  }

  .lightbox-close-hint {
    position: absolute;
    bottom: 20px;
    left: 0;
    right: 0;
    text-align: center;
    color: rgba(255, 255, 255, 0.7);
    font-size: 12px;
  }

  .lightbox-arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 40px;
    height: 40px;
    border-radius: 999px;
    border: none;
    background: rgba(15, 23, 42, 0.6);
    color: #ffffff;
    font-size: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
  }

  .lightbox-prev {
    left: 12px;
  }

  .lightbox-next {
    right: 12px;
  }

  /* –§–ò–õ–¨–¢–†–´ –≠–ö–†–ê–ù */
  .filters-section-title {
    font-size: 14px;
    font-weight: 600;
    margin: 10px 0 6px;
  }

  .filters-actions-row {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-top: 12px;
  }

  /* Promo screen */
  .promo-screen-card {
    background: #ffffff;
    border-radius: 20px;
    padding: 14px;
    box-shadow: 0 6px 18px rgba(15, 23, 42, 0.08);
    margin-bottom: 14px;
  }

  .promo-screen-subtitle {
    font-size: 13px;
    color: #64748b;
    margin-bottom: 10px;
  }

  .promo-plan-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .promo-plan {
    border-radius: 16px;
    padding: 10px 12px;
    background: #f9fafb;
    border: 1px solid #e5e7eb;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 8px;
  }

  .promo-plan-main {
    flex: 1;
    min-width: 0;
  }

  .promo-plan-name {
    font-size: 14px;
    font-weight: 600;
  }

  .promo-plan-desc {
    font-size: 12px;
    color: #6b7280;
    margin-top: 2px;
  }

  .promo-plan-price {
    font-size: 14px;
    font-weight: 600;
    color: #16a34a;
    white-space: nowrap;
  }

  .promo-plan-tag {
    display: inline-block;
    font-size: 11px;
    padding: 3px 8px;
    border-radius: 999px;
    background: #eff6ff;
    color: #1d4ed8;
    margin-top: 4px;
  }

  .promo-help-text {
    font-size: 12px;
    color: #94a3b8;
    margin-top: 10px;
  }

  /* Toast */
  .toast {
    position: fixed;
    left: 50%;
    bottom: 80px;
    transform: translateX(-50%) translateY(120%);
    opacity: 0;
    transition: all 0.25s ease-out;
    max-width: 460px;
    width: calc(100% - 40px);
    z-index: 9998;
  }

  .toast-inner {
    background: #0f172a;
    color: #f9fafb;
    border-radius: 999px;
    padding: 10px 14px;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
    box-shadow: 0 18px 40px rgba(15, 23, 42, 0.4);
  }

  .toast-icon {
    font-size: 16px;
  }

  .toast-text-main {
    font-weight: 600;
  }

  .toast-text-sub {
    font-size: 12px;
    color: #e5e7eb;
  }

  .toast.show {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }

  /* Chat */
  .chat-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
  }

  .chat-header-title {
    font-size: 16px;
    font-weight: 600;
  }

  .chat-header-sub {
    font-size: 12px;
    color: #64748b;
  }

  .chat-messages {
    background: #e5e7eb;
    border-radius: 16px;
    padding: 8px;
    max-height: 420px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .chat-message {
    max-width: 80%;
    padding: 7px 10px;
    border-radius: 14px;
    font-size: 13px;
    line-height: 1.35;
    background: #ffffff;
    align-self: flex-start;
  }

  .chat-message.me {
    background: #1d4ed8;
    color: #ffffff;
    align-self: flex-end;
    border-bottom-right-radius: 4px;
  }

  .chat-message.other {
    background: #ffffff;
    color: #0f172a;
    border-bottom-left-radius: 4px;
  }

  .chat-input-row {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 10px;
  }

  .chat-input {
    flex: 1;
    border-radius: 999px;
    border: 1px solid rgba(148, 163, 184, 0.7);
    padding: 8px 10px;
    font-size: 14px;
    background: #ffffff;
  }

  .chat-send-btn {
    flex-shrink: 0;
    border-radius: 999px;
    border: none;
    padding: 9px 12px;
    font-size: 14px;
    background: #1d4ed8;
    color: #ffffff;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
  }

  .history-empty-text {
    font-size: 13px;
    color: #94a3b8;
    margin-top: 6px;
  }

  /* Admin */
  .admin-card {
    background: #ffffff;
    border-radius: 20px;
    padding: 14px;
    box-shadow: 0 6px 18px rgba(15, 23, 42, 0.08);
    margin-bottom: 14px;
  }

  .admin-section-title {
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 6px;
  }

  .admin-stat-row {
    display: flex;
    justify-content: space-between;
    gap: 10px;
    margin-bottom: 8px;
  }

  .admin-stat {
    flex: 1;
    background: #f9fafb;
    border-radius: 16px;
    padding: 8px 10px;
    border: 1px solid #e5e7eb;
  }

  .admin-stat-number {
    font-size: 16px;
    font-weight: 700;
    color: #1d4ed8;
  }

  .admin-stat-label {
    font-size: 12px;
    color: #6b7280;
  }

  .admin-list {
    margin-top: 4px;
  }

  .admin-list-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 0;
    border-bottom: 1px solid #e5e7eb;
    font-size: 13px;
  }

  .admin-list-item:last-child {
    border-bottom: none;
  }

  .admin-list-label {
    color: #475569;
  }

  .admin-list-value {
    font-weight: 600;
    color: #0f172a;
  }

  .admin-badge {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 999px;
    font-size: 11px;
    background: #fee2e2;
    color: #b91c1c;
  }

    .settings-list {
  margin-top: 8px;
  background: #ffffff;
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 3px 10px rgba(15, 23, 42, 0.06);
}

.settings-item {
  width: 100%;
  padding: 12px 14px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  font-size: 14px;
  border: none;
  background: #ffffff;
  border-bottom: 1px solid #e5e7eb;
  cursor: pointer;
  text-align: left;
}

.settings-item:last-child {
  border-bottom: none;
}

.settings-item-left {
  display: flex;
  align-items: center;
  gap: 10px;
}

.settings-item-icon {
  font-size: 18px;
}

.settings-item-chevron {
  font-size: 14px;
  color: #cbd5e1;
}

    /* ===== –ü—Ä–æ—Ñ–∏–ª—å / –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (–≤ —Å—Ç–∏–ª–µ –¢–µ–ª–µ–≥—Ä–∞–º–∞) ===== */

.settings-profile-header {
  padding: 24px 16px 12px;
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
}

.settings-avatar-big {
  width: 96px;
  height: 96px;
  border-radius: 999px;
  background: #e5e7eb;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 40px;
  font-weight: 600;
  color: #111827;
  margin-bottom: 12px;
}

.settings-name {
  font-size: 22px;
  font-weight: 700;
  color: #111827;
  margin-bottom: 4px;
}

.settings-username {
  font-size: 13px;
  color: #64748b;
}

.settings-link {
  color: #1d4ed8;
  text-decoration: none;
}

.settings-card {
  margin: 10px 12px 0;
  background: #ffffff;
  border-radius: 24px;
  box-shadow: 0 8px 24px rgba(15, 23, 42, 0.06);
  overflow: hidden;
}

.settings-row {
  width: 100%;
  padding: 13px 16px;
  display: flex;
  align-items: center;
  gap: 12px;
  background: transparent;
  border: none;
  border-top: 1px solid #f1f5f9;
  font: inherit;
  cursor: pointer;
}

.settings-row:first-child {
  border-top: none;
}

.settings-icon {
  width: 34px;
  height: 34px;
  border-radius: 12px;
  background: #f1f5f9;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 19px;
}

.settings-title {
  flex: 1;
  text-align: left;
  font-size: 15px;
  color: #111827;
}

.settings-arrow {
  font-size: 16px;
  color: #cbd5f5;
}

    /* === ZALVO BIZNES UCHUN SCREEN === */

#screen-business {
  padding: 12px 16px 24px;
}

.business-header {
  text-align: left;
  margin-bottom: 16px;
}

.business-icon-wrap {
  margin: 10px 0 12px;
  display: flex;
  justify-content: center;
}

.business-icon-inner {
  width: 96px;
  height: 96px;
  border-radius: 999px;
  background: radial-gradient(circle at 30% 20%, #a855f7, #6366f1);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 40px;
  color: #ffffff;
  box-shadow: 0 16px 40px rgba(79, 70, 229, 0.35);
}

.business-title {
  font-size: 24px;
  font-weight: 700;
  color: #0f172a;
  margin-bottom: 6px;
  text-align: center; 
}

.business-subtitle {
  font-size: 14px;
  color: #6b7280;
  text-align: center;
  max-width: 320px;
  margin: 0 auto;
}

/* –∫–∞—Ä—Ç–æ—á–∫–∞ —Å –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞–º–∏ */
.business-card {
  margin-top: 16px;
  background: #ffffff;
  border-radius: 22px;
  box-shadow: 0 8px 24px rgba(15, 23, 42, 0.08);
  padding: 10px 0 8px;
}

.business-feature-row {
  display: flex;
  align-items: center;
  padding: 10px 14px;
  gap: 10px;
}

.business-divider {
  height: 1px;
  background: #e5e7eb;
  margin: 0 14px;
}

.business-feature-icon {
  width: 34px;
  height: 34px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  color: #ffffff;
}

/* —Ü–≤–µ—Ç–∞ –∏–∫–æ–Ω–æ–∫ */
.business-feature-icon-orange {
  background: #f97316;
}
.business-feature-icon-blue {
  background: #3b82f6;
}
.business-feature-icon-pink {
  background: #ec4899;
}
.business-feature-icon-gold {
  background: #f59e0b;
}

.business-feature-main {
  flex: 1;
}

.business-feature-title {
  font-size: 15px;
  font-weight: 600;
  color: #111827;
}

.business-feature-sub {
  font-size: 13px;
  color: #6b7280;
}

/* beta text */
.business-beta {
  font-size: 13px;
  color: #4b5563;
  padding: 10px 14px 12px;
  border-top: 1px solid #e5e7eb;
  margin-top: 2px;
}

/* CTA */
.business-cta {
  margin-top: 18px;
}

.business-cta-btn {
  width: 100%;
  border: none;
  border-radius: 999px;
  padding: 13px 16px;
  font-size: 15px;
  font-weight: 600;
  color: #ffffff;
  background: linear-gradient(135deg, #4f46e5, #6366f1);
  box-shadow: 0 10px 26px rgba(79, 70, 229, 0.4);
  cursor: pointer;
}

.business-cta-btn:active {
  transform: scale(0.97);
}

.business-cta-hint {
  margin-top: 6px;
  font-size: 12px;
  color: #9ca3af;
  text-align: center;
}

 /* --- –ë–ê–ó–û–í–´–ô –§–û–ù –î–õ–Ø –≠–ö–†–ê–ù–ê –ú–ê–ì–ê–ó–ò–ù–ê --- */
.store-page {
  background: #f5f6fa;
  min-height: 100vh;
  padding: 0 0 16px 0;
  display: flex;
  flex-direction: column;
  align-items: center; /* —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –≤—Å—ë –ø–æ —ç–∫—Ä–∞–Ω—É */
  gap: 12px;
  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
}

/* --- –û–ë–õ–û–ñ–ö–ê –° –§–û–ù–û–ú –¢–ï–õ–ï–§–û–ù–û–í --- */
.store-cover {
  position: relative;
  height: 190px;
  width: 100vw;            /* —à–∏—Ä–∏–Ω–∞ –ø–æ —ç–∫—Ä–∞–Ω—É */
  max-width: 480px;        /* —á—Ç–æ–±—ã –Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö –Ω–µ —Ä–∞–∑—ä–µ–∑–∂–∞–ª–æ—Å—å */
  border-radius: 22px;
  overflow: visible;
  box-shadow: 0 14px 32px rgba(15, 23, 42, 0.16);
  background: #e5e7eb;
}

.store-cover img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}
    
/* --- –ê–í–ê–¢–ê–† –° –õ–û–ì–û–¢–ò–ü–û–ú --- */
.store-avatar {
  position: absolute;
  left: 50%;
  bottom: -40px;           /* –æ—Ç—Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–æ, —á—Ç–æ–±—ã –ù–ï –∑–∞–∫—Ä—ã–≤–∞—Ç—å —Ç–µ–∫—Å—Ç */
  transform: translateX(-50%);
  width: 96px;
  height: 96px;
  border-radius: 50%;
  background: #ffffff;
  padding: 6px;
  box-shadow: 0 10px 25px rgba(15, 23, 42, 0.28);
  z-index: 2;
}

.store-avatar img {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  object-fit: cover;
}

/* --- –û–ë–©–ò–ô –°–¢–ò–õ–¨ –ö–ê–†–¢–û–ß–ï–ö (iOS card view) --- */
.store-card {
  background: #ffffff;
  border-radius: 18px;
  padding: 16px 16px;
  box-shadow: 0 10px 26px rgba(15, 23, 42, 0.10);
  width: calc(100vw - 24px); /* —à–∏—Ä–∏–Ω–∞ = —ç–∫—Ä–∞–Ω - 12px —Å–ª–µ–≤–∞/—Å–ø—Ä–∞–≤–∞ */
  max-width: 472px;          /* 480 - 8 –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã */
}

/* --- –ö–ê–†–¢–û–ß–ö–ê –ü–†–û–§–ò–õ–Ø –ú–ê–ì–ê–ó–ò–ù–ê --- */
.store-profile {
  margin-top: -14px;         /* —Å–ª–µ–≥–∫–∞ –∑–∞–ª–µ–∑–∞–µ–º –Ω–∞ —Ñ–æ–Ω */
  padding-top: 54px;         /* –¥–∞—ë–º –º–µ—Å—Ç–æ –ø–æ–¥ –∞–≤–∞—Ç–∞—Ä–∫—É */
  text-align: center;
}

.store-name {
  font-size: 20px;
  font-weight: 700;
  color: #111827;
  margin-bottom: 4px;
}

.store-subs {
  font-size: 13px;
  color: #6b7280;
  margin-bottom: 8px;
}

.store-rating {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 4px;
  font-size: 13px;
  color: #6b7280;
  margin-bottom: 12px;
}

.store-rating-stars {
  color: #fbbf24;
  letter-spacing: 2px;
  font-size: 14px;
}

.store-rating-count {
  color: #6b7280;
}

/* --- –†–Ø–î –ö–ù–û–ü–û–ö: OBUNA, YOZISH, ... --- */
.store-actions {
  display: grid;
  grid-template-columns: 1.3fr 1.3fr 0.6fr;
  gap: 8px;
  margin-top: 4px;
}

.store-btn {
  border-radius: 999px;
  padding: 10px 0;
  border: none;
  font-size: 14px;
  font-weight: 500;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
}

.store-btn-primary {
  background: #5a4bff;
  color: #ffffff;
}

.store-btn-secondary {
  background: #f3f4f6;
  color: #111827;
}

.store-btn-more {
  background: #f3f4f6;
  color: #111827;
  font-size: 20px;
}

/* --- –ö–ê–°–¢–û–ú–ù–´–ï –ò–ö–û–ù–ö–ò --- */
.icon-pill {
  width: 20px;
  height: 20px;
  border-radius: 999px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-size: 11px;
  color: #ffffff;
}

.icon-pill-bell { background: #5a4bff; }
.icon-pill-msg  { background: #10b981; }

/* --- –ö–ê–†–¢–û–ß–ö–ê –ö–û–ù–¢–ê–ö–¢–û–í --- */
.store-section-title {
  font-size: 15px;
  font-weight: 600;
  color: #111827;
  margin-bottom: 8px;
}

.store-contacts-list {
  display: flex;
  flex-direction: column;
  gap: 6px;
  font-size: 13px;
  color: #111827;
}

.store-contact-row {
  display: flex;
  align-items: center;
  gap: 8px;
}

.store-contact-icon {
  width: 22px;
  height: 22px;
  border-radius: 999px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-size: 13px;
  color: #ffffff;
}

.store-contact-icon.phone { background: #5a4bff; }
.store-contact-icon.tg    { background: #1d9bf0; }
.store-contact-icon.ig    { background: #e11d48; }
.store-contact-icon.loc   { background: #f97316; }
.store-contact-icon.clock { background: #10b981; }

.store-contact-row a {
  color: #2563eb;
  text-decoration: none;
}

.store-contact-row small {
  color: #6b7280;
}

.store-about-text {
  font-size: 13px;
  color: #6b7280;
  line-height: 1.4;
}

/* --- –ë–õ–û–ö E‚ÄòLONLAR: –ó–ê–ì–û–õ–û–í–û–ö + –ü–û–ò–°–ö + –§–ò–õ–¨–¢–† --- */
.store-ads-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 8px;
}

.store-ads-title {
  font-size: 16px;
  font-weight: 600;
  color: #111827;
}

.store-search-row {
  display: flex;
  gap: 8px;
  margin-bottom: 4px;
}

.store-search-input {
  flex: 1;
  background: #f3f4f6;
  border-radius: 999px;
  border: none;
  padding: 9px 12px;
  font-size: 13px;
  display: flex;
  align-items: center;
  gap: 6px;
}

.store-search-input input {
  border: none;
  background: transparent;
  outline: none;
  font-size: 13px;
  width: 100%;
}

.store-search-input span {
  color: #6b7280;
}

.store-filter-btn {
  width: 40px;
  border-radius: 999px;
  background: #f3f4f6;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
}

/* --- –ö–ê–†–¢–û–ß–ö–ê –û–ë–™–Ø–í–õ–ï–ù–ò–Ø --- */
.store-ad-card {
  background: #ffffff;
  border-radius: 16px;
  padding: 10px;
  display: flex;
  gap: 10px;
  box-shadow: 0 8px 20px rgba(15, 23, 42, 0.10);
}

.store-ad-img {
  width: 90px;
  height: 90px;
  border-radius: 12px;
  overflow: hidden;
  background: #e5e7eb;
  flex-shrink: 0;
}

.store-ad-img img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.store-ad-info {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}

.store-ad-title {
  font-size: 14px;
  font-weight: 600;
  color: #111827;
  margin-bottom: 2px;
}

.store-ad-price {
  font-size: 15px;
  font-weight: 700;
  color: #16a34a;
  margin-bottom: 4px;
}

.store-ad-meta {
  font-size: 11px;
  color: #6b7280;
  display: flex;
  justify-content: space-between;
}

    /* ===== GRID –æ–±—ä—è–≤–ª–µ–Ω–∏–π –≤–Ω—É—Ç—Ä–∏ –º–∞–≥–∞–∑–∏–Ω–∞ ===== */
#screen-my-shop .ad-list{
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
}

    /* –∫–∞—Ä—Ç–æ—á–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –≤ –º–∞–≥–∞–∑–∏–Ω–µ */
#screen-my-shop .ad-card{
  flex-direction: column;
  padding: 8px;
  border-radius: 16px;
}

    #screen-my-shop .ad-image{
  width: 100%;
  aspect-ratio: 1 / 1;   /* üî• –∫–≤–∞–¥—Ä–∞—Ç */
  height: auto;
  border-radius: 12px;
  margin-bottom: 6px;
}

    #screen-my-shop .ad-title{
  font-size: 13px;
  line-height: 1.3;
}

#screen-my-shop .ad-price{
  font-size: 14px;
  font-weight: 700;
}

#screen-my-shop .ad-meta{
  font-size: 11px;
}
    
@keyframes sheetUp {
  from { transform: translateY(40px); opacity: 0; }
  to   { transform: translateY(0); opacity: 1; }
}

  /* –ù–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö, —á—Ç–æ–±—ã –Ω–µ –ø—Ä–∏–ª–∏–ø–∞–ª–æ –∫ –±–æ–∫–∞–º */
  @media (max-width: 480px) {
    .store-page {
      padding: 12px;
    }
  }

    /* –û–±—ë—Ä—Ç–∫–∞, —á—Ç–æ–±—ã –∫–Ω–æ–ø–∫–∞ –±—ã–ª–∞ –Ω–∞–¥ —Ñ–æ–Ω–æ–º –º–∞–≥–∞–∑–∏–Ω–∞ */
.store-back-wrapper {
  position: relative;
  z-index: 3;
  padding: 16px 0 0 16px; /* –æ—Ç—Å—Ç—É–ø –æ—Ç –≤–µ—Ä—Ö–Ω–µ–≥–æ –∫—Ä–∞—è –∏ —Å–ª–µ–≤–∞ */
}

/* –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ –≤ —Å—Ç–∏–ª–µ iOS */
.store-back-button {
  width: 40px;
  height: 40px;
  border-radius: 999px;
  border: none;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;

  background: rgba(255, 255, 255, 0.92);
  box-shadow: 0 8px 20px rgba(15, 23, 42, 0.18);

  cursor: pointer;
}

/* –ë–ª—é—Ä, –µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è */
@supports (backdrop-filter: blur(16px)) {
  .store-back-button {
    background: rgba(255, 255, 255, 0.72);
    backdrop-filter: blur(16px);
  }
}

.store-back-icon {
  width: 18px;
  height: 18px;
  fill: #111827;
}

    /* ===== iOS BACK BUTTON (global) ===== */
.ios-back-btn {
  width: 40px;
  height: 40px;
  border-radius: 999px;
  border: none;
  padding: 0;
  display: none;              /* —Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
  align-items: center;
  justify-content: center;
  background: rgba(255, 255, 255, 0.92);
  box-shadow: 0 8px 20px rgba(15, 23, 42, 0.14);
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
}
@supports (backdrop-filter: blur(16px)) {
  .ios-back-btn {
    background: rgba(255, 255, 255, 0.70);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
  }
}
.ios-back-btn svg {
  width: 18px;
  height: 18px;
  fill: #111827;
}
.ios-back-btn:active {
  transform: scale(0.96);
}

/* –º–∞–ª–µ–Ω—å–∫–∏–π –æ—Ç—Å—Ç—É–ø –º–µ–∂–¥—É –∫–Ω–æ–ø–∫–æ–π –Ω–∞–∑–∞–¥ –∏ –ª–æ–≥–æ—Ç–∏–ø–æ–º */
.app-header-left {
  gap: 10px;
}

/* ===== iOS-like slide animation on back ===== */
.screens.ios-back-anim {
  transition: transform 0.22s ease-out, opacity 0.22s ease-out;
  transform: translateX(22px);
  opacity: 0.92;
}

/* ===== STORE BOTTOM SHEET (–≤–µ—Ä–Ω—É–ª —Ç–æ, —á—Ç–æ —Ç—ã —Å–ª—É—á–∞–π–Ω–æ ‚Äú—Å–ª–æ–º–∞–ª‚Äù) ===== */
.store-sheet-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(15, 23, 42, 0.35);
  display: none;
  align-items: flex-end;
  justify-content: center;
  z-index: 999;
}

.store-sheet-backdrop.active {
  display: flex;
}

.store-sheet {
  width: 100%;
  max-width: 480px;
  background: #ffffff;
  border-radius: 24px 24px 0 0;
  padding: 10px 16px 18px;
  box-shadow: 0 -10px 30px rgba(15, 23, 42, 0.25);
  animation: sheetUp 0.18s ease-out;
}

.store-sheet-handle {
  width: 40px;
  height: 4px;
  border-radius: 999px;
  background: #e5e7eb;
  margin: 4px auto 10px;
}

.store-sheet-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.store-sheet-item {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 15px;
  color: #111827;
  padding: 10px 6px;
  border-radius: 12px;
}

.store-sheet-item:active {
  background: #f3f4f6;
}

.store-sheet-icon {
  width: 30px;
  height: 30px;
  border-radius: 999px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-size: 15px;
  color: #ffffff;
}

.store-sheet-icon.block { background: #6b7280; }
.store-sheet-icon.share { background: #2563eb; }
.store-sheet-icon.report { background: #ef4444; }

    /* iOS-style secondary / outline button */
.outline-btn {
  width: 100%;
  border-radius: 999px;
  padding: 13px 16px;
  font-size: 15px;
  font-weight: 500;

  background: #f3f4f6;        /* —Å–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π –∫–∞–∫ iOS */
  color: #111827;

  border: 1px solid #e5e7eb;

  display: flex;
  align-items: center;
  justify-content: center;

  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
}

.outline-btn:active {
  transform: scale(0.97);
  background: #e5e7eb;
}

    /* –ù–∏–∂–Ω–∏–π –±–∞—Ä –Ω–µ –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –∫–ª–∏–∫–∏ –ø–æ —ç–∫—Ä–∞–Ω—É */
.bottom-nav {
  pointer-events: none;
}

/* –ù–æ —Å–∞–º–∏ –∫–Ω–æ–ø–∫–∏ –¥–æ–ª–∂–Ω—ã –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–º–∏ */
.bottom-nav-inner,
.nav-btn {
  pointer-events: auto;
}

    .filters-actions-row {
  position: relative;
  z-index: 100;
}
    /* toast –Ω–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∫–ª–∏–∫–∏, –¥–∞–∂–µ –∫–æ–≥–¥–∞ –æ–Ω hidden */
.toast {
  pointer-events: none;
}

    /* --- –†–Ø–î –ö–ù–û–ü–û–ö: OBUNA (big) + YOZISH (icon) + ‚Ä¶ (icon) --- */
.store-actions{
  display: flex;
  align-items: center;
  gap: 10px;
  margin-top: 8px;
  flex-wrap: nowrap;
}

.store-btn{
  height: 46px;
  border-radius: 999px;
  border: none;
  font-size: 14px;
  font-weight: 600;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
}

/* –±–æ–ª—å—à–∞—è –∫–Ω–æ–ø–∫–∞ */
.store-btn-primary{
  flex: 1;
  min-width: 0;
  padding: 0 16px;
  background: #5a4bff;
  color: #fff;
}

/* –º–∞–ª–µ–Ω—å–∫–∏–µ –∏–∫–æ–Ω–∫–∏ */
.store-btn-icon{
  width: 46px;
  padding: 0;
  background: #f3f4f6;
  color: #111827;
  font-size: 18px;
  font-weight: 700;
}

/* —á—Ç–æ–±—ã –∏–∫–æ–Ω–∫–∞ –≤–Ω—É—Ç—Ä–∏ –Ω–µ –ª–æ–≤–∏–ª–∞ –∫–ª–∏–∫–∏ */
.store-btn-icon span,
.store-btn-primary span{
  pointer-events: none;
}

    /* ================== SHOPS UI ================== */
.shops-search-row{
  display:flex;
  gap:8px;
  align-items:stretch;
  margin-top:6px;
  margin-bottom:6px;
}
.shops-search{
  flex:1;
}
.shops-search-input{
  width:100%;
  padding:10px 12px;
  border-radius:999px;
  border:1px solid rgba(148,163,184,0.6);
  font-size:14px;
  padding-left:32px;
  background:#ffffff
    url("data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 5a6 6 0 014.472 9.972l3.278 3.278a1 1 0 01-1.414 1.414l-3.278-3.278A6 6 0 1111 5zm0 2a4 4 0 100 8 4 4 0 000-8z' fill='%2394a3b8'/%3E%3C/svg%3E")
    no-repeat 10px center;
  background-size:16px;
}
.shops-filter-btn{
  width:44px;
  border-radius:14px;
  border:1px solid rgba(148,163,184,0.6);
  background:#ffffff;
  color:#1d4ed8;
  cursor:pointer;
}

.top-shops-row{
  display:flex;
  gap:10px;
  overflow-x:auto;
  padding-bottom:4px;
}
.shop-mini{
  min-width:180px;
  background:#ffffff;
  border-radius:18px;
  padding:10px;
  box-shadow:0 3px 10px rgba(15,23,42,0.06);
  border:1px solid transparent;
  cursor:pointer;
}
.shop-mini:hover{ background:#eff6ff; border-color:rgba(37,99,235,0.25); }
.shop-mini-head{
  display:flex;
  gap:10px;
  align-items:center;
}
.shop-mini-avatar{
  width:46px;
  height:46px;
  border-radius:14px;
  background:linear-gradient(135deg,#eff6ff,#dbeafe);
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:800;
  color:#1d4ed8;
}
.shop-mini-title{
  font-weight:700;
  font-size:14px;
}
.shop-mini-sub{
  font-size:12px;
  color:#64748b;
  margin-top:1px;
}
.shop-mini-badges{
  display:flex;
  gap:6px;
  margin-top:8px;
  flex-wrap:wrap;
}
.shop-badge{
  font-size:11px;
  padding:3px 8px;
  border-radius:999px;
  background:#f1f5f9;
  color:#0f172a;
}
.shop-badge.verified{ background:#dcfce7; color:#16a34a; }

.shops-list{
  display:flex;
  flex-direction:column;
  gap:8px;
  margin-bottom:10px;
}
.shop-card{
  display:flex;
  gap:10px;
  background:#ffffff;
  border-radius:18px;
  padding:10px;
  box-shadow:0 3px 10px rgba(15,23,42,0.06);
  cursor:pointer;
}
.shop-card-avatar{
  width:56px;
  height:56px;
  border-radius:16px;
  background:linear-gradient(135deg,#eff6ff,#dbeafe);
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:800;
  color:#1d4ed8;
  flex-shrink:0;
}
.shop-card-main{ flex:1; min-width:0; }
.shop-card-title{
  font-size:14px;
  font-weight:700;
}
.shop-card-meta{
  font-size:12px;
  color:#64748b;
  margin-top:2px;
}
.shop-card-stats{
  display:flex;
  gap:10px;
  margin-top:6px;
  font-size:12px;
  color:#64748b;
}
.shop-stat{
  display:inline-flex;
  align-items:center;
  gap:4px;
}
.shop-actions{
  display:flex;
  flex-direction:column;
  gap:8px;
  justify-content:center;
}
.shop-open-btn{
  border:none;
  border-radius:999px;
  padding:9px 12px;
  font-size:13px;
  font-weight:700;
  background:#1d4ed8;
  color:#ffffff;
  cursor:pointer;
}
.shop-msg-btn{
  border:none;
  border-radius:999px;
  padding:9px 12px;
  font-size:13px;
  font-weight:700;
  background:#f3f4f6;
  color:#111827;
  cursor:pointer;
}

    /* ‚úÖ –ö–æ–≥–¥–∞ –æ—Ç–∫—Ä—ã—Ç –ª—é–±–æ–π bottom-sheet ‚Äî –ø—Ä—è—á–µ–º –Ω–∏–∂–Ω–µ–µ –º–µ–Ω—é */
body.sheet-open .bottom-nav {
  opacity: 0;
  pointer-events: none;
  transform: translateY(18px);
  transition: all 0.18s ease-out;
}

/* ‚úÖ Bottom-sheet –≤—Å–µ–≥–¥–∞ –ø–æ–≤–µ—Ä—Ö –Ω–∏–∂–Ω–µ–≥–æ –º–µ–Ω—é */
.store-sheet-backdrop {
  z-index: 3000 !important;
}
.store-sheet {
  z-index: 3001 !important;
}

/* ‚úÖ –ß—É—Ç—å –±–æ–ª—å—à–µ –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É, —á—Ç–æ–±—ã –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ —É–ø–∏—Ä–∞–ª—Å—è */
.store-sheet {
  padding-bottom: calc(18px + env(safe-area-inset-bottom, 0px));
}

    /* ‚úÖ Bottom-sheet –≤—Å–µ–≥–¥–∞ –°–í–ï–†–•–£ –≤—Å–µ–≥–æ */
.store-sheet-backdrop { z-index: 99999 !important; }
.store-sheet         { z-index: 100000 !important; }

/* ‚úÖ 100% –≤—ã–∫–ª—é—á–∞–µ–º –Ω–∏–∂–Ω–µ–µ –º–µ–Ω—é, –∫–æ–≥–¥–∞ –æ—Ç–∫—Ä—ã—Ç sheet */
body.sheet-open .bottom-nav {
  display: none !important;
}

    .shop-view-avatar{
  width: 100%;
  height: 100%;
  border-radius: 999px;
  background: linear-gradient(135deg,#eff6ff,#dbeafe);
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:800;
  color:#1d4ed8;
  font-size: 30px;
}

    /* –∫–Ω–æ–ø–∫–∞ ‚ãØ –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ */
.shop-card{ position: relative; }
.shop-more-btn{
  position: absolute;
  right: 14px;
  top: 50%;
  transform: translateY(-50%);
  width: 44px;
  height: 44px;
  border-radius: 16px;
  border: 0;
  background: rgba(0,0,0,.06);
  font-size: 22px;
  line-height: 1;
}

    /* ===== SHOPS ACTION SHEET (–∫–∞–∫ –≤ "–ú–æ–π –º–∞–≥–∞–∑–∏–Ω") ===== */
.store-sheet-backdrop{
  position: fixed;
  inset: 0;
  background: rgba(15,23,42,.35);
  display: none;
  align-items: flex-end;
  justify-content: center;
  padding: 12px;
  z-index: 99999 !important;
}

.store-sheet-backdrop.active{ display:flex; }

.store-sheet{
  width: 100%;
  max-width: 480px;
  background: #fff;
  border-radius: 24px;
  padding: 10px 16px 16px;
  box-shadow: 0 20px 60px rgba(0,0,0,.25);
  padding-bottom: calc(16px + env(safe-area-inset-bottom, 0px));
}

.store-sheet-handle{
  width: 42px;
  height: 5px;
  border-radius: 999px;
  background: #e5e7eb;
  margin: 6px auto 12px;
}

.shop-sheet-title{
  font-size: 20px;
  font-weight: 900;
  color: #0f172a;
  margin-bottom: 10px;
}

.store-sheet-list{
  display:flex;
  flex-direction: column;
  gap: 10px;
}

.store-sheet-item{
  width: 100%;
  border: 0;
  background: #fff;
  border-radius: 18px;
  padding: 14px 12px;
  font-size: 16px;
  font-weight: 700;
  display:flex;
  align-items:center;
  gap: 12px;
  cursor:pointer;
  box-shadow: 0 2px 10px rgba(15,23,42,.06);
}

.store-sheet-item:active{
  transform: scale(0.99);
  background: #f8fafc;
}

.store-sheet-item.danger{
  color: #dc2626;
}

.store-sheet-icon{
  width: 38px;
  height: 38px;
  border-radius: 999px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size: 16px;
  color:#fff;
}

.store-sheet-icon.share{ background:#2563eb; }
.store-sheet-icon.report{ background:#ef4444; }

/* –ü—Ä—è—á–µ–º –Ω–∏–∂–Ω–µ–µ –º–µ–Ω—é –∫–æ–≥–¥–∞ –æ—Ç–∫—Ä—ã—Ç sheet */
body.sheet-open .bottom-nav{ display:none !important; }

    /* ===== TOP SHOPS (Instagram-like) ===== */
#topShopsRow{
  display:flex;
  gap:14px;
  overflow-x:auto;
  padding:10px 2px 2px;
  scroll-snap-type:x mandatory;
  -webkit-overflow-scrolling:touch;
}
#topShopsRow::-webkit-scrollbar{ display:none; }

.top-shop-ig{
  flex:0 0 235px;
  background:#fff;
  border-radius:18px;
  padding:12px 12px 14px;
  box-shadow:0 8px 20px rgba(15,23,42,.06);
  scroll-snap-align:start;
  position:relative;
}

.top-shop-ig-menu{
  position:absolute;
  top:10px;
  right:10px;
  width:34px;
  height:34px;
  border-radius:12px;
  border:0;
  background:#f1f5f9;
  color:#0f172a;
  font-size:20px;
  line-height:34px;
}

.top-shop-ig-center{
  display:flex;
  flex-direction:column;
  align-items:center;
  text-align:center;
  padding-top:14px;
}

.top-shop-ig-avatar{
  width:86px;
  height:86px;
  border-radius:999px;
  background:#eef2ff;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:900;
  font-size:26px;
  color:#1d4ed8;
  margin-bottom:10px;
}

.top-shop-ig-name{
  font-weight:900;
  font-size:17px;
  line-height:1.1;
  max-width:190px;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}

.top-shop-ig-meta{
  margin-top:6px;
  font-size:13px;
  color:#64748b;
  line-height:1.2;
  max-width:200px;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}

.top-shop-ig-meta2{
  margin-top:6px;
  font-size:13px;
  color:#94a3b8;
  max-width:200px;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}

.top-shop-ig-btn{
  margin-top:12px;
  width:100%;
  border:0;
  border-radius:14px;
  padding:12px 12px;
  font-weight:900;
  font-size:15px;
  background:#2563eb;
  color:#fff;
}

.top-shop-ig-btn.subscribed{
  background:#e2e8f0;
  color:#0f172a;
}

    /* ===== Smart Header Hide/Show ===== */
.app-header{
  position: sticky;
  top: 0;
  z-index: 50;
  transition: transform .22s ease, box-shadow .22s ease;
  will-change: transform;
}

.app-header.header-hidden{
  transform: translateY(-110%);
  box-shadow: none;
}

#reportSheetBackdrop { pointer-events: auto; }
#reportSheetBackdrop .store-sheet { pointer-events: auto; }
#reportCancelBtn { pointer-events: auto; position: relative; z-index: 5; }

    /* Universal cancel button (iOS style) */
.store-sheet-cancel {
  width: 100%;
  margin-top: 12px;
  padding: 14px 16px;
  font-size: 16px;
  font-weight: 600;
  border-radius: 14px;
  border: none;
  background: #f1f5f9;
  color: #0f172a;
  cursor: pointer;
}

.store-sheet-cancel:active {
  transform: scale(0.98);
  background: #e5e7eb;
}

    /* –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –º–∞–≥–∞–∑–∏–Ω–æ–≤ ‚Äî –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª –≤ 1 —Å—Ç—Ä–æ–∫—É */
#shopsCategoryRow{
  display: flex;
  flex-wrap: nowrap;          /* ‚úÖ –Ω–µ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å */
  gap: 10px;
  overflow-x: auto;           /* ‚úÖ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª */
  overflow-y: hidden;
  white-space: nowrap;
  padding: 6px 2px 10px;
  -webkit-overflow-scrolling: touch;  /* iOS –ø–ª–∞–≤–Ω–æ */
  scrollbar-width: none;      /* Firefox —Å–∫—Ä—ã—Ç—å —Å–∫—Ä–æ–ª–ª–±–∞—Ä */
}

#shopsCategoryRow::-webkit-scrollbar{
  display: none;              /* Chrome/Safari —Å–∫—Ä—ã—Ç—å —Å–∫—Ä–æ–ª–ª–±–∞—Ä */
}

/* –ß—Ç–æ–±—ã –∫–∞–∂–¥–∞—è chip –Ω–µ —Å–∂–∏–º–∞–ª–∞—Å—å */
#shopsCategoryRow .chip{
  flex: 0 0 auto;
}
    
  @media (max-width: 480px) {
    body {
      align-items: stretch;
    }
    .app {
      border-radius: 0;
      box-shadow: none;
    }
  }
  </style>
</head>
<body>
  <div class="app">
    <!-- HEADER -->
    <header class="app-header">
      <div class="app-header-left">
        <img src="zalvo-logo.png" alt="MarketHub" class="app-logo-small" />
        <div>
          <div class="app-title">Zalvo</div>
          <div class="app-subtitle">Uzbekiston ¬∑ elonlari</div>
        </div>
      </div>
    </header>

    <!-- SCREENS -->
    <main class="screens">

      <!-- ================= HOME SCREEN ================= -->
      <section id="screen-home" class="screen active">
        <div class="search-bar-row">
          <div class="search-bar">
            <input
              type="text"
              placeholder="Nima qidiryapsiz?"
              class="search-input"
            />
          </div>
          <button id="openFiltersBtn" class="filters-btn">‚öôÔ∏è Filtr</button>
        </div>

        <button id="btnOpenNewAd" class="primary-btn">
          ‚ûï E'lon joylash
        </button>

        <div id="promoBanner" class="promo-banner">
  <img src="zalvo-promo-banner.jpg" alt="MarketHub ‚Äî biznesingiz uchun yangi mijozlar" 
    alt="MarketHub promo"
  />
</div>

        <div class="section-title">Mashhur bo‚Äòlimlar</div>
        <div id="homeCategoryGrid" class="category-grid">
  <div class="category-card" data-category="Transport">
    <div class="category-card-title">Transport</div>
    <div class="category-card-sub">Mashinalar, mopedlar</div>
  </div>

  <div class="category-card" data-category="Ko‚Äòchmas mulk">
    <div class="category-card-title">Ko'chmas mulk</div>
    <div class="category-card-sub">Ijaraga, sotiladi</div>
  </div>

  <div class="category-card" data-category="Elektronika">
    <div class="category-card-title">Elektronika</div>
    <div class="category-card-sub">Telefon, laptop</div>
  </div>

  <div class="category-card" data-category="Xizmatlar">
    <div class="category-card-title">Xizmatlar</div>
    <div class="category-card-sub">Usta, servis</div>
  </div>
</div>

        <div class="hint" style="margin-bottom:10px;">
          üìå Kategoriyani yana bir marta bosing ‚Äî barcha e‚Äôlonlar qaytadi
        </div>

        <div id="feedList" class="ad-list grid-mode"></div>
      </section>

      <!-- ================= FAVORITES ================= -->
      <section id="screen-favorites" class="screen">
        <div class="screen-title">Sevimlilar</div>
        <div id="favoritesList" class="ad-list"></div>
      </section>

      <section id="screen-my-ads" class="screen">
  <div class="screen-title">Mening e‚Äôlonlarim</div>
  <div id="myAdsList" class="ad-list"></div>
</section>

      <!-- ================= FILTERS SCREEN ================= -->
      <section id="screen-filters" class="screen">
        <div class="screen-title">Filtrlar</div>

        <div class="filters-section-title">Turi</div>
        <div class="filters-section-title">Kategoriya</div>
<div id="filterCategoryRow" class="chip-row">
  <div class="chip chip-filled" data-category="all">Hammasi</div>
  <div class="chip" data-category="Transport">Transport</div>
  <div class="chip" data-category="Ko‚Äòchmas mulk">Ko‚Äòchmas mulk</div>
  <div class="chip" data-category="Elektronika">Elektronika</div>
  <div class="chip" data-category="Xizmatlar">Xizmatlar</div>
  <div class="chip" data-category="Ish">Ish</div>
  <div class="chip" data-category="Uy-rozg‚Äòor">Uy-rozg‚Äòor</div>
  <div class="chip" data-category="Bolalar">Bolalar</div>
  <div class="chip" data-category="Hayvonlar">Hayvonlar</div>
  <div class="chip" data-category="Hobbi/Sport">Hobbi/Sport</div>
  <div class="chip" data-category="Boshqa">Boshqa</div>
</div>

        <div class="filters-section-title">Viloyat</div>

<select id="filterCity" class="form-select">
  <option value="all">Hammasi</option>

  <option value="Toshkent shahri">Toshkent shahri</option>
  <option value="Toshkent viloyati">Toshkent viloyati</option>
  <option value="Andijon">Andijon</option>
  <option value="Buxoro">Buxoro</option>
  <option value="Farg‚Äòona">Farg‚Äòona</option>
  <option value="Jizzax">Jizzax</option>
  <option value="Xorazm">Xorazm</option>
  <option value="Namangan">Namangan</option>
  <option value="Navoiy">Navoiy</option>
  <option value="Qashqadaryo">Qashqadaryo</option>
  <option value="Samarqand">Samarqand</option>
  <option value="Sirdaryo">Sirdaryo</option>
  <option value="Surxondaryo">Surxondaryo</option>
  <option value="Qoraqalpog‚Äòiston">Qoraqalpog‚Äòiston</option>
</select>

        <div class="filters-section-title">Valyuta</div>
        <div id="filterCurrencyRow" class="chip-row">
          <div class="chip" data-currency="sum">So‚Äòm</div>
          <div class="chip" data-currency="usd">USD</div>
        </div>

        <div class="filters-section-title">Qo‚Äòshimcha</div>
        <div id="filterPhotoChip" class="chip">Faqat rasmlar bilan</div>

        <div class="filters-section-title">Saralash</div>
        <select id="filterSort" class="form-select">
          <option value="default">Standart</option>
          <option value="date">Yangi e‚Äôlonlar</option>
          <option value="cheap">Arzon</option>
          <option value="expensive">Qimmat</option>
        </select>

        <div class="filters-actions-row">
          <button id="filtersApplyBtn" class="primary-btn">Natijalarni ko‚Äòrsatish</button>
          <button id="filtersResetBtn" class="outline-btn">Tozalash</button>
          <button id="filtersBack" class="outline-btn">Orqaga</button>
        </div>
      </section>

      <!-- ================= AD DETAILS ================= -->
      <section id="screen-ad-details" class="screen">
        <div class="ad-view-header">
          <div id="detailBackBtn" class="ad-view-back-btn">‚Üê</div>
          <div class="ad-view-header-title">E'lon</div>
        </div>

        <div class="ad-view-card">
          <div id="detailMainImage"></div>
          <div id="detailThumbs" class="detail-thumbs"></div>

          <div class="ad-view-title-row">
            <div class="ad-view-title-box">
              <div id="detailTitle" class="ad-view-main-title"></div>
              <div id="detailPrice" class="ad-view-price"></div>
              <div id="detailMeta" class="ad-view-meta"></div>
            </div>
            <div class="ad-view-icon-row">
              <button id="favoriteBtn" class="icon-circle-btn">‚ô°</button>
              <button id="shareBtn" class="icon-circle-btn">‚§¥Ô∏è</button>
            </div>
          </div>

          <div class="ad-view-description-title">Tavsif</div>
          <div id="detailDescription" class="ad-view-description"></div>

          <div id="sellerCard" class="ad-view-seller-card">
            <div>
              <div class="ad-view-seller-info-main">Baxir B-R (@Baxir1987)</div>
              <div class="ad-view-seller-info-sub">‚≠ê 4.9 ¬∑ 23 sharh ¬∑ 12 e‚Äôlon</div>
              <div class="ad-view-seller-status">üü¢ Oxirgi marta: yaqinda</div>
            </div>
          </div>

          <div class="ad-view-actions-row">
            <a id="callSellerBtn" href="#" class="call-btn">üìû Qo‚Äòng‚Äòiroq</a>
            <a id="msgSellerBtn" href="#" class="msg-btn">‚úâÔ∏è Yozish</a>
          </div>

          <div class="similar-section">
            <div class="similar-title">O‚Äòxshash e‚Äôlonlar</div>
            <div id="similarList" class="similar-list"></div>
          </div>
        </div>
      </section>

      <!-- ================= PROFILE / SETTINGS (Telegram style) ================= -->
<section id="screen-profile" class="screen">
  <!-- –®–∞–ø–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è -->
  <div class="settings-profile-header">
  <div id="profileAvatar" class="settings-avatar-big">B</div>
    <div class="settings-name">Baxir B-R</div>
    <div class="settings-username">
      <a href="tel:+16195479977" class="settings-link">+1 619 547 9977</a>
      ¬∑
      <span class="settings-link">@Baxir1987</span>
    </div>
  </div>

  <input
  id="profilePhotoInput"
  type="file"
  accept="image/*"
  class="hidden-input"
/>
  
  <!-- 1. Rasmini o‚Äòzgartirish -->
  <div class="settings-card">
    <button id="settingsChangePhoto" class="settings-row">
      <div class="settings-icon">üì∑</div>
      <div class="settings-title">Rasmini o‚Äòzgartirish</div>
      <div class="settings-arrow">‚Ä∫</div>
    </button>
  </div>

  <!-- 2. Profil / Dokon / E'lonlar / Sevimlilar / Tarix -->
  <div class="settings-card">
    <button id="settingsProfileRow" class="settings-row">
      <div class="settings-icon">üë§</div>
      <div class="settings-title">Profilim</div>
      <div class="settings-arrow">‚Ä∫</div>
    </button>

    <button id="settingsMyShopRow" class="settings-row">
      <div class="settings-icon">üè¨</div>
      <div class="settings-title">Mening do‚Äòkonim</div>
      <div class="settings-arrow">‚Ä∫</div>
    </button>

    <button id="settingsMyAdsRow" class="settings-row">
      <div class="settings-icon">üìã</div>
      <div class="settings-title">Mening e‚Äôlonlarim</div>
      <div class="settings-arrow">‚Ä∫</div>
    </button>

    <button id="settingsFavoritesRow" class="settings-row">
      <div class="settings-icon">‚≠ê</div>
      <div class="settings-title">Sevimlilar</div>
      <div class="settings-arrow">‚Ä∫</div>
    </button>

    <button id="settingsHistoryRow" class="settings-row">
      <div class="settings-icon">üïí</div>
      <div class="settings-title">Ko‚Äòrish tarixi</div>
      <div class="settings-arrow">‚Ä∫</div>
    </button>
  </div>

  <!-- 3. Til / Pullik / Admin / Biznes -->
  <div class="settings-card">
    <button id="settingsLangRow" class="settings-row">
      <div class="settings-icon">üåê</div>
      <div class="settings-title">Tilni tanlash (uz/ru)</div>
      <div class="settings-arrow">‚Ä∫</div>
    </button>

    <button id="settingsPaidRow" class="settings-row">
      <div class="settings-icon">üíé</div>
      <div class="settings-title">Pullik xizmatlar</div>
      <div class="settings-arrow">‚Ä∫</div>
    </button>

    <button id="settingsAdminRow" class="settings-row">
      <div class="settings-icon">üõ†</div>
      <div class="settings-title">Admin paneli</div>
      <div class="settings-arrow">‚Ä∫</div>
    </button>

    <button id="settingsBusinessRow" class="settings-row">
      <div class="settings-icon">üìä</div>
      <div class="settings-title">Zalvo biznes uchun</div>
      <div class="settings-arrow">‚Ä∫</div>
    </button>
  </div>

  <!-- 4. Yordam / Savollar -->
  <div class="settings-card">
    <button id="settingsHelpRow" class="settings-row">
      <div class="settings-icon">‚ùì</div>
      <div class="settings-title">Yordam</div>
      <div class="settings-arrow">‚Ä∫</div>
    </button>

    <button id="settingsQuestionsRow" class="settings-row">
      <div class="settings-icon">üí¨</div>
      <div class="settings-title">Zalvo haqida savollar</div>
      <div class="settings-arrow">‚Ä∫</div>
    </button>
  </div>
</section>

            <!-- ================= MY SHOP (MENING DO‚ÄòKONIM) ================= -->
      <section id="screen-my-shop" class="screen">
        <div class="store-page">
          
          <!-- –û–ë–õ–û–ñ–ö–ê + –ê–í–ê–¢–ê–† -->
          <div class="store-cover">
            <!-- –ó–ê–ú–ï–ù–ò –ø—É—Ç—å –∫ –∫–∞—Ä—Ç–∏–Ω–∫–µ –ø–æ–¥ —Å–µ–±—è -->
            <img src="iphone14-pro.jpg" alt="Telefonlar">
            <div class="store-avatar">
              <!-- —Å—é–¥–∞ —Å—Ç–∞–≤–∏—à—å –ª–æ–≥–æ—Ç–∏–ø ZALVO -->
              <img src="zalvo-logo.png" alt="Zalvo logo">
            </div>
          </div>

          <!-- –ö–ê–†–¢–û–ß–ö–ê –ü–†–û–§–ò–õ–Ø –ú–ê–ì–ê–ó–ò–ù–ê -->
          <div class="store-card store-profile">
            <div class="store-name">Zalvo Phone Shop</div>
            <div class="store-subs">451 obunachi</div>

            <div class="store-rating">
              <span class="store-rating-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
              <span class="store-rating-count">4.9 (451 baho)</span>
            </div>

      <div class="store-actions">
  <button class="store-btn store-btn-primary" id="storeSubscribeBtn" type="button">
    <span class="icon-pill icon-pill-bell">üîî</span>
    <span>Obuna bo‚Äòlish</span>
  </button>

  <button class="store-btn store-btn-icon" id="storeMsgBtn" type="button" aria-label="Yozish">
    ‚úâÔ∏è
  </button>

  <button class="store-btn store-btn-icon" id="storeMoreBtn" type="button" aria-label="Ko‚Äòproq">
    ‚Ä¶
  </button>
</div>
          </div>
        
          <!-- –ö–û–ù–¢–ê–ö–¢–´ -->
          <div class="store-card">
            <div class="store-section-title">Kontaktlar</div>

            <div class="store-contacts-list">
              <div class="store-contact-row">
                <span class="store-contact-icon phone">üìû</span>
                <a href="tel:+998991234567">+998 99 123 45 67</a>
              </div>

              <div class="store-contact-row">
                <span class="store-contact-icon tg">‚úàÔ∏è</span>
                <a href="https://t.me/gulzor_shop" target="_blank">@gulzor_shop</a>
              </div>

              <div class="store-contact-row">
                <span class="store-contact-icon ig">üì∏</span>
                <a href="https://instagram.com/zalvo_shop" target="_blank">@zalvo_shop</a>
              </div>

              <div class="store-contact-row">
                <span class="store-contact-icon loc">üìç</span>
                <span>Mirzo Ulug‚Äòbek tumani, Toshkent</span>
              </div>

              <div class="store-contact-row">
                <span class="store-contact-icon clock">‚è∞</span>
                <span>
                  <strong>Bugun ochiq</strong>: Du‚ÄìJu 09:00‚Äì20:00, Ju 09:00‚Äì18:00
                </span>
              </div>
            </div>
          </div>

          <!-- –û –ú–ê–ì–ê–ó–ò–ù–ï -->
          <div class="store-card">
            <div class="store-section-title">Do‚Äòkon haqida</div>
            <p class="store-about-text">
              Zalvo Phone Shop ‚Äî original smartfonlar va aksessuarlar do‚Äòkoni.
              Kafolat, tezkor yetkazib berish va qulay narxlar.
            </p>
          </div>

          <!-- E‚ÄòLONLAR DO‚ÄòKON ICHIDA -->
          <div class="store-card">
            <div class="store-ads-header">
              <div class="store-ads-title">E‚Äòlonlar</div>
            </div>

            <div class="store-search-row">
              <div class="store-search-input">
                <span>üîç</span>
                <input id="shopAdsSearchInput" type="text" placeholder="E‚Äòlonlar ichidan qidirish">
              </div>
              <button class="store-filter-btn" id="shopAdsFilterBtn">‚â°</button>
            </div>

            <!-- –í–ê–ñ–ù–û: –û–°–¢–ê–í–õ–Ø–ï–ú –≠–¢–û–¢ DIV, –ß–¢–û–ë–´ –†–ê–ë–û–¢–ê–õ –ö–û–î renderMyShopAds() -->
            <div id="myShopAdsList" class="ad-list"></div>
          </div>

        </div>
      </section>
      
      <!-- ================= PROMOTION SCREEN ================= -->
      <section id="screen-promo" class="screen">
        <div class="screen-title">E‚Äôlonni ilgari surish</div>

        <div class="promo-screen-card">
          <div class="promo-screen-subtitle">
            E‚Äôloningizni yuqori o‚Äòringa olib chiqing!
          </div>

          <div class="promo-plan-list">
            <div class="promo-plan">
              <div class="promo-plan-main">
                <div class="promo-plan-name">TOP 24 soat</div>
                <div class="promo-plan-desc">E‚Äôlon 1 kun yuqorida turadi</div>
              </div>
              <div class="promo-plan-price">6 000 so‚Äòm</div>
            </div>

            <div class="promo-plan">
              <div class="promo-plan-main">
                <div class="promo-plan-name">TOP 7 kun</div>
                <div class="promo-plan-desc">E‚Äôlon hafta davomida ustida turadi</div>
              </div>
              <div class="promo-plan-price">25 000 so‚Äòm</div>
            </div>

            <div class="promo-plan">
              <div class="promo-plan-main">
                <div class="promo-plan-name">Super-Tezkor</div>
                <div class="promo-plan-desc">E‚Äôloningiz birinchi qatorga chiqadi</div>
                <div class="promo-plan-tag">Tavsiya etiladi</div>
              </div>
              <div class="promo-plan-price">40 000 so‚Äòm</div>
            </div>
          </div>

          <div class="promo-help-text">
            üí° Tezkor sotish uchun ‚ÄúSuper-Tezkor‚Äù paket tavsiya qilinadi.
          </div>
        </div>
      </section>

      <!-- ================= CHAT ================= -->
      <section id="screen-chat" class="screen">
        <div class="chat-header">
          <div class="chat-header-title">Chat bilan sotuvchi</div>
        </div>

        <div id="chatMessages" class="chat-messages"></div>

        <div class="chat-input-row">
          <input id="chatInput" type="text" class="chat-input" placeholder="Xabar yozish..." />
          <button id="chatSendBtn" class="chat-send-btn">‚û§</button>
        </div>
      </section>

      <!-- ================= HISTORY ================= -->
      <section id="screen-history" class="screen">
        <div class="screen-title">Ko‚Äòrish tarixi</div>
        <div id="historyList" class="ad-list"></div>
      </section>

            <!-- ================= SHOPS (DO'KONLAR) ================= -->
<section id="screen-shops" class="screen">
  <div class="screen-title">Do‚Äòkonlar</div>

  <!-- Search + filter -->
  <div class="shops-search-row">
    <div class="shops-search">
      <input id="shopsSearchInput" class="shops-search-input" type="text" placeholder="Do‚Äòkon qidirish..." />
    </div>
    <button id="shopsFilterBtn" class="shops-filter-btn" type="button">‚öôÔ∏è</button>
  </div>

  <!-- Category chips -->
  <div id="shopsCategoryRow" class="chip-row" style="margin-top:6px;">
    <div class="chip chip-filled" data-shopcat="all">Hammasi</div>
    <div class="chip" data-shopcat="Elektronika">Elektronika</div>
    <div class="chip" data-shopcat="Avto">Avto</div>
    <div class="chip" data-shopcat="Uy-rozg‚Äòor">Uy-rozg‚Äòor</div>
    <div class="chip" data-shopcat="Xizmatlar">Xizmatlar</div>
    <div class="chip" data-shopcat="Kiyim">Kiyim</div>
  </div>

  <!-- Top shops -->
  <div class="section-title" style="margin-top:10px;">Top do‚Äòkonlar</div>
  <div id="topShopsRow" class="top-shops-row"></div>

  <!-- All shops list -->
  <div class="section-title" style="margin-top:12px;">Barcha do‚Äòkonlar</div>
  <div id="shopsList" class="shops-list"></div>

  <div id="shopsEmpty" class="ad-meta" style="display:none; margin-top:10px;">
    Do‚Äòkonlar topilmadi
  </div>
</section>

<!-- ===== Shops filter sheet ===== -->
<div class="store-sheet-backdrop" id="shopsFilterSheet">
  <div class="store-sheet">
    <div class="store-sheet-handle"></div>

    <div style="font-weight:700; font-size:16px; margin-bottom:10px;">Do‚Äòkonlar filtri</div>

    <div style="display:flex; flex-direction:column; gap:10px;">
      <div>
        <div style="font-size:13px; color:#6b7280; margin-bottom:6px;">Viloyat</div>
        <select id="shopsFilterCity" class="form-select">
          <option value="all">Hammasi</option>
          <option value="Toshkent shahri">Toshkent shahri</option>
          <option value="Toshkent viloyati">Toshkent viloyati</option>
          <option value="Andijon">Andijon</option>
          <option value="Buxoro">Buxoro</option>
          <option value="Farg‚Äòona">Farg‚Äòona</option>
          <option value="Jizzax">Jizzax</option>
          <option value="Xorazm">Xorazm</option>
          <option value="Namangan">Namangan</option>
          <option value="Navoiy">Navoiy</option>
          <option value="Qashqadaryo">Qashqadaryo</option>
          <option value="Samarqand">Samarqand</option>
          <option value="Sirdaryo">Sirdaryo</option>
          <option value="Surxondaryo">Surxondaryo</option>
          <option value="Qoraqalpog‚Äòiston">Qoraqalpog‚Äòiston</option>
        </select>
      </div>

      <div>
        <div style="font-size:13px; color:#6b7280; margin-bottom:6px;">Saralash</div>
        <select id="shopsSort" class="form-select">
          <option value="popular">Mashhur</option>
          <option value="new">Yangi</option>
          <option value="rating">Reyting</option>
        </select>
      </div>

      <button id="shopsOnlyVerified" class="chip" type="button">Faqat tasdiqlangan</button>

      <div style="display:flex; gap:10px; margin-top:6px;">
        <button id="shopsApply" class="primary-btn" type="button" style="margin:0;">Qo‚Äòllash</button>
        <button id="shopsReset" class="outline-btn" type="button" style="margin:0;">Tozalash</button>
      </div>
    </div>
  </div>
</div>

      <!-- ================= SHOP VIEW (ANY SHOP) ================= -->
<section id="screen-shop-view" class="screen">
  <div class="store-page">

    <div class="store-cover">
      <img id="shopViewCover" src="iphone14-pro.jpg" alt="Cover">
      <div class="store-avatar">
        <div id="shopViewAvatar" class="shop-view-avatar">Z</div>
      </div>
    </div>

    <div class="store-card store-profile">
      <div id="shopViewName" class="store-name">Do‚Äòkon</div>
      <div id="shopViewSubs" class="store-subs">0 obunachi</div>

      <div class="store-rating">
        <span id="shopViewStars" class="store-rating-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
        <span id="shopViewRating" class="store-rating-count">0.0 (0 baho)</span>
      </div>

      <div class="store-actions">
        <button class="store-btn store-btn-primary" id="shopViewSubscribeBtn" type="button">
          <span class="icon-pill icon-pill-bell">üîî</span>
          <span>Obuna bo‚Äòlish</span>
        </button>

        <button class="store-btn store-btn-icon" id="shopViewMsgBtn" type="button" aria-label="Yozish">‚úâÔ∏è</button>
        <button class="store-btn store-btn-icon" id="shopViewMoreBtn" type="button" aria-label="Ko‚Äòproq">‚Ä¶</button>
      </div>
    </div>

    <div class="store-card">
      <div class="store-section-title">Kontaktlar</div>
      <div class="store-contacts-list">
        <div class="store-contact-row">
          <span class="store-contact-icon phone">üìû</span>
          <a id="shopViewPhone" href="#" style="display:none;">Telefon</a>
          <span id="shopViewPhoneText" style="display:none;">Telefon yo‚Äòq</span>
        </div>

        <div class="store-contact-row">
          <span class="store-contact-icon tg">‚úàÔ∏è</span>
          <a id="shopViewTg" href="#" target="_blank">@shop</a>
        </div>

        <div class="store-contact-row">
          <span class="store-contact-icon loc">üìç</span>
          <span id="shopViewCity">Shahar</span>
        </div>
      </div>
    </div>

    <div class="store-card">
      <div class="store-ads-header">
        <div class="store-ads-title">E‚Äòlonlar</div>
      </div>

      <div class="store-search-row">
        <div class="store-search-input">
          <span>üîç</span>
          <input id="shopViewAdsSearchInput" type="text" placeholder="E‚Äòlonlar ichidan qidirish">
        </div>
        <button class="store-filter-btn" id="shopViewAdsFilterBtn">‚â°</button>
      </div>

      <div id="shopViewAdsList" class="ad-list"></div>
    </div>

  </div>
</section>
      
      <!-- ================= ZALVO BIZNES UCHUN ================= -->
<section id="screen-business" class="screen">
  <div class="business-header">
    <div class="back-link" id="businessBack">‚Üê Orqaga</div>

    <div class="business-icon-wrap">
      <div class="business-icon-inner">
        üîí
      </div>
    </div>

    <h1 class="business-title">Zalvo biznes uchun</h1>
    <p class="business-subtitle">
      Oddiy ZALVO akkauntingizni to‚Äòliq biznes-profilga aylantiring.
      Do‚Äòkoningiz, manzilingiz, ish vaqtingiz va mahsulotlaringiz bir joyda.
    </p>
  </div>

  <div class="business-card">
    <div class="business-feature-row">
      <div class="business-feature-icon business-feature-icon-orange">üìç</div>
      <div class="business-feature-main">
        <div class="business-feature-title">Manzil</div>
        <div class="business-feature-sub">
          xaridorlar sizni xaritada ko‚Äòra oladi
        </div>
      </div>
    </div>

    <div class="business-divider"></div>

    <div class="business-feature-row">
      <div class="business-feature-icon business-feature-icon-blue">üïí</div>
      <div class="business-feature-main">
        <div class="business-feature-title">Ish vaqti</div>
        <div class="business-feature-sub">
          qaysi kuni nechagacha ishlashingiz ko‚Äòrinadi
        </div>
      </div>
    </div>

    <div class="business-divider"></div>

    <div class="business-feature-row">
      <div class="business-feature-icon business-feature-icon-pink">üè¨</div>
      <div class="business-feature-main">
        <div class="business-feature-title">Do‚Äòkon sahifasi</div>
        <div class="business-feature-sub">
          barcha mahsulotlaringiz bitta sahifada
        </div>
      </div>
    </div>

    <div class="business-divider"></div>

    <div class="business-feature-row">
      <div class="business-feature-icon business-feature-icon-gold">‚≠ê</div>
      <div class="business-feature-main">
        <div class="business-feature-title">Reyting</div>
        <div class="business-feature-sub">
          mijozlar fikri ishonchni oshiradi
        </div>
      </div>
    </div>

    <div class="business-beta">
      <strong>Beta davri</strong> ‚Äî hozircha do‚Äòkon ochish mutlaqo bepul.
      Keyinchalik oylik obuna narxi qo‚Äòshiladi.
    </div>
  </div>

  <div class="business-cta">
    <button id="businessOpenShopBtn" class="business-cta-btn">
  Do‚Äòkonni bepul ochish
</button>
    <div class="business-cta-hint">
      Hoziroq bepul ulaning ‚Äî keyin pullik obunaga o‚Äòtish ixtiyoriy bo‚Äòladi.
    </div>
  </div>
</section>
      
      <!-- ================= ADMIN PANEL ================= -->
      <section id="screen-admin" class="screen">
        <div class="screen-title">Admin Panel</div>

        <div class="admin-card">
          <div class="admin-section-title">Statistika</div>

          <div class="admin-stat-row">
            <div class="admin-stat">
              <div class="admin-stat-number" id="adminTotalAds">0</div>
              <div class="admin-stat-label">E‚Äôlonlar</div>
            </div>

            <div class="admin-stat">
              <div class="admin-stat-number" id="adminNewToday">0</div>
              <div class="admin-stat-label">Bugun yangi</div>
            </div>
          </div>

          <div class="admin-section-title">So‚Äònggi 10 ta e‚Äôlon</div>
          <div class="admin-list" id="adminLastAds"></div>
        </div>
      </section>

      <!-- ================= NEW AD: STEP 1 ================= -->
      <section id="screen-new-ad-step1" class="screen">
        <div class="back-link" id="backFromNewAd1">‚Üê Orqaga</div>
        <div class="screen-title">Yangi e‚Äôlon</div>

        <div class="form-group">
          <label class="form-label">Shahar</label>
          <select id="inputCity" class="form-select">
            <option value="Toshkent shahri">Toshkent shahri</option>
<option value="Toshkent viloyati">Toshkent viloyati</option>
<option value="Andijon">Andijon</option>
<option value="Buxoro">Buxoro</option>
<option value="Farg‚Äòona">Farg‚Äòona</option>
<option value="Jizzax">Jizzax</option>
<option value="Xorazm">Xorazm</option>
<option value="Namangan">Namangan</option>
<option value="Navoiy">Navoiy</option>
<option value="Qashqadaryo">Qashqadaryo</option>
<option value="Samarqand">Samarqand</option>
<option value="Sirdaryo">Sirdaryo</option>
<option value="Surxondaryo">Surxondaryo</option>
<option value="Qoraqalpog‚Äòiston">Qoraqalpog‚Äòiston</option>
          </select>
        </div>

        <div class="form-group">
  <label class="form-label">Kategoriya</label>
  <select id="inputCategory" class="form-select">
    <option value="Transport">Transport</option>
    <option value="Ko‚Äòchmas mulk">Ko‚Äòchmas mulk</option>
    <option value="Elektronika">Elektronika</option>
    <option value="Xizmatlar">Xizmatlar</option>
    <option value="Uy va bog‚Äò">Uy va bog‚Äò</option>
    <option value="Kiyim-kechak">Kiyim-kechak</option>
    <option value="Bolalar">Bolalar</option>
    <option value="Hayvonlar">Hayvonlar</option>
    <option value="Ish">Ish</option>
    <option value="Boshqa">Boshqa</option>
  </select>
</div>
        
        <div class="form-group">
          <label class="form-label">Sarlavha</label>
          <input id="inputTitle" type="text" class="form-input" />
        </div>

        <div class="form-group">
          <label class="form-label">Narx (so‚Äòm)</label>
          <input id="inputPrice" type="text" inputmode="numeric" class="form-input" placeholder="Masalan: 123 456 789" />
        </div>

        <div class="form-group">
          <label class="form-label">Tavsif</label>
          <textarea id="inputDescription" class="form-textarea"></textarea>
        </div>

        <button id="btnNewAdStep1Next" class="primary-btn">Davom etish</button>
      </section>

      <!-- ================= NEW AD: STEP 2 ================= -->
      <section id="screen-new-ad-step2" class="screen">
        <div class="back-link" id="backFromNewAd2">‚Üê Orqaga</div>
        <div class="screen-title">Rasmlar</div>

        <button id="btnUploadPhotos" class="primary-btn">Rasmlar yuklash</button>
        <input id="inputPhotos" type="file" multiple class="hidden-input" />

        <div id="photosPreview" class="photos-preview-row"></div>

        <button id="btnNewAdStep2Next" class="primary-btn">Davom etish</button>
      </section>

      <!-- ================= NEW AD: STEP 3 ================= -->
      <section id="screen-new-ad-step3" class="screen">
        <div class="back-link" id="backFromNewAd3">‚Üê Orqaga</div>
        <div class="screen-title">Tasdiqlash</div>

        <div id="summaryTitle" class="screen-title"></div>
        <div id="summaryCityType"></div>
        <div id="summaryPrice"></div>
        <div id="summaryDescription" class="ad-view-description"></div>
        <div id="summaryPhotosInfo" class="ad-view-meta"></div>

        <button id="btnPublishAd" class="primary-btn">E‚Äôlonni joylash</button>
      </section>

      <!-- ================= SUCCESS ================= -->
      <section id="screen-new-ad-success" class="screen">
        <div class="success-icon">‚úî</div>
        <div class="success-text-main">E‚Äôlon joylandi!</div>
        <div class="success-text-sub">Moderatsiyadan o‚Äòtishi kutilmoqda.</div>

        <button id="btnGoHome" class="primary-btn">Bosh sahifa</button>
      </section>

      <!-- ================= TILNI TANLASH (UZ/RU) ================= -->
<section id="screen-language" class="screen">
  <div class="screen-title">Tilni tanlash</div>

  <div class="settings-card">
    <button class="settings-row" id="languageUz">
      <div class="settings-icon">üá∫üáø</div>
      <div class="settings-title">O‚Äòzbek tili</div>
      <div class="settings-arrow">‚Ä∫</div>
    </button>

    <button class="settings-row" id="languageRu">
      <div class="settings-icon">üá∑üá∫</div>
      <div class="settings-title">–†—É—Å—Å–∫–∏–π —è–∑—ã–∫</div>
      <div class="settings-arrow">‚Ä∫</div>
    </button>
  </div>
</section>
    </main>

<!-- BOTTOM SHEET: FILTER (Do‚Äòkon e‚Äòlonlari uchun) -->
<div class="store-sheet-backdrop" id="shopAdsFilterSheet">
  <div class="store-sheet">
    <div class="store-sheet-handle"></div>

    <div style="font-weight:700; font-size:16px; margin-bottom:10px;">Filtr</div>

    <div style="display:flex; flex-direction:column; gap:10px;">

      <div>
        <div style="font-size:13px; color:#6b7280; margin-bottom:6px;">Saralash</div>
        <select id="shopAdsSort" class="form-select">
          <option value="new">Yangi e‚Äôlonlar</option>
          <option value="cheap">Arzon</option>
          <option value="expensive">Qimmat</option>
        </select>
      </div>

      <div>
        <div style="font-size:13px; color:#6b7280; margin-bottom:6px;">Narx (so‚Äòm)</div>
        <div style="display:flex; gap:8px;">
          <input id="shopAdsMinPrice" class="form-input" type="number" placeholder="Min" />
          <input id="shopAdsMaxPrice" class="form-input" type="number" placeholder="Max" />
        </div>
        <div class="hint">Bo‚Äòsh qoldirsangiz ‚Äî cheklanmaydi</div>
      </div>

      <button id="shopAdsOnlyPhoto" class="chip" type="button">Faqat rasmlar bilan</button>

      <div style="display:flex; gap:10px; margin-top:6px;">
        <button id="shopAdsApply" class="primary-btn" type="button" style="margin:0;">Qo‚Äòllash</button>
        <button id="shopAdsReset" class="outline-btn" type="button" style="margin:0;">Tozalash</button>
      </div>

    </div>
  </div>
</div>

    <!-- Shops Action Sheet (iOS style) -->
<div class="store-sheet-backdrop" id="shopSheetBackdrop">
  <div class="store-sheet" role="dialog" aria-modal="true">
    <div class="store-sheet-handle"></div>

    <div class="shop-sheet-title" id="shopSheetTitle">Shop</div>

    <div class="store-sheet-list">
      <button class="store-sheet-item" id="shopSheetFav" type="button">
        <span class="store-sheet-icon share">‚≠ê</span>
        Izbranlarga qo‚Äòshish
      </button>

      <button class="store-sheet-item" id="shopSheetShare" type="button">
        <span class="store-sheet-icon share">üîó</span>
        Ulashish
      </button>

      <button class="store-sheet-item danger" id="shopSheetBlock" type="button">
        <span class="store-sheet-icon report">‚õî</span>
        Bloklash
      </button>

      <!-- ‚úÖ FIX: —Ç–µ–ø–µ—Ä—å –∂–∞–ª–æ–±–∞ ‚Äî —Ç–∞–∫–∞—è –∂–µ –∫–Ω–æ–ø–∫–∞, –∫–∞–∫ –æ—Å—Ç–∞–ª—å–Ω—ã–µ -->
      <button class="store-sheet-item" id="shopSheetReport" type="button">
        <span class="store-sheet-icon report">‚ö†Ô∏è</span>
        Shikoyat qilish
      </button>
    </div>

    <button id="shopSheetCancelBtn" type="button" class="store-sheet-cancel">
  Bekor qilish
</button>
  </div>
</div>

<!-- Report Sheet -->
<div id="reportSheetBackdrop" class="store-sheet-backdrop">
  <div class="store-sheet" role="dialog" aria-modal="true">
    <div class="store-sheet-handle"></div>

    <div class="store-sheet-title">Shikoyat qilish</div>

    <button class="store-sheet-item report-option" data-reason="fake" type="button">Soxta do‚Äòkon</button>
    <button class="store-sheet-item report-option" data-reason="rules" type="button">Qoidabuzarlik</button>
    <button class="store-sheet-item report-option" data-reason="scam" type="button">Firibgarlik</button>
    <button class="store-sheet-item report-option" data-reason="wrong" type="button">Noto‚Äòg‚Äòri ma‚Äôlumot</button>
    <button class="store-sheet-item report-option" data-reason="other" type="button">Boshqa</button>

    <button id="reportCancelBtn" class="store-sheet-cancel" type="button">
  Bekor qilish
</button>
  </div>
</div>
    
    <!-- BOTTOM NAV -->
    <nav class="bottom-nav">
  <div class="bottom-nav-inner">
    <button type="button" class="nav-btn active" data-screen="home">
      <span class="icon">üîç</span>
      <span>Qidirish</span>
    </button>
    <button type="button" class="nav-btn" data-screen="shops">
      <span class="icon">üè™</span>
      <span>Do‚Äòkonlar</span>
    </button>
    <button type="button" class="nav-btn" data-screen="chat">
      <span class="icon">üí¨</span>
      <span>Chat</span>
    </button>
    <button type="button" class="nav-btn" data-screen="profile">
  <span class="icon">‚öôÔ∏è</span>
  <span>Sozlamalar</span>
</button>
  </div>
</nav>
  </div>

  <!-- LIGHTBOX -->
  <div id="imageLightbox" class="lightbox">
    <button id="lightboxPrev" class="lightbox-arrow lightbox-prev">‚Üê</button>
    <img id="lightboxImg" src="" alt="Preview" />
    <button id="lightboxNext" class="lightbox-arrow lightbox-next">‚Üí</button>
    <div class="lightbox-close-hint">Yopish uchun ekranga bosing</div>
  </div>

  <!-- TOAST -->
  <div id="toast" class="toast">
    <div class="toast-inner">
      <div class="toast-icon">üöÄ</div>
      <div>
        <div class="toast-text-main">E‚Äôlon yuqoriga ko‚Äòtarildi!</div>
        <div class="toast-text-sub">Odamlarga ko‚Äòproq ko‚Äòrinadi</div>
      </div>
    </div>
  </div>

  <script>
document.addEventListener("DOMContentLoaded", () => {
  try {
    // ================== –ù–ê–°–¢–†–û–ô–ö–ò / –ö–û–ù–°–¢–ê–ù–¢–´ ==================
    const ADS_API_URL    = "https://baxir.pythonanywhere.com/ads";
    const ADD_AD_API_URL = "https://baxir.pythonanywhere.com/api/add_ad";

    const DEFAULT_PHONE    = "+998901234567";
    const DEFAULT_TELEGRAM = "Baxir1987";

    const EXCHANGE_RATE = 12500; // 1 USD = X so'm

    // ImgBB
    const IMGBB_API_KEY     = "d6a3eac7b36101df3effee3f7d0c7493";
    const IMGBB_UPLOAD_URL  = "https://api.imgbb.com/1/upload";

    // Infinite scroll
    const FEED_CHUNK_SIZE = 10;

    // localStorage keys
    const FAVORITES_KEY = "mh_favorites";
    const HISTORY_KEY   = "mh_history";
    const PROFILE_PHOTO_KEY = "zalvo_profile_photo";

    // ================== DOM-–≠–õ–ï–ú–ï–ù–¢–´ ==================
    const screensContainer = document.querySelector(".screens");

    // Screens
    const screenHome        = document.getElementById("screen-home");
    const screenFavorites   = document.getElementById("screen-favorites");
    const screenFilters     = document.getElementById("screen-filters");
    const screenAdDetails   = document.getElementById("screen-ad-details");
    const screenProfile     = document.getElementById("screen-profile");
    const screenPromo       = document.getElementById("screen-promo");
    const screenChat        = document.getElementById("screen-chat");
    const screenHistory     = document.getElementById("screen-history");
    const screenAdmin       = document.getElementById("screen-admin");
    const screenNewAd1      = document.getElementById("screen-new-ad-step1");
    const screenNewAd2      = document.getElementById("screen-new-ad-step2");
    const screenNewAd3      = document.getElementById("screen-new-ad-step3");
    const screenNewAdSuccess= document.getElementById("screen-new-ad-success");
    const screenShops       = document.getElementById("screen-shops");
    const screenSettings    = document.getElementById("screen-settings");

    const settingsLangRow   = document.getElementById("settingsLangRow");
    const screenLanguage    = document.getElementById("screen-language");
    const languageUz        = document.getElementById("languageUz");
    const languageRu        = document.getElementById("languageRu");

    const screenMyAds       = document.getElementById("screen-my-ads");
    const myAdsList         = document.getElementById("myAdsList");
    const settingsMyAdsRow  = document.getElementById("settingsMyAdsRow");

    const profileAvatar       = document.getElementById("profileAvatar");
    const profilePhotoInput   = document.getElementById("profilePhotoInput");
    const settingsChangePhoto = document.getElementById("settingsChangePhoto");

    const screenMyShop      = document.getElementById("screen-my-shop");
    const myShopAdsList     = document.getElementById("myShopAdsList");
    const settingsMyShopRow = document.getElementById("settingsMyShopRow");

    const screenBusiness    = document.getElementById("screen-business");
    const businessBackBtn   = document.getElementById("businessBack");
    const businessOpenShopBtn  = document.getElementById("businessOpenShopBtn");

    // ‚úÖ –í–ê–ñ–ù–û: storeMoreBtn –æ–±—ä—è–≤–ª—è–µ–º –¢–û–õ–¨–ö–û –û–î–ò–ù –†–ê–ó
    const storeMoreBtn      = document.getElementById("storeMoreBtn");
    const storeSheet        = document.getElementById("storeSheet"); // –æ—Å—Ç–∞–≤–∏–ª, –µ—Å–ª–∏ –≥–¥–µ-—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å
    const storeMsgBtn       = document.getElementById("storeMsgBtn");

    const filterCategoryRow = document.getElementById("filterCategoryRow");

    if (storeMsgBtn) {
      storeMsgBtn.addEventListener("click", () => {
        showScreen("chat");
      });
    }

    // ===== Shop View screen elements =====
    const screenShopView = document.getElementById("screen-shop-view");

    const shopViewName   = document.getElementById("shopViewName");
    const shopViewSubs   = document.getElementById("shopViewSubs");
    const shopViewRating = document.getElementById("shopViewRating");
    const shopViewStars  = document.getElementById("shopViewStars");
    const shopViewCity   = document.getElementById("shopViewCity");
    const shopViewTg     = document.getElementById("shopViewTg");
    const shopViewPhone  = document.getElementById("shopViewPhone");
    const shopViewPhoneText = document.getElementById("shopViewPhoneText");
    const shopViewAvatar = document.getElementById("shopViewAvatar");

    const shopViewMsgBtn = document.getElementById("shopViewMsgBtn");
    const shopViewMoreBtn = document.getElementById("shopViewMoreBtn");

    const shopViewAdsList = document.getElementById("shopViewAdsList");
    const shopViewAdsSearchInput = document.getElementById("shopViewAdsSearchInput");
    const shopViewAdsFilterBtn = document.getElementById("shopViewAdsFilterBtn");

    // ===== Shop Ads Filter DOM (shared sheet) =====
    const shopAdsFilterBtn   = document.getElementById("shopAdsFilterBtn");
    const shopAdsFilterSheet = document.getElementById("shopAdsFilterSheet");

    const shopAdsSearchInput = document.getElementById("shopAdsSearchInput");
    const shopAdsSort        = document.getElementById("shopAdsSort");
    const shopAdsMinPrice    = document.getElementById("shopAdsMinPrice");
    const shopAdsMaxPrice    = document.getElementById("shopAdsMaxPrice");
    const shopAdsOnlyPhotoBtn= document.getElementById("shopAdsOnlyPhoto");
    const shopAdsApplyBtn    = document.getElementById("shopAdsApply");
    const shopAdsResetBtn    = document.getElementById("shopAdsReset");

    const shopAdsFilterState = {
      sort: "new",
      minPrice: "",
      maxPrice: "",
      onlyWithPhoto: false,
    };

    // Settings rows
    const settingsFavoritesRow = document.getElementById("settingsFavoritesRow");
    const settingsHistoryRow   = document.getElementById("settingsHistoryRow");
    const settingsPaidRow      = document.getElementById("settingsPaidRow");
    const settingsBusinessRow  = document.getElementById("settingsBusinessRow");
    const settingsShopRow      = document.getElementById("settingsMyShopRow");

    // Lists
    const feedList          = document.getElementById("feedList");
    const favoritesList     = document.getElementById("favoritesList");
    const historyListEl     = document.getElementById("historyList");
    const adminLastAdsEl    = document.getElementById("adminLastAds");

    // Admin stats
    const adminTotalAdsEl   = document.getElementById("adminTotalAds");
    const adminNewTodayEl   = document.getElementById("adminNewToday");

    // Search / filters
    const searchInput       = document.querySelector(".search-input");
    const openFiltersBtn    = document.getElementById("openFiltersBtn");
    const homeCategoryGrid  = document.getElementById("homeCategoryGrid");

    const filterTypeRow     = document.getElementById("filterTypeRow");
    const filterCitySelect  = document.getElementById("filterCity");
    const filterCurrencyRow = document.getElementById("filterCurrencyRow");
    const filterPhotoChip   = document.getElementById("filterPhotoChip");
    const filterSortSelect  = document.getElementById("filterSort");
    const filtersApplyBtn   = document.getElementById("filtersApplyBtn");
    const filtersResetBtn   = document.getElementById("filtersResetBtn");
    const filtersBackBtn    = document.getElementById("filtersBack");

    // New ad
    const btnOpenNewAd      = document.getElementById("btnOpenNewAd");
    const backFromNewAd1    = document.getElementById("backFromNewAd1");
    const backFromNewAd2    = document.getElementById("backFromNewAd2");
    const backFromNewAd3    = document.getElementById("backFromNewAd3");
    const btnNewAdStep1Next = document.getElementById("btnNewAdStep1Next");
    const btnNewAdStep2Next = document.getElementById("btnNewAdStep2Next");
    const btnPublishAd      = document.getElementById("btnPublishAd");
    const btnGoHome         = document.getElementById("btnGoHome");

    const inputCity         = document.getElementById("inputCity");
    const inputTitle        = document.getElementById("inputTitle");
    const inputPrice        = document.getElementById("inputPrice");
    const inputDescription  = document.getElementById("inputDescription");
    const btnUploadPhotos   = document.getElementById("btnUploadPhotos");
    const inputPhotos       = document.getElementById("inputPhotos");
    const photosPreview     = document.getElementById("photosPreview");
    const summaryTitle      = document.getElementById("summaryTitle");
    const summaryCityType   = document.getElementById("summaryCityType");
    const summaryPrice      = document.getElementById("summaryPrice");
    const summaryDescription= document.getElementById("summaryDescription");
    const summaryPhotosInfo = document.getElementById("summaryPhotosInfo");
    const inputCategory     = document.getElementById("inputCategory");

    // Ad details
    const detailMainImage   = document.getElementById("detailMainImage");
    const detailThumbs      = document.getElementById("detailThumbs");
    const detailTitle       = document.getElementById("detailTitle");
    const detailPrice       = document.getElementById("detailPrice");
    const detailMeta        = document.getElementById("detailMeta");
    const detailDescription = document.getElementById("detailDescription");
    const detailBackBtn     = document.getElementById("detailBackBtn");
    const similarList       = document.getElementById("similarList");
    const favoriteBtn       = document.getElementById("favoriteBtn");
    const shareBtn          = document.getElementById("shareBtn");
    const callSellerBtn     = document.getElementById("callSellerBtn");
    const msgSellerBtn      = document.getElementById("msgSellerBtn");

    // Lightbox
    const imageLightbox     = document.getElementById("imageLightbox");
    const lightboxImg       = document.getElementById("lightboxImg");
    const lightboxPrev      = document.getElementById("lightboxPrev");
    const lightboxNext      = document.getElementById("lightboxNext");

    // Toast
    const toastEl           = document.getElementById("toast");

    // Promo
    const promoBanner       = document.getElementById("promoBanner");

    // Chat
    const chatMessagesEl    = document.getElementById("chatMessages");
    const chatInput         = document.getElementById("chatInput");
    const chatSendBtn       = document.getElementById("chatSendBtn");

    // Bottom nav
    const navButtons        = document.querySelectorAll(".nav-btn");

    // ================== –ì–õ–û–ë–ê–õ–¨–ù–û–ï –°–û–°–¢–û–Ø–ù–ò–ï ==================
    let allAds        = [];
    let filteredAds   = [];
    let favoritesSet  = loadFavoritesFromStorage();
    let historyArray  = loadHistoryFromStorage();
    let currentAd     = null;
    let currentScreen = "home";

    // ===== GLOBAL BACK NAV =====
    const navStack = [];
    let backBtnEl = null;

    function ensureGlobalBackButton() {
      const headerLeft = document.querySelector(".app-header-left");
      if (!headerLeft) return;
      if (backBtnEl) return;

      backBtnEl = document.createElement("button");
      backBtnEl.className = "ios-back-btn";
      backBtnEl.type = "button";
      backBtnEl.innerHTML = `
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M15.5 5.5a1 1 0 0 1 0 1.4L10.4 12l5.1 5.1a1 1 0 1 1-1.4 1.4l-5.8-5.8a1 1 0 0 1 0-1.4l5.8-5.8a1 1 0 0 1 1.4 0z"/>
        </svg>
      `;
      headerLeft.prepend(backBtnEl);

      backBtnEl.addEventListener("click", () => {
        if (!navStack.length) return;

        if (screensContainer) {
          screensContainer.classList.add("ios-back-anim");
          setTimeout(() => screensContainer.classList.remove("ios-back-anim"), 230);
        }
        const prev = navStack.pop();
        showScreen(prev, { push: false });
      });
    }

    function updateBackButtonVisibility() {
      if (!backBtnEl) return;
      backBtnEl.style.display = navStack.length ? "inline-flex" : "none";
    }

    // Hide header
    const appHeader = document.querySelector(".app-header");
    let lastScrollTop = 0;

    function setHeaderHidden(hidden){
      if (!appHeader) return;
      appHeader.classList.toggle("header-hidden", !!hidden);
    }

    if (screensContainer) {
      screensContainer.addEventListener("scroll", () => {
        if (!appHeader) return;
        const st = screensContainer.scrollTop;

        if (st <= 5) {
          setHeaderHidden(false);
          lastScrollTop = st;
          return;
        }

        const delta = st - lastScrollTop;
        if (Math.abs(delta) < 6) return;

        setHeaderHidden(delta > 0);
        lastScrollTop = st;
      }, { passive: true });
    }

    // lightbox
    let lightboxImages = [];
    let lightboxIndex  = 0;

    // infinite scroll
    let feedRenderedCount = 0;

    // new ad draft
    let newAdDraft = {
      city: "Toshkent",
      category: "Transport",
      title: "",
      price: "",
      description: "",
      photos: []
    };

    // chat
    let chatHistory = [];

    // filters
    const filterState = {
      type: "all",
      city: "all",
      currency: "sum",
      onlyWithPhoto: false,
      sort: "default",
      category: "all"
    };

    // ====== SHOP ADS FILTER SHEET ======
    function openShopAdsFilterSheet() {
      if (!shopAdsFilterSheet) return;
      shopAdsFilterSheet.classList.add("active");
      document.body.classList.add("sheet-open");
    }
    function closeShopAdsFilterSheet() {
      if (!shopAdsFilterSheet) return;
      shopAdsFilterSheet.classList.remove("active");
      document.body.classList.remove("sheet-open");
    }
    function syncShopAdsFilterUI() {
      if (shopAdsSort) shopAdsSort.value = shopAdsFilterState.sort;
      if (shopAdsMinPrice) shopAdsMinPrice.value = shopAdsFilterState.minPrice;
      if (shopAdsMaxPrice) shopAdsMaxPrice.value = shopAdsFilterState.maxPrice;
      if (shopAdsOnlyPhotoBtn) {
        shopAdsOnlyPhotoBtn.classList.toggle("chip-filled", shopAdsFilterState.onlyWithPhoto);
      }
    }

    if (shopAdsFilterBtn) {
      shopAdsFilterBtn.addEventListener("click", () => {
        syncShopAdsFilterUI();
        openShopAdsFilterSheet();
      });
    }
    if (shopViewAdsFilterBtn) {
      shopViewAdsFilterBtn.addEventListener("click", () => {
        syncShopAdsFilterUI();
        openShopAdsFilterSheet();
      });
    }

    if (shopAdsFilterSheet) {
      shopAdsFilterSheet.addEventListener("click", (e) => {
        if (e.target === shopAdsFilterSheet) closeShopAdsFilterSheet();
      });
      const inner = shopAdsFilterSheet.querySelector(".store-sheet");
      if (inner) inner.addEventListener("click", (e) => e.stopPropagation());
    }

    if (shopAdsOnlyPhotoBtn) {
      shopAdsOnlyPhotoBtn.addEventListener("click", () => {
        shopAdsFilterState.onlyWithPhoto = !shopAdsFilterState.onlyWithPhoto;
        syncShopAdsFilterUI();
      });
    }

    function rerenderShopAdsForCurrentScreen(){
      if (currentScreen === "myShop") renderMyShopAds();
      if (currentScreen === "shopView") renderShopViewAds();
    }

    if (shopAdsApplyBtn) {
      shopAdsApplyBtn.addEventListener("click", () => {
        shopAdsFilterState.sort = (shopAdsSort?.value || "new");
        shopAdsFilterState.minPrice = (shopAdsMinPrice?.value || "").trim();
        shopAdsFilterState.maxPrice = (shopAdsMaxPrice?.value || "").trim();
        closeShopAdsFilterSheet();
        rerenderShopAdsForCurrentScreen();
      });
    }

    if (shopAdsResetBtn) {
      shopAdsResetBtn.addEventListener("click", () => {
        shopAdsFilterState.sort = "new";
        shopAdsFilterState.minPrice = "";
        shopAdsFilterState.maxPrice = "";
        shopAdsFilterState.onlyWithPhoto = false;

        if (shopAdsSearchInput) shopAdsSearchInput.value = "";
        syncShopAdsFilterUI();
        rerenderShopAdsForCurrentScreen();
        closeShopAdsFilterSheet();
      });
    }

    if (shopAdsSearchInput) {
      shopAdsSearchInput.addEventListener("input", () => {
        if (currentScreen === "myShop") renderMyShopAds();
      });
    }

    // ================== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï ==================
    function formatNumberWithSpaces(num) {
      const s = String(num);
      return s.replace(/\B(?=(\d{3})+(?!\d))/g, " ");
    }
    function getAdCategory(ad) {
      return String(ad?.category || ad?.type || "Boshqa").trim();
    }
    function formatInputNumberSpaces(value) {
      const digits = String(value || "").replace(/\D/g, "");
      return digits.replace(/\B(?=(\d{3})+(?!\d))/g, " ");
    }
    function setCaretByDigits(el, digitsPos) {
      const str = el.value;
      let digitsSeen = 0;
      for (let i = 0; i <= str.length; i++) {
        if (i === str.length) { el.setSelectionRange(i, i); return; }
        if (/\d/.test(str[i])) digitsSeen++;
        if (digitsSeen >= digitsPos) { el.setSelectionRange(i + 1, i + 1); return; }
      }
    }

    if (inputPrice) {
      inputPrice.addEventListener("input", () => {
        const el = inputPrice;
        const caret = el.selectionStart || 0;
        const leftPart = el.value.slice(0, caret);
        const digitsPos = leftPart.replace(/\D/g, "").length;

        const formatted = formatInputNumberSpaces(el.value);
        el.value = formatted;
        setCaretByDigits(el, digitsPos);
      });
    }

    function formatPrice(price) {
      if (price === null || price === undefined || price === "") return "Narx kelishiladi";
      const p = Number(price || 0);
      if (!isFinite(p) || p <= 0) return "Narx kelishiladi";
      if (filterState.currency === "usd") {
        const usd = p / EXCHANGE_RATE;
        const rounded = Math.round(usd * 100) / 100;
        return formatNumberWithSpaces(rounded) + " USD";
      }
      return formatNumberWithSpaces(p) + " so‚Äòm";
    }

    function formatDateShort(iso) {
      if (!iso) return "";
      try {
        const d = new Date(iso);
        const dd = String(d.getDate()).padStart(2, "0");
        const mm = String(d.getMonth() + 1).padStart(2, "0");
        return `${dd}.${mm}`;
      } catch { return ""; }
    }

    function loadFavoritesFromStorage() {
      try {
        const raw = localStorage.getItem(FAVORITES_KEY);
        if (!raw) return new Set();
        const arr = JSON.parse(raw);
        return Array.isArray(arr) ? new Set(arr) : new Set();
      } catch { return new Set(); }
    }
    function saveFavoritesToStorage() {
      try { localStorage.setItem(FAVORITES_KEY, JSON.stringify(Array.from(favoritesSet))); } catch {}
    }

    function loadHistoryFromStorage() {
      try {
        const raw = localStorage.getItem(HISTORY_KEY);
        if (!raw) return [];
        const arr = JSON.parse(raw);
        return Array.isArray(arr) ? arr : [];
      } catch { return []; }
    }
    function saveHistoryToStorage() {
      try { localStorage.setItem(HISTORY_KEY, JSON.stringify(historyArray)); } catch {}
    }

    let toastTimeout = null;
    function showToast(mainText = "E‚Äôlon yuqoriga ko‚Äòtarildi!", subText = "Endi odamlarga ko‚Äòproq ko‚Äòrinadi") {
      if (!toastEl) return;
      const mainEl = toastEl.querySelector(".toast-text-main");
      const subEl  = toastEl.querySelector(".toast-text-sub");
      if (mainEl) mainEl.textContent = mainText;
      if (subEl)  subEl.textContent  = subText;

      toastEl.classList.add("show");
      if (toastTimeout) clearTimeout(toastTimeout);
      toastTimeout = setTimeout(() => toastEl.classList.remove("show"), 3000);
    }

    function createAdCard(ad) {
      const card = document.createElement("div");
      card.className = "ad-card";

      const title  = ad.title || "E‚Äôlon";
      const city   = ad.city || "Shahar";
      const category = getAdCategory(ad);
      const price  = formatPrice(ad.price);
      const date   = formatDateShort(ad.created_at);
      const image  = ad.images && ad.images.length ? ad.images[0] : null;

      card.innerHTML = `
        <div class="ad-image" style="${image ? `background-image:url('${image}');` : ""}"></div>
        <div class="ad-content">
          <div class="ad-title">${title}</div>
          <div class="ad-meta">üìç ${city} ¬∑ ${category}${date ? " ¬∑ " + date : ""}</div>
          <div class="ad-price">${price}</div>
        </div>
      `;

      card.addEventListener("click", () => openAdDetails(ad));
      return card;
    }

    function createHistoryCard(item) {
      const ad = allAds.find(a => a.id === item.id);
      if (!ad) return null;
      return createAdCard(ad);
    }

    function applyAllFilters() {
      if (!allAds.length) { filteredAds = []; return; }
      const q = (searchInput?.value || "").toLowerCase().trim();

      filteredAds = allAds.filter(ad => {
        if (filterState.category !== "all") {
          if (getAdCategory(ad) !== filterState.category) return false;
        }
        if (filterState.city !== "all") {
          if ((ad.city || "").trim() !== filterState.city) return false;
        }
        if (filterState.onlyWithPhoto) {
          if (!ad.images || !Array.isArray(ad.images) || !ad.images.length) return false;
        }
        if (q) {
          const text = (ad.title || "") + " " + (ad.description || "");
          if (!text.toLowerCase().includes(q)) return false;
        }
        return true;
      });

      filteredAds.sort((a, b) => {
        const pa = Number(a.price || 0);
        const pb = Number(b.price || 0);
        const da = a.created_at ? new Date(a.created_at).getTime() : 0;
        const db = b.created_at ? new Date(b.created_at).getTime() : 0;

        switch (filterState.sort) {
          case "cheap":      return pa - pb;
          case "expensive":  return pb - pa;
          case "date":
          case "default":
          default:           return db - da;
        }
      });
    }

    function resetFeedRender() {
      if (!feedList) return;
      feedList.innerHTML = "";
      feedRenderedCount = 0;
      appendMoreToFeed();
    }

    function appendMoreToFeed() {
      if (!feedList) return;
      const start = feedRenderedCount;
      const end   = Math.min(filteredAds.length, start + FEED_CHUNK_SIZE);

      if (start >= end) {
        if (!filteredAds.length && !feedRenderedCount) {
          feedList.innerHTML = "<div class='ad-meta'>E‚Äôlonlar topilmadi</div>";
        }
        return;
      }

      for (let i = start; i < end; i++) {
        feedList.appendChild(createAdCard(filteredAds[i]));
      }
      feedRenderedCount = end;
    }

    function renderFavorites() {
      if (!favoritesList) return;
      favoritesList.innerHTML = "";
      const ids = Array.from(favoritesSet);
      if (!ids.length) {
        favoritesList.innerHTML = "<div class='ad-meta'>Sevimlilar hozircha bo‚Äòsh</div>";
        return;
      }
      const favAds = allAds.filter(ad => ids.includes(ad.id));
      if (!favAds.length) {
        favoritesList.innerHTML = "<div class='ad-meta'>Sevimlilar hozircha bo‚Äòsh</div>";
        return;
      }
      favAds.forEach(ad => favoritesList.appendChild(createAdCard(ad)));
    }

    function renderHistory() {
      if (!historyListEl) return;
      historyListEl.innerHTML = "";
      if (!historyArray.length) {
        historyListEl.innerHTML = "<div class='ad-meta'>Tarix bo‚Äòsh</div>";
        return;
      }
      const sorted = [...historyArray].sort((a,b)=>b.ts - a.ts);
      sorted.forEach(item => {
        const card = createHistoryCard(item);
        if (card) historyListEl.appendChild(card);
      });
    }

    function renderMyAds() {
      if (!myAdsList) return;
      myAdsList.innerHTML = "";

      const myPhone = DEFAULT_PHONE.replace(/\s+/g, "");
      const myTg    = DEFAULT_TELEGRAM.replace(/^@/, "").toLowerCase();

      const myAds = allAds.filter(ad => {
        const adPhone = (ad.phone || "").replace(/\s+/g, "");
        const adTg    = (ad.telegram || "").replace(/^@/, "").toLowerCase();
        return (adPhone && adPhone === myPhone) || (adTg && adTg === myTg);
      });

      if (!myAds.length) {
        myAdsList.innerHTML = "<div class='ad-meta'>Hozircha sizning e‚Äôlonlaringiz yo‚Äòq</div>";
        return;
      }
      myAds.forEach(ad => myAdsList.appendChild(createAdCard(ad)));
    }

    async function loadAds() {
      try {
        const res = await fetch(ADS_API_URL);
        if (!res.ok) throw new Error("Bad response");
        const data = await res.json();
        if (!Array.isArray(data)) throw new Error("Not array");

        allAds = data;
        applyAllFilters();
        resetFeedRender();
        renderFavorites();
        updateAdminPanel();
      } catch (e) {
        console.error("Error loadAds:", e);
        if (feedList) feedList.innerHTML = "<div class='ad-meta'>E‚Äôlonlarni yuklashda xatolik</div>";
      }
    }

    // ================== –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –≠–ö–†–ê–ù–û–í ==================
    const screens = {
      home: screenHome,
      favorites: screenFavorites,
      filters: screenFilters,
      adDetails: screenAdDetails,
      profile: screenProfile,
      promo: screenPromo,
      chat: screenChat,
      history: screenHistory,
      admin: screenAdmin,
      newAd1: screenNewAd1,
      newAd2: screenNewAd2,
      newAd3: screenNewAd3,
      newAdSuccess: screenNewAdSuccess,
      shops: screenShops,
      language: screenLanguage,
      myAds: screenMyAds,
      business: screenBusiness,
      myShop: screenMyShop,
      shopView: screenShopView,
    };

    function showScreen(name, opts = {}) {
      ensureGlobalBackButton();

      const push = opts.push !== false;
      const resetStack = opts.resetStack === true;

      if (resetStack) navStack.length = 0;

      if (push && currentScreen && currentScreen !== name) {
        navStack.push(currentScreen);
      }

      currentScreen = name;

      Object.values(screens).forEach(el => {
        if (!el) return;
        el.classList.remove("active");
        el.style.display = "none";
      });

      const target = screens[name];
      if (target) {
        target.classList.add("active");
        target.style.display = "block";
      }

      navButtons.forEach(btn => {
        const s = btn.getAttribute("data-screen");
        btn.classList.toggle("active", s === name);
      });

      if (screensContainer) screensContainer.scrollTop = 0;

      if (name === "favorites") renderFavorites();
      if (name === "history")   renderHistory();
      if (name === "filters")   syncFiltersUIFromState();
      if (name === "home")      resetFeedRender();
      if (name === "myAds")     renderMyAds();
      if (name === "myShop")    renderMyShopAds();
      if (name === "shopView")  renderShopView();
      if (name === "shops") {
      ensureShopsLoaded().then(() => {
      renderShopCategoryChips();   // ‚úÖ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
      renderShops();               // ‚úÖ —Ä–∏—Å—É–µ–º –º–∞–≥–∞–∑–∏–Ω—ã
  });
}

      updateBackButtonVisibility();
    }

    // ===== Shop View =====
    let currentShop = null;

    function starsText(rating){
      const r = Math.max(0, Math.min(5, Number(rating||0)));
      const full = Math.round(r);
      return "‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ".slice(0, full) + "‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ".slice(0, 5-full);
    }

    function getShopAds(shop){
      if (!shop) return [];
      const ownerTg = String(shop.ownerTelegram||"").replace(/^@/,"").toLowerCase();
      const ownerPhone = String(shop.ownerPhone||"").replace(/\s+/g,"");

      return allAds.filter(ad => {
        const adTg = String(ad.telegram||"").replace(/^@/,"").toLowerCase();
        const adPhone = String(ad.phone||"").replace(/\s+/g,"");
        if (ownerTg && adTg && adTg === ownerTg) return true;
        if (ownerPhone && adPhone && adPhone === ownerPhone) return true;
        return false;
      });
    }

    function openShop(shop){
      currentShop = shop;
      showScreen("shopView");
    }

    function renderShopView(){
      if (!currentShop) return;

      if (shopViewName) shopViewName.textContent = currentShop.name || "Do‚Äòkon";
      if (shopViewSubs) shopViewSubs.textContent = `${currentShop.subs || 0} obunachi`;

      if (shopViewStars) shopViewStars.textContent = starsText(currentShop.rating);
      if (shopViewRating) shopViewRating.textContent = `${currentShop.rating || 0} (${currentShop.reviews || 0} baho)`;

      if (shopViewCity) shopViewCity.textContent = currentShop.city || "Shahar";

      const tg = String(currentShop.ownerTelegram || "").replace(/^@/,"");
      if (shopViewTg) {
        shopViewTg.textContent = "@" + (tg || "shop");
        shopViewTg.href = tg ? ("https://t.me/" + tg) : "#";
      }

      const phone = String(currentShop.ownerPhone || "").trim();
      if (shopViewPhone && shopViewPhoneText) {
        if (phone) {
          shopViewPhone.style.display = "inline";
          shopViewPhoneText.style.display = "none";
          shopViewPhone.textContent = phone;
          shopViewPhone.href = "tel:" + phone.replace(/\s+/g,"");
        } else {
          shopViewPhone.style.display = "none";
          shopViewPhoneText.style.display = "inline";
          shopViewPhoneText.textContent = "Telefon yo‚Äòq";
        }
      }

      if (shopViewAvatar) shopViewAvatar.textContent = getInitials(currentShop.name);

      renderShopViewAds();
    }

    function renderShopViewAds(){
      if (!shopViewAdsList) return;
      shopViewAdsList.innerHTML = "";

      const q = (shopViewAdsSearchInput?.value || "").toLowerCase().trim();
      const ads = getShopAds(currentShop);

      let result = ads.filter(ad => {
        if (shopAdsFilterState.onlyWithPhoto) {
          if (!ad.images || !Array.isArray(ad.images) || !ad.images.length) return false;
        }

        const p = Number(ad.price || 0);
        const min = Number(shopAdsFilterState.minPrice || 0);
        const max = Number(shopAdsFilterState.maxPrice || 0);

        if (shopAdsFilterState.minPrice && isFinite(min) && p < min) return false;
        if (shopAdsFilterState.maxPrice && isFinite(max) && p > max) return false;

        if (q) {
          const text = ((ad.title || "") + " " + (ad.description || "")).toLowerCase();
          if (!text.includes(q)) return false;
        }
        return true;
      });

      result.sort((a,b) => {
        const pa = Number(a.price || 0);
        const pb = Number(b.price || 0);
        const da = a.created_at ? new Date(a.created_at).getTime() : 0;
        const db = b.created_at ? new Date(b.created_at).getTime() : 0;

        if (shopAdsFilterState.sort === "cheap") return pa - pb;
        if (shopAdsFilterState.sort === "expensive") return pb - pa;
        return db - da;
      });

      if (!result.length) {
        shopViewAdsList.innerHTML = "<div class='ad-meta'>Bu do‚Äòkonda e‚Äôlonlar yo‚Äòq</div>";
        return;
      }
      result.forEach(ad => shopViewAdsList.appendChild(createAdCard(ad)));
    }

    if (shopViewMsgBtn) shopViewMsgBtn.addEventListener("click", () => showScreen("chat"));
    if (shopViewAdsSearchInput) shopViewAdsSearchInput.addEventListener("input", renderShopViewAds);

    // bottom nav
    navButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        const target = btn.getAttribute("data-screen");
        if (!target) return;
        showScreen(target, { push: false, resetStack: true });
      });
    });

    // infinite scroll on home
    if (screensContainer) {
      screensContainer.addEventListener("scroll", () => {
        if (currentScreen !== "home") return;
        const nearBottom =
          screensContainer.scrollTop + screensContainer.clientHeight >=
          screensContainer.scrollHeight - 80;
        if (nearBottom) appendMoreToFeed();
      });
    }

    // search
    if (searchInput) {
      searchInput.addEventListener("input", () => {
        applyAllFilters();
        resetFeedRender();
      });
    }

    // ================== –§–ò–õ–¨–¢–†–´ ==================
    function syncFiltersUIFromState() {
      if (filterTypeRow) {
        filterTypeRow.querySelectorAll(".chip").forEach(ch => {
          const t = ch.getAttribute("data-type") || "all";
          ch.classList.toggle("chip-filled", t === filterState.type);
        });
      }
      if (filterCitySelect) filterCitySelect.value = filterState.city === "all" ? "all" : filterState.city;

      if (filterCurrencyRow) {
        filterCurrencyRow.querySelectorAll(".chip").forEach(ch => {
          const c = ch.getAttribute("data-currency") || "sum";
          ch.classList.toggle("chip-filled", c === filterState.currency);
        });
      }
      if (filterPhotoChip) filterPhotoChip.classList.toggle("chip-filled", filterState.onlyWithPhoto);
      if (filterSortSelect) filterSortSelect.value = filterState.sort;

      if (filterCategoryRow) {
        filterCategoryRow.querySelectorAll(".chip").forEach(ch => {
          const c = ch.getAttribute("data-category") || "all";
          ch.classList.toggle("chip-filled", c === filterState.category);
        });
      }
    }

    function readFiltersFromUI() {
      if (filterTypeRow) {
        const active = filterTypeRow.querySelector(".chip-filled");
        filterState.type = active ? active.getAttribute("data-type") || "all" : "all";
      }
      if (filterCategoryRow) {
        const active = filterCategoryRow.querySelector(".chip-filled");
        filterState.category = active ? active.getAttribute("data-category") || "all" : "all";
      }
      if (filterCitySelect) {
        const v = filterCitySelect.value;
        filterState.city = v === "all" ? "all" : v;
      }
      if (filterCurrencyRow) {
        const active = filterCurrencyRow.querySelector(".chip-filled");
        filterState.currency = active ? active.getAttribute("data-currency") || "sum" : "sum";
      }
      if (filterPhotoChip) filterState.onlyWithPhoto = filterPhotoChip.classList.contains("chip-filled");
      if (filterSortSelect) filterState.sort = filterSortSelect.value || "default";
    }

    if (filterTypeRow) {
      filterTypeRow.addEventListener("click", e => {
        const chip = e.target.closest(".chip");
        if (!chip) return;
        filterTypeRow.querySelectorAll(".chip").forEach(c => c.classList.remove("chip-filled"));
        chip.classList.add("chip-filled");
      });
    }

    if (filterCategoryRow) {
      filterCategoryRow.addEventListener("click", e => {
        const chip = e.target.closest(".chip");
        if (!chip) return;
        filterCategoryRow.querySelectorAll(".chip").forEach(c => c.classList.remove("chip-filled"));
        chip.classList.add("chip-filled");
      });
    }

    if (filterCurrencyRow) {
      filterCurrencyRow.addEventListener("click", e => {
        const chip = e.target.closest(".chip");
        if (!chip) return;
        filterCurrencyRow.querySelectorAll(".chip").forEach(c => c.classList.remove("chip-filled"));
        chip.classList.add("chip-filled");
      });
    }

    if (filterPhotoChip) {
      filterPhotoChip.addEventListener("click", () => filterPhotoChip.classList.toggle("chip-filled"));
    }

    if (openFiltersBtn) openFiltersBtn.addEventListener("click", () => showScreen("filters"));

    if (filtersApplyBtn) {
      filtersApplyBtn.addEventListener("click", () => {
        readFiltersFromUI();
        applyAllFilters();
        resetFeedRender();
        showScreen("home");
      });
    }

    if (filtersResetBtn) {
      filtersResetBtn.addEventListener("click", () => {
        filterState.type         = "all";
        filterState.city         = "all";
        filterState.currency     = "sum";
        filterState.onlyWithPhoto= false;
        filterState.sort         = "default";
        filterState.category     = "all";
        syncFiltersUIFromState();
        applyAllFilters();
        resetFeedRender();
      });
    }

    if (filtersBackBtn) filtersBackBtn.addEventListener("click", () => showScreen("home"));

    // ================== –ù–û–í–û–ï –û–ë–™–Ø–í–õ–ï–ù–ò–ï (–æ—Å—Ç–∞–≤–∏–ª –∫–∞–∫ —É —Ç–µ–±—è) ==================
    if (btnOpenNewAd) btnOpenNewAd.addEventListener("click", () => showScreen("newAd1"));
    if (backFromNewAd1) backFromNewAd1.addEventListener("click", () => showScreen("home"));
    if (backFromNewAd2) backFromNewAd2.addEventListener("click", () => showScreen("newAd1"));
    if (backFromNewAd3) backFromNewAd3.addEventListener("click", () => showScreen("newAd2"));
    if (btnGoHome) btnGoHome.addEventListener("click", () => showScreen("home"));

    if (btnNewAdStep1Next) {
      btnNewAdStep1Next.addEventListener("click", () => {
        const title = (inputTitle?.value || "").trim();
        const price = (inputPrice?.value || "").trim();
        const desc  = (inputDescription?.value || "").trim();

        if (!title) return alert("Sarlavha kiriting");
        if (!price) return alert("Narx kiriting");

        newAdDraft.city        = inputCity?.value || "Toshkent";
        newAdDraft.category    = inputCategory ? inputCategory.value : "Boshqa";
        newAdDraft.title       = title;
        newAdDraft.price       = price.replace(/\s+/g, "");
        newAdDraft.description = desc || "Tavsif berilmagan";

        showScreen("newAd2");
      });
    }

    if (btnUploadPhotos && inputPhotos) {
      btnUploadPhotos.addEventListener("click", () => inputPhotos.click());

      inputPhotos.addEventListener("change", async () => {
        const files = Array.from(inputPhotos.files || []);
        if (photosPreview) photosPreview.innerHTML = "";
        newAdDraft.photos = [];
        if (!files.length) return;

        const max = 8;
        const selected = files.slice(0, max);

        for (const file of selected) {
          const reader = new FileReader();
          reader.onload = e => {
            if (!photosPreview) return;
            const div = document.createElement("div");
            div.className = "photo-thumb";
            const img = document.createElement("img");
            img.src = e.target.result;
            div.appendChild(img);
            photosPreview.appendChild(div);
          };
          reader.readAsDataURL(file);

          try {
            const url = await uploadToImgbb(file);
            newAdDraft.photos.push(url);
          } catch (e) {
            console.error("ImgBB error:", e);
          }
        }
      });
    }

    async function uploadToImgbb(file) {
      const formData = new FormData();
      formData.append("key", IMGBB_API_KEY);
      formData.append("image", file);

      const res = await fetch(IMGBB_UPLOAD_URL, { method: "POST", body: formData });
      if (!res.ok) throw new Error("upload_failed");
      const json = await res.json();
      if (!json.success || !json.data || !json.data.url) throw new Error("bad_response");
      return json.data.url;
    }

    if (btnNewAdStep2Next) btnNewAdStep2Next.addEventListener("click", () => { fillSummary(); showScreen("newAd3"); });

    function fillSummary() {
      if (summaryTitle) summaryTitle.textContent = newAdDraft.title;
      if (summaryCityType) summaryCityType.textContent = `${newAdDraft.city} ¬∑ ${newAdDraft.category}`;
      if (summaryPrice) summaryPrice.textContent = formatPrice(newAdDraft.price);
      if (summaryDescription) summaryDescription.textContent = newAdDraft.description;
      if (summaryPhotosInfo) summaryPhotosInfo.textContent = "Rasmlar: " + (newAdDraft.photos.length || 0) + " ta";
    }

    if (btnPublishAd) {
      btnPublishAd.addEventListener("click", async () => {
        btnPublishAd.disabled = true;
        const oldText = btnPublishAd.textContent;
        btnPublishAd.textContent = "Yuklanmoqda...";

        try {
          const payload = {
            city: newAdDraft.city,
            category: newAdDraft.category,
            type: newAdDraft.category,
            title: newAdDraft.title,
            price: String(newAdDraft.price).replace(/\s+/g, ""),
            description: newAdDraft.description,
            images: newAdDraft.photos,
            phone: DEFAULT_PHONE,
            telegram: DEFAULT_TELEGRAM
          };

          const res = await fetch(ADD_AD_API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
          });
          if (!res.ok) throw new Error("Bad response");

          if (inputTitle) inputTitle.value = "";
          if (inputPrice) inputPrice.value = "";
          if (inputDescription) inputDescription.value = "";
          if (photosPreview) photosPreview.innerHTML = "";
          if (inputPhotos) inputPhotos.value = "";

          newAdDraft = { city:"Toshkent", category:"Transport", title:"", price:"", description:"", photos:[] };

          showScreen("newAdSuccess");
          loadAds();
        } catch (e) {
          console.error("publish error:", e);
          alert("Xatolik, keyinroq urinib ko‚Äòring.");
        } finally {
          btnPublishAd.disabled = false;
          btnPublishAd.textContent = oldText || "E‚Äôlonni joylash";
        }
      });
    }

    // ================== –û–¢–ö–†–´–¢–ò–ï –î–ï–¢–ê–õ–ï–ô (–æ—Å—Ç–∞–≤–∏–ª –∫–∞–∫ —É —Ç–µ–±—è) ==================
    function openAdDetails(ad) {
      currentAd = ad;

      if (ad.id != null) {
        const without = historyArray.filter(x => x.id !== ad.id);
        without.unshift({id: ad.id, ts: Date.now()});
        historyArray = without.slice(0, 50);
        saveHistoryToStorage();
      }

      if (detailTitle) detailTitle.textContent = ad.title || "";
      if (detailPrice) detailPrice.textContent = formatPrice(ad.price);
      if (detailMeta) detailMeta.textContent = `${ad.city || ""} ¬∑ ${getAdCategory(ad)}`;
      if (detailDescription) detailDescription.textContent = ad.description || "";

      const images = Array.isArray(ad.images) ? ad.images : [];

      if (detailMainImage) {
        detailMainImage.innerHTML = "";
        detailMainImage.style.display = "flex";
        detailMainImage.style.overflowX = "auto";
        detailMainImage.style.scrollSnapType = "x mandatory";

        if (images.length) {
          images.forEach((url, idx) => {
            const slide = document.createElement("div");
            slide.className = "detail-main-slide";
            slide.style.backgroundImage = `url('${url}')`;
            slide.addEventListener("click", () => openLightbox(images, idx));
            detailMainImage.appendChild(slide);
          });
        } else {
          const slide = document.createElement("div");
          slide.className = "detail-main-slide";
          slide.style.background = "#e5e7eb";
          detailMainImage.appendChild(slide);
        }
        detailMainImage.scrollLeft = 0;
      }

      if (detailThumbs) {
        detailThumbs.innerHTML = "";
        images.forEach((url, idx) => {
          const div = document.createElement("div");
          div.className = "detail-thumb";
          div.style.backgroundImage = `url('${url}')`;
          div.addEventListener("click", () => {
            if (!detailMainImage) return;
            detailMainImage.scrollTo({ left: idx * detailMainImage.clientWidth, behavior: "smooth" });
          });
          detailThumbs.appendChild(div);
        });
      }

      const phone    = ad.phone    || DEFAULT_PHONE;
      const telegram = ad.telegram || DEFAULT_TELEGRAM;

      if (callSellerBtn) {
        if (phone) {
          const clean = String(phone).replace(/\s+/g, "");
          callSellerBtn.href = "tel:" + clean;
          callSellerBtn.style.display = "flex";
        } else {
          callSellerBtn.style.display = "none";
        }
      }

      if (msgSellerBtn) {
        if (telegram) {
          const uname = String(telegram).replace(/^@/, "");
          msgSellerBtn.href = "https://t.me/" + uname;
          msgSellerBtn.style.display = "flex";
          msgSellerBtn.onclick = e => {
            e.preventDefault();
            openChatForAd(ad);
          };
        } else {
          msgSellerBtn.style.display = "none";
        }
      }

      if (favoriteBtn) {
        const isFav = ad.id != null && favoritesSet.has(ad.id);
        favoriteBtn.textContent = isFav ? "‚ô•" : "‚ô°";
        favoriteBtn.onclick = () => {
          if (ad.id == null) return;
          if (favoritesSet.has(ad.id)) {
            favoritesSet.delete(ad.id);
            favoriteBtn.textContent = "‚ô°";
          } else {
            favoritesSet.add(ad.id);
            favoriteBtn.textContent = "‚ô•";
          }
          saveFavoritesToStorage();
          renderFavorites();
        };
      }

      if (shareBtn) {
        shareBtn.onclick = () => {
          const shareData = { title: ad.title || "E‚Äôlon", text: ad.title || "E‚Äôlon", url: window.location.href };
          if (navigator.share) {
            navigator.share(shareData).catch(()=>{});
          } else if (navigator.clipboard?.writeText) {
            navigator.clipboard.writeText(shareData.url).then(()=>alert("Havola nusxa olindi"));
          } else {
            alert("Linkni manzillar satridan nusxa oling");
          }
        };
      }

      if (similarList) {
        similarList.innerHTML = "";
        const adCat = getAdCategory(ad);
        const sameType = allAds.filter(x => x.id !== ad.id && getAdCategory(x) === adCat);
        const base = sameType.length ? sameType : allAds.filter(x => x.id !== ad.id);
        base.slice(0, 3).forEach(item => {
          const wrap = document.createElement("div");
          wrap.className = "similar-card";
          const img = item.images && item.images[0];
          wrap.innerHTML = `
            <div class="similar-image" style="${img ? `background-image:url('${img}');` : ""}"></div>
            <div>
              <div class="similar-content-title">${item.title || ""}</div>
              <div class="similar-content-meta">${item.city || ""}</div>
              <div class="similar-content-price">${formatPrice(item.price)}</div>
            </div>
          `;
          wrap.addEventListener("click", () => openAdDetails(item));
          similarList.appendChild(wrap);
        });
      }

      showScreen("adDetails");
    }

    if (detailBackBtn) detailBackBtn.addEventListener("click", () => showScreen("home"));

    function openLightbox(images, index) {
      if (!imageLightbox || !lightboxImg) return;
      lightboxImages = images.slice();
      lightboxIndex  = index || 0;
      updateLightboxImage();
      imageLightbox.classList.add("visible");
    }
    function updateLightboxImage() {
      if (!lightboxImg || !lightboxImages.length) return;
      lightboxImg.src = lightboxImages[lightboxIndex];
    }
    if (imageLightbox) imageLightbox.addEventListener("click", () => imageLightbox.classList.remove("visible"));
    if (lightboxPrev) lightboxPrev.addEventListener("click", e => {
      e.stopPropagation();
      if (!lightboxImages.length) return;
      lightboxIndex = (lightboxIndex - 1 + lightboxImages.length) % lightboxImages.length;
      updateLightboxImage();
    });
    if (lightboxNext) lightboxNext.addEventListener("click", e => {
      e.stopPropagation();
      if (!lightboxImages.length) return;
      lightboxIndex = (lightboxIndex + 1) % lightboxImages.length;
      updateLightboxImage();
    });

    // promo
    if (promoBanner) promoBanner.addEventListener("click", () => showScreen("promo"));
    document.addEventListener("click", e => {
      const plan = e.target.closest(".promo-plan");
      if (!plan) return;
      showToast("E‚Äôlon yuqoriga ko‚Äòtarildi!", "TOP bo‚Äòlimida ko‚Äòrinadi");
    });

    // chat
    function renderChat() {
      if (!chatMessagesEl) return;
      chatMessagesEl.innerHTML = "";
      chatHistory.forEach(msg => {
        const div = document.createElement("div");
        div.className = "chat-message " + (msg.from === "me" ? "me" : "other");
        div.textContent = msg.text;
        chatMessagesEl.appendChild(div);
      });
      chatMessagesEl.scrollTop = chatMessagesEl.scrollHeight;
    }
    function addChatMessage(from, text) {
      chatHistory.push({ from, text, ts: Date.now() });
      renderChat();
    }
    function openChatForAd(ad) {
      if (!chatHistory.length) addChatMessage("seller", "Assalomu alaykum! Savollaringiz bo‚Äòlsa, yozing üôÇ");
      showScreen("chat");
    }
    if (chatSendBtn && chatInput) {
      chatSendBtn.addEventListener("click", () => {
        const text = (chatInput.value || "").trim();
        if (!text) return;
        addChatMessage("me", text);
        chatInput.value = "";
        setTimeout(() => addChatMessage("seller", "Xabaringizni oldim, tez orada javob beraman ‚úÖ"), 800);
      });
      chatInput.addEventListener("keydown", e => {
        if (e.key === "Enter") { e.preventDefault(); chatSendBtn.click(); }
      });
    }

    const settingsAdminRow  = document.getElementById("settingsAdminRow");

    function updateAdminPanel() {
      if (!adminTotalAdsEl || !adminNewTodayEl || !adminLastAdsEl) return;
      adminTotalAdsEl.textContent = allAds.length;

      const todayStr = new Date().toISOString().slice(0, 10);
      const newToday = allAds.filter(ad => (ad.created_at || "").startsWith(todayStr)).length;
      adminNewTodayEl.textContent = newToday;

      adminLastAdsEl.innerHTML = "";
      const sorted = [...allAds].sort((a,b)=> {
        const da = a.created_at ? new Date(a.created_at).getTime() : 0;
        const db = b.created_at ? new Date(b.created_at).getTime() : 0;
        return db - da;
      }).slice(0, 10);

      sorted.forEach(ad => {
        const row = document.createElement("div");
        row.className = "admin-list-item";
        row.textContent = `${ad.title || "E‚Äôlon"} ¬∑ ${ad.city || ""}`;
        row.addEventListener("click", () => openAdDetails(ad));
        adminLastAdsEl.appendChild(row);
      });
    }

    // Settings links
    if (settingsFavoritesRow) settingsFavoritesRow.addEventListener("click", () => showScreen("favorites"));
    if (settingsHistoryRow)   settingsHistoryRow.addEventListener("click", () => showScreen("history"));
    if (settingsPaidRow)      settingsPaidRow.addEventListener("click", () => showScreen("promo"));
    if (settingsBusinessRow)  settingsBusinessRow.addEventListener("click", () => showScreen("business"));
    if (settingsAdminRow)     settingsAdminRow.addEventListener("click", () => showScreen("admin"));
    if (settingsMyAdsRow)     settingsMyAdsRow.addEventListener("click", () => showScreen("myAds"));

    function applySavedProfilePhoto() {
      if (!profileAvatar) return;
      try {
        const url = localStorage.getItem(PROFILE_PHOTO_KEY);
        if (url) {
          profileAvatar.style.backgroundImage = `url('${url}')`;
          profileAvatar.style.backgroundSize = "cover";
          profileAvatar.style.backgroundPosition = "center";
          profileAvatar.textContent = "";
        }
      } catch (e) { console.warn("Profile photo load error:", e); }
    }

    function userHasShop() {
      try { return localStorage.getItem("zalvoHasShop") === "1"; }
      catch { return false; }
    }
    function setUserHasShop() {
      try { localStorage.setItem("zalvoHasShop", "1"); } catch {}
    }

    function renderMyShopAds() {
      if (!myShopAdsList) return;
      myShopAdsList.innerHTML = "";

      const myPhone = DEFAULT_PHONE.replace(/\s+/g, "");
      const myTg    = DEFAULT_TELEGRAM.replace(/^@/, "").toLowerCase();

      const myAds = allAds.filter(ad => {
        const adPhone = (ad.phone || "").replace(/\s+/g, "");
        const adTg    = (ad.telegram || "").replace(/^@/, "").toLowerCase();
        return (adPhone && adPhone === myPhone) || (adTg && adTg === myTg);
      });

      if (!myAds.length) {
        myShopAdsList.innerHTML = "<div class='ad-meta'>Hozircha do‚Äòkoningizda e‚Äôlonlar yo‚Äòq</div>";
        return;
      }

      const q = (shopAdsSearchInput?.value || "").toLowerCase().trim();

      let result = myAds.filter(ad => {
        if (shopAdsFilterState.onlyWithPhoto) {
          if (!ad.images || !Array.isArray(ad.images) || !ad.images.length) return false;
        }

        const p = Number(ad.price || 0);
        const min = Number(shopAdsFilterState.minPrice || 0);
        const max = Number(shopAdsFilterState.maxPrice || 0);

        if (shopAdsFilterState.minPrice && isFinite(min) && p < min) return false;
        if (shopAdsFilterState.maxPrice && isFinite(max) && p > max) return false;

        if (q) {
          const text = ((ad.title || "") + " " + (ad.description || "")).toLowerCase();
          if (!text.includes(q)) return false;
        }
        return true;
      });

      result.sort((a,b) => {
        const pa = Number(a.price || 0);
        const pb = Number(b.price || 0);
        const da = a.created_at ? new Date(a.created_at).getTime() : 0;
        const db = b.created_at ? new Date(b.created_at).getTime() : 0;

        if (shopAdsFilterState.sort === "cheap") return pa - pb;
        if (shopAdsFilterState.sort === "expensive") return pb - pa;
        return db - da;
      });

      if (!result.length) {
        myShopAdsList.innerHTML = "<div class='ad-meta'>Mos e‚Äôlon topilmadi</div>";
        return;
      }
      result.forEach(ad => myShopAdsList.appendChild(createAdCard(ad)));
    }

    // Profile photo change
    if (settingsChangePhoto && profilePhotoInput) {
      settingsChangePhoto.addEventListener("click", () => profilePhotoInput.click());

      profilePhotoInput.addEventListener("change", () => {
        const file = profilePhotoInput.files?.[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = e => {
          const url = e.target.result;

          if (profileAvatar) {
            profileAvatar.style.backgroundImage = `url('${url}')`;
            profileAvatar.style.backgroundSize = "cover";
            profileAvatar.style.backgroundPosition = "center";
            profileAvatar.textContent = "";
          }

          try { localStorage.setItem(PROFILE_PHOTO_KEY, url); }
          catch (err) { console.warn("Profile photo save error:", err); }
        };
        reader.readAsDataURL(file);
      });
    }

    if (businessBackBtn) businessBackBtn.addEventListener("click", () => showScreen("profile"));

    if (businessOpenShopBtn) {
      businessOpenShopBtn.addEventListener("click", () => {
        setUserHasShop();
        showScreen("myShop");
      });
    }

    if (settingsMyShopRow) {
      settingsMyShopRow.addEventListener("click", () => {
        if (userHasShop()) showScreen("myShop");
        else showScreen("business");
      });
    }

    if (settingsLangRow) settingsLangRow.addEventListener("click", () => showScreen("language"));

    if (languageUz) languageUz.addEventListener("click", () => {
      localStorage.setItem("zalvoLang", "uz");
      alert("Til o‚Äòrnatildi: O‚Äòzbek tili");
      showScreen("profile");
    });

    if (languageRu) languageRu.addEventListener("click", () => {
      localStorage.setItem("zalvoLang", "ru");
      alert("–Ø–∑—ã–∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: –†—É—Å—Å–∫–∏–π");
      showScreen("profile");
    });

    // ================== SHOPS DATA + RENDER ==================
    const shopsSearchInput = document.getElementById("shopsSearchInput");
    const shopsListEl      = document.getElementById("shopsList");
    const shopsEmptyEl     = document.getElementById("shopsEmpty");
    const shopsCategoryRow = document.getElementById("shopsCategoryRow");
    const topShopsRow      = document.getElementById("topShopsRow");

    const shopsFilterBtn   = document.getElementById("shopsFilterBtn");
    const shopsFilterSheet = document.getElementById("shopsFilterSheet");
    const shopsFilterCity  = document.getElementById("shopsFilterCity");
    const shopsSort        = document.getElementById("shopsSort");
    const shopsOnlyVerifiedBtn = document.getElementById("shopsOnlyVerified");
    const shopsApplyBtn    = document.getElementById("shopsApply");
    const shopsResetBtn    = document.getElementById("shopsReset");

    const shopsData = [
      { id:"s1", name:"Zalvo Phone Shop", city:"Toshkent shahri",   category:"Elektronika", subs:451, rating:4.9, reviews:451, ads:12, verified:true,  last:"yaqinda", ownerTelegram:"gulzor_shop",     ownerPhone:"+998991234567" },
      { id:"s2", name:"AvtoParts Pro",    city:"Toshkent viloyati", category:"Avto",        subs:210, rating:4.7, reviews:88,  ads:34, verified:true,  last:"bugun",  ownerTelegram:"avtoparts_pro" },
      { id:"s3", name:"Usta Xizmat",      city:"Samarqand",         category:"Xizmatlar",   subs:98,  rating:4.8, reviews:22,  ads:9,  verified:false, last:"kecha",  ownerTelegram:"usta_xizmat" },
      { id:"s4", name:"Home Market",      city:"Farg‚Äòona",          category:"Uy-rozg‚Äòor",  subs:133, rating:4.6, reviews:41,  ads:18, verified:false, last:"yaqinda",ownerTelegram:"home_market" },
      { id:"s5", name:"Style Kiyim",      city:"Andijon",           category:"Kiyim",       subs:76,  rating:4.5, reviews:19,  ads:7,  verified:true,  last:"yaqinda",ownerTelegram:"style_kiyim" },
      { id:"s6", name:"Green Market", city:"Toshkent shahri", category:"Oziq-ovqat", subs:55, rating:4.4, reviews:12, ads:15, verified:false, last:"bugun", ownerTelegram:"green_market" },
      { id:"s7", name:"Kids World", city:"Samarqand", category:"Bolalar", subs:80, rating:4.6, reviews:20, ads:10, verified:true, last:"yaqinda", ownerTelegram:"kids_world" },
      { id:"s8", name:"Qurilish Bazar", city:"Andijon", category:"Qurilish", subs:120, rating:4.5, reviews:33, ads:25, verified:true, last:"kecha", ownerTelegram:"qurilish_bazar" },
      { id:"s9", name:"Beauty Zone", city:"Farg‚Äòona", category:"Go‚Äòzallik", subs:95, rating:4.7, reviews:27, ads:14, verified:false, last:"yaqinda", ownerTelegram:"beauty_zone" },
      { id:"s10", name:"Sport Shop", city:"Namangan", category:"Sport", subs:60, rating:4.3, reviews:9, ads:8, verified:false, last:"yaqinda", ownerTelegram:"sport_shop" }
    ];

    function renderShopCategoryChips(){
  if (!shopsCategoryRow) return;

  const unique = Array.from(new Set((shopsData || [])
    .map(s => String(s.category || "").trim())
    .filter(Boolean)
  ));

  // –ø–æ—Ä—è–¥–æ–∫ ‚Äú–∫—Ä–∞—Å–∏–≤—ã–π‚Äù (—Å–Ω–∞—á–∞–ª–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ)
  const order = [
    "Elektronika","Avto","Uy-rozg‚Äòor","Xizmatlar","Kiyim",
    "Oziq-ovqat","Bolalar","Qurilish","Go‚Äòzallik","Sport","Kitoblar"
  ];

  unique.sort((a,b)=> {
    const ia = order.indexOf(a);
    const ib = order.indexOf(b);
    return (ia === -1 ? 999 : ia) - (ib === -1 ? 999 : ib);
  });

  shopsCategoryRow.innerHTML = `
    <button class="chip ${shopsFilterState.category === "all" ? "chip-filled":""}" data-shopcat="all">Hammasi</button>
    ${unique.map(c => `
      <button class="chip ${shopsFilterState.category === c ? "chip-filled":""}" data-shopcat="${c}">${c}</button>
    `).join("")}
  `;
}
    
    // ‚úÖ MY SHOP ‚ãØ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –û–ë–©–ò–ô shopSheetBackdrop
    const myShop = shopsData.find(s => s.id === "s1") || shopsData[0] || null;

    if (storeMoreBtn && !storeMoreBtn.dataset.bound) {
      storeMoreBtn.dataset.bound = "1";
      storeMoreBtn.addEventListener("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        if (myShop) openShopSheet(myShop);
      });
    }

    const shopsFilterState = {
      category: "all",
      city: "all",
      sort: "popular",
      onlyVerified: false,
    };

    function blockedKey(){ return "zalvo_shop_blocked"; }
    function getBlockedSet(){
      try { return new Set(JSON.parse(localStorage.getItem(blockedKey()) || "[]")); }
      catch { return new Set(); }
    }
    function saveBlockedSet(set){
      try { localStorage.setItem(blockedKey(), JSON.stringify(Array.from(set))); } catch {}
    }

    let shopsLoadedOnce = false;
    async function ensureShopsLoaded() {
      if (shopsLoadedOnce) return;
      shopsLoadedOnce = true;
      if (shopsListEl && (!shopsListEl.children || shopsListEl.children.length === 0)) {
        shopsListEl.innerHTML = "<div class='ad-meta'>Yuklanmoqda...</div>";
      }
    }

    function openShopsFilterSheet() {
      if (!shopsFilterSheet) return;
      shopsFilterSheet.classList.add("active");
      document.body.classList.add("sheet-open");
    }
    function closeShopsFilterSheet() {
      if (!shopsFilterSheet) return;
      shopsFilterSheet.classList.remove("active");
      document.body.classList.remove("sheet-open");
    }
    function syncShopsFilterUI(){
      if (shopsFilterCity) shopsFilterCity.value = shopsFilterState.city;
      if (shopsSort) shopsSort.value = shopsFilterState.sort;
      if (shopsOnlyVerifiedBtn) shopsOnlyVerifiedBtn.classList.toggle("chip-filled", shopsFilterState.onlyVerified);
    }

    function getInitials(name){
      const s = String(name||"").trim();
      if (!s) return "Z";
      const parts = s.split(/\s+/);
      const a = parts[0]?.[0] || "Z";
      const b = parts[1]?.[0] || "";
      return (a + b).toUpperCase();
    }

    function calcShopScore(shop){
      let score = 0;
      score += (shop.subs || 0) * 3;
      score += (shop.rating || 0) * 50;
      score += (shop.ads || 0) * 10;
      if (shop.last === "bugun")   score += 100;
      if (shop.last === "yaqinda") score += 50;
      if (shop.last === "kecha")   score += 20;
      return score;
    }

    function subKey(id){ return `zalvo_shop_sub_${id}`; }
    function isSubscribed(shopId){
      try { return localStorage.getItem(subKey(shopId)) === "1"; }
      catch { return false; }
    }
    function toggleSubscribe(shopId){
      try{
        const now = localStorage.getItem(subKey(shopId)) === "1";
        localStorage.setItem(subKey(shopId), now ? "0" : "1");
        return !now;
      } catch { return false; }
    }

    function topShopCardIG(shop){
      const div = document.createElement("div");
      div.className = "top-shop-ig";
      const subscribed = isSubscribed(shop.id);

      div.innerHTML = `
        <button class="top-shop-ig-menu" type="button" aria-label="Menu">‚ãØ</button>
        <div class="top-shop-ig-center">
          <div class="top-shop-ig-avatar">${getInitials(shop.name)}</div>
          <div class="top-shop-ig-name">${shop.name}${shop.verified ? " ‚úì" : ""}</div>
          <div class="top-shop-ig-meta">üìç ${shop.city}</div>
          <div class="top-shop-ig-meta2">${shop.category} ¬∑ ‚≠ê ${shop.rating || 0} ¬∑ üë• ${shop.subs || 0}</div>
          <button class="top-shop-ig-btn ${subscribed ? "subscribed":""}" type="button">
            ${subscribed ? "Obuna ‚úÖ" : "Obuna bo‚Äòlish"}
          </button>
        </div>
      `;

      div.addEventListener("click", () => openShop(shop));

      const subBtn = div.querySelector(".top-shop-ig-btn");
      subBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        const on = toggleSubscribe(shop.id);
        subBtn.classList.toggle("subscribed", on);
        subBtn.textContent = on ? "Obuna ‚úÖ" : "Obuna bo‚Äòlish";
      });

      const menuBtn = div.querySelector(".top-shop-ig-menu");
      menuBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        openShopSheet(shop);
      });

      return div;
    }

    // ===== Shops ACTION SHEET =====
    let sheetShop = null;

    const shopSheetBackdrop = document.getElementById("shopSheetBackdrop");
    const shopSheetTitle    = document.getElementById("shopSheetTitle");
    const shopSheetFav      = document.getElementById("shopSheetFav");
    const shopSheetShare    = document.getElementById("shopSheetShare");
    const shopSheetBlock    = document.getElementById("shopSheetBlock");

    function favShopKey(id){ return `zalvo_shop_fav_${id}`; }

    function openShopSheet(shop){
      sheetShop = shop;

      if (shopSheetTitle) shopSheetTitle.textContent = shop?.name || "Do‚Äòkon";
      if (shopSheetBackdrop) {
        shopSheetBackdrop.classList.add("active");
        document.body.classList.add("sheet-open");
      }

      if (shopSheetFav && sheetShop) {
        const isFav = localStorage.getItem(favShopKey(sheetShop.id)) === "1";
        shopSheetFav.innerHTML = `
          <span class="store-sheet-icon share">‚≠ê</span>
          ${isFav ? "Izbranda ‚úÖ" : "Izbranlarga qo‚Äòshish"}
        `;
      }
    }

    function closeShopSheet(){
      if (shopSheetBackdrop) shopSheetBackdrop.classList.remove("active");
      document.body.classList.remove("sheet-open");
      sheetShop = null;
    }

    if (shopViewMoreBtn) {
      shopViewMoreBtn.addEventListener("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        if (currentShop) openShopSheet(currentShop);
      });
    }

    if (shopSheetFav && !shopSheetFav.dataset.bound) {
      shopSheetFav.dataset.bound = "1";
      shopSheetFav.addEventListener("click", () => {
        if (!sheetShop) return;
        const key = favShopKey(sheetShop.id);
        const now = localStorage.getItem(key) === "1";
        localStorage.setItem(key, now ? "0" : "1");
        closeShopSheet();
      });
    }

    if (shopSheetShare && !shopSheetShare.dataset.bound) {
      shopSheetShare.dataset.bound = "1";
      shopSheetShare.addEventListener("click", async () => {
        if (!sheetShop) return;
        const text = `${sheetShop.name} ‚Äî ${sheetShop.city} ¬∑ ${sheetShop.category}`;
        const url = window.location.href;

        try{
          if (navigator.share){
            await navigator.share({ title: sheetShop.name, text, url });
          } else if (navigator.clipboard?.writeText){
            await navigator.clipboard.writeText(`${text}\n${url}`);
            alert("Nusxa olindi ‚úÖ");
          } else {
            alert(text);
          }
        } catch {}
        closeShopSheet();
      });
    }

    if (shopSheetBlock && !shopSheetBlock.dataset.bound) {
      shopSheetBlock.dataset.bound = "1";
      shopSheetBlock.addEventListener("click", () => {
        if (!sheetShop) return;
        const set = getBlockedSet();
        set.add(sheetShop.id);
        saveBlockedSet(set);
        closeShopSheet();
        renderShops();
      });
    }

    // ‚úÖ Close button for SHOP sheet ("Bekor qilish")
const shopSheetCancelBtn = document.getElementById("shopSheetCancelBtn");
if (shopSheetCancelBtn && !shopSheetCancelBtn.dataset.bound) {
  shopSheetCancelBtn.dataset.bound = "1";
  shopSheetCancelBtn.addEventListener("click", (e) => {
    e.preventDefault();
    e.stopPropagation();
    closeShopSheet();
  });
}
    
    if (shopSheetBackdrop && !shopSheetBackdrop.dataset.bound) {
      shopSheetBackdrop.dataset.bound = "1";
      shopSheetBackdrop.addEventListener("click", (e) => {
        if (e.target === shopSheetBackdrop) closeShopSheet();
      });
      shopSheetBackdrop.querySelector(".store-sheet")?.addEventListener("click", e => e.stopPropagation());
    }

    function shopCard(shop, withActions = true){
      const div = document.createElement("div");
      div.className = "shop-card";

      div.innerHTML = `
        <div class="shop-card-avatar">${getInitials(shop.name)}</div>
        <div class="shop-card-main">
          <div class="shop-card-title">
            ${shop.name}
            ${shop.verified ? `<span style="color:#16a34a;font-weight:800;">‚úì</span>` : ""}
          </div>
          <div class="shop-card-meta">üìç ${shop.city} ¬∑ ${shop.category}</div>
          <div class="shop-card-stats">
            <span>‚≠ê ${shop.rating}</span>
            <span>üí¨ ${shop.reviews}</span>
            <span>üßæ ${shop.ads}</span>
            <span>üë• ${shop.subs}</span>
          </div>
        </div>
        ${withActions ? `<button class="shop-more-btn" type="button">‚ãØ</button>` : ``}
      `;

      if (withActions) {
        div.querySelector(".shop-more-btn").addEventListener("click", (e) => {
          e.stopPropagation();
          openShopSheet(shop);
        });
      }

      div.addEventListener("click", () => openShop(shop));
      return div;
    }

    function renderShops(){
      if (!shopsListEl || !topShopsRow) return;

      const q = (shopsSearchInput?.value || "").toLowerCase().trim();
      const blocked = getBlockedSet();

      let result = shopsData
        .filter(s => !blocked.has(s.id))
        .filter(s => {
          if (shopsFilterState.category !== "all" && s.category !== shopsFilterState.category) return false;
          if (shopsFilterState.city !== "all" && s.city !== shopsFilterState.city) return false;
          if (shopsFilterState.onlyVerified && !s.verified) return false;

          if (q) {
            const text = `${s.name} ${s.city} ${s.category}`.toLowerCase();
            if (!text.includes(q)) return false;
          }
          return true;
        });

      result.sort((a,b) => {
        if (shopsFilterState.sort === "rating") return (b.rating||0) - (a.rating||0);
        if (shopsFilterState.sort === "new")    return (b.ads||0) - (a.ads||0);
        return (b.subs||0) - (a.subs||0);
      });

      const top = [...shopsData]
        .filter(s => !blocked.has(s.id))
        .filter(s => s.verified)
        .map(s => ({ ...s, _score: calcShopScore(s) }))
        .sort((a,b) => b._score - a._score)
        .slice(0, 8);

      topShopsRow.innerHTML = "";
      top.forEach(s => topShopsRow.appendChild(topShopCardIG(s)));

      shopsListEl.innerHTML = "";
      if (!result.length) {
        if (shopsEmptyEl) shopsEmptyEl.style.display = "block";
        return;
      }
      if (shopsEmptyEl) shopsEmptyEl.style.display = "none";

      result.forEach(s => shopsListEl.appendChild(shopCard(s)));
    }

    if (shopsSearchInput && !shopsSearchInput.dataset.bound) {
      shopsSearchInput.dataset.bound = "1";
      shopsSearchInput.addEventListener("input", renderShops);
    }

    if (shopsCategoryRow && !shopsCategoryRow.dataset.bound) {
      shopsCategoryRow.dataset.bound = "1";
      shopsCategoryRow.addEventListener("click", (e) => {
        const chip = e.target.closest(".chip");
        if (!chip) return;
        shopsCategoryRow.querySelectorAll(".chip").forEach(c => c.classList.remove("chip-filled"));
        chip.classList.add("chip-filled");
        shopsFilterState.category = chip.getAttribute("data-shopcat") || "all";
        renderShops();
      });
    }

    if (shopsFilterBtn && !shopsFilterBtn.dataset.bound) {
      shopsFilterBtn.dataset.bound = "1";
      shopsFilterBtn.addEventListener("click", () => {
        syncShopsFilterUI();
        openShopsFilterSheet();
      });
    }

    if (shopsFilterSheet && !shopsFilterSheet.dataset.bound) {
      shopsFilterSheet.dataset.bound = "1";
      shopsFilterSheet.addEventListener("click", (e) => {
        if (e.target === shopsFilterSheet) closeShopsFilterSheet();
      });
      const inner = shopsFilterSheet.querySelector(".store-sheet");
      if (inner) inner.addEventListener("click", (e) => e.stopPropagation());
    }

    if (shopsOnlyVerifiedBtn && !shopsOnlyVerifiedBtn.dataset.bound) {
      shopsOnlyVerifiedBtn.dataset.bound = "1";
      shopsOnlyVerifiedBtn.addEventListener("click", () => {
        shopsFilterState.onlyVerified = !shopsFilterState.onlyVerified;
        syncShopsFilterUI();
      });
    }

    if (shopsApplyBtn && !shopsApplyBtn.dataset.bound) {
      shopsApplyBtn.dataset.bound = "1";
      shopsApplyBtn.addEventListener("click", () => {
        shopsFilterState.city = shopsFilterCity?.value || "all";
        shopsFilterState.sort = shopsSort?.value || "popular";
        closeShopsFilterSheet();
        renderShops();
      });
    }

    if (shopsResetBtn && !shopsResetBtn.dataset.bound) {
      shopsResetBtn.dataset.bound = "1";
      shopsResetBtn.addEventListener("click", async () => {
        shopsFilterState.city = "all";
        shopsFilterState.sort = "popular";
        shopsFilterState.onlyVerified = false;
        shopsFilterState.category = "all";
        if (shopsSearchInput) shopsSearchInput.value = "";

        renderShopCategoryChips(); // ‚úÖ –ø–µ—Ä–µ—Å–æ–±–µ—Ä—ë—Ç –∏ –ø–æ–¥—Å–≤–µ—Ç–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

        syncShopsFilterUI();
        closeShopsFilterSheet();
        await ensureShopsLoaded();
        renderShops();
      });
    }

    // ===== REPORT SHOP =====
    const shopSheetReport = document.getElementById("shopSheetReport");
    const reportBackdrop  = document.getElementById("reportSheetBackdrop");
    const reportOptions   = document.querySelectorAll(".report-option");
    let reportShop = null;

    function openReportSheet(){
      if (!reportBackdrop) return;
      reportBackdrop.classList.add("active");
      document.body.classList.add("sheet-open");
    }
    function closeReportSheet(){
      if (!reportBackdrop) return;
      reportBackdrop.classList.remove("active");
      document.body.classList.remove("sheet-open");
    }

    if (shopSheetReport && !shopSheetReport.dataset.bound) {
      shopSheetReport.dataset.bound = "1";
      shopSheetReport.addEventListener("click", () => {
        reportShop = sheetShop;
        if (shopSheetBackdrop) shopSheetBackdrop.classList.remove("active");
        openReportSheet();
      });
    }

    reportOptions.forEach(opt => {
      if (opt.dataset.bound) return;
      opt.dataset.bound = "1";

      opt.addEventListener("click", () => {
        if (!reportShop) return;

        const reason = opt.dataset.reason || "other";
        const complaints = JSON.parse(localStorage.getItem("zalvo_shop_reports") || "[]");
        complaints.push({ shopId: reportShop.id, shopName: reportShop.name, reason, ts: Date.now() });
        localStorage.setItem("zalvo_shop_reports", JSON.stringify(complaints));

        closeReportSheet();
        reportShop = null;

        showToast("Shikoyat yuborildi", "Adminlar tekshiradi ‚ö†Ô∏è");
      });
    });

    if (reportBackdrop && !reportBackdrop.dataset.bound) {
      reportBackdrop.dataset.bound = "1";
      reportBackdrop.addEventListener("click", (e) => {
        if (e.target === reportBackdrop) {
          closeReportSheet();
          reportShop = null;
        }
      });
      reportBackdrop.querySelector(".store-sheet")?.addEventListener("click", e => e.stopPropagation());
    }

    const reportCancelBtn = document.getElementById("reportCancelBtn");

if (reportCancelBtn && !reportCancelBtn.dataset.bound) {
  reportCancelBtn.dataset.bound = "1";

  // –Ω–∞ iOS –∏–Ω–æ–≥–¥–∞ click –≥–ª—é—á–∏—Ç ‚Äî –¥–æ–±–∞–≤–ª—è–µ–º pointerup —Ç–æ–∂–µ
  const handler = (e) => {
    e.preventDefault();
    e.stopPropagation();
    closeReportSheet();
    reportShop = null;
  };

  reportCancelBtn.addEventListener("click", handler);
  reportCancelBtn.addEventListener("pointerup", handler);
}

    // ================== START ==================
    applySavedProfilePhoto();
    showScreen("home");
    loadAds();

  } catch (err) {
    console.error("ZALVO SCRIPT ERROR:", err);
    alert("Script error: oching Console (F12) va xatoni ko‚Äòring. Men tuzataman.");
  }
});
</script>
</body>
</html>
